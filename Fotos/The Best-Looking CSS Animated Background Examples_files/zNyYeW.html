<!DOCTYPE html>
<!-- saved from url=(0094)https://codepen.io/anon/embed/zNyYeW?height=500&theme-id=1&slug-hash=zNyYeW&default-tab=result -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <meta name="viewport" content="width=device-width">

  <title>CodePen Embed - Drifter Stars</title>

  <meta name="csrf-param" content="authenticity_token">
<meta name="csrf-token" content="ZBWgygIB6T+7CFM1IpwLTWEAqsLDX4NkLm7hc8NTiUMq4+J9NfkqD4QtblSnvkxQf51qW7Xw0rvAfSJ7+44CsA==">

  <link rel="stylesheet" media="all" href="./embed-ad67fe72acfeb011f9e0361df99b8dd024a995b725b6034694d1529c4f6bd5ca.css">

  <style>
    .hide {
      display: none !important;
    }
    .embed-footer,
    .embed-nav {
      background: #28282a;
      
    }
    .embed-nav .code-types a,
    .embed-nav .result-button-list a,
    .action-button {
      color: #ffffff;
      background-color: #424242;
    }
    .embed-nav .code-types a.active,
    .embed-nav .result-button-list a.active,
    .action-button.active {
      background: #212121;
      color: #ffffff;
      box-shadow: inset 0px 3px #ff8a00;
    }
    .embed-nav .logo-wrap .edit-on-codepen {
      color: #a9a9a9;
    }

    .embed-nav svg {
      stroke: #a9a9a9 !important;
    }
  </style>

  <link rel="stylesheet" media="all" href="./highcontrast-dark-f425686592da923b79e7aaab67bb8c72ee517d989ff13dfb02586480a6810ad6.css">

  <link rel="stylesheet" href="./maVRwd.css">
</head>

<body id="the-body" style="border: 1px solid #39231b; --borderWidth: 1px;" class="codepen-embed-body static results-active">

  <nav class="embed-nav group" id="embed-nav">

  <ul class="code-types">


        <li class="code-type">
          <a id="html-link" href="https://codepen.io/anon/embed/zNyYeW?height=500&amp;theme-id=1&amp;slug-hash=zNyYeW&amp;default-tab=result#html-box" role="button" aria-pressed="false">
              HTML
          </a>
        </li>


        <li class="code-type">
          <a id="css-link" href="https://codepen.io/anon/embed/zNyYeW?height=500&amp;theme-id=1&amp;slug-hash=zNyYeW&amp;default-tab=result#css-box" role="button" aria-pressed="false">
              SCSS
          </a>
        </li>


        <li class="code-type">
          <a id="js-link" href="https://codepen.io/anon/embed/zNyYeW?height=500&amp;theme-id=1&amp;slug-hash=zNyYeW&amp;default-tab=result#js-box" role="button" aria-pressed="false">
              JS
          </a>
        </li>


  </ul>

  <ul class="result-button-list">
    <li class="results results-type">
      <a id="result-link" href="https://codepen.io/anon/embed/zNyYeW?height=500&amp;theme-id=1&amp;slug-hash=zNyYeW&amp;default-tab=result#result-box" class="active" aria-pressed="true" role="button">
        Result
      </a>
    </li>
    <li>
      <a href="https://codepen.io/anon/embed/zNyYeW?height=500&amp;theme-id=1&amp;slug-hash=zNyYeW&amp;default-tab=result#resources-link" id="skip-results-iframe-link">Skip Results Iframe</a>
    </li>
  </ul>


    <div class="logo-wrap" id="edit-area">

        <a class="edit-on-codepen" target="_blank" rel="noopener" href="https://codepen.io/cr0ybot/pen/zNyYeW" title="Edit on CodePen">
            <div class="large-logo">
    <span id="edit-on-text" class="open-on">EDIT ON</span>
    <svg id="embed-codepen-logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 138 26" fill="none" stroke="#000" stroke-width="2.3" stroke-linecap="round" stroke-linejoin="round" role="img" aria-label="CodePen">
  <path d="M80 6h-9v14h9m34-14h-9v14h9m-3-7h-6m-28 0h-6m51 7V6l11 14V6M22 16.7L33 24l11-7.3V9.3L33 2 22 9.3v7.4zm22 0L33 9.3l-11 7.4m0-7.4l11 7.3 11-7.3M33 2v7.3m0 7.4V24m55-10h6c2.2 0 4-1.8 4-4s-1.8-4-4-4h-6v14M15 8c-1.3-1.3-3-2-5-2-4 0-7 3-7 7s3 7 7 7c2 0 3.7-.8 5-2m49-5c0 4-3 7-7 7h-5V6h5c4 0 7 3 7 7z"></path>
</svg>
  </div>
  <div class="box-logo">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="20 0 26 26" fill="none" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.3" role="img" aria-label="Edit on CodePen">
  <path id="icon-codepen-box" d="M22 16.7L33 24l11-7.3V9.3L33 2 22 9.3v7.4zm22 0L33 9.3l-11 7.4m0-7.4l11 7.3 11-7.3M33 2v7.3m0 7.4V24"></path>
</svg>
  </div>
        </a>

    
    </div>


</nav>


  <div id="output" data-border-style="thin" data-header="true">



        <div id="html-box" class="code-wrap code-box box " role="region" aria-label="HTML">


          <pre tabindex="0"><code data-lang="htmlmixed" id="actual-html-code" class=" cm-s-default"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">canvas</span> <span class="cm-attribute">id</span>=<span class="cm-string">"stars"</span> <span class="cm-attribute">width</span>=<span class="cm-string">"300"</span> <span class="cm-attribute">height</span>=<span class="cm-string">"300"</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">canvas</span><span class="cm-tag cm-bracket">&gt;</span></code></pre>

        </div>



        <div id="css-box" class="code-wrap code-box box " role="region" aria-label="CSS">


          <pre tabindex="0"><code data-lang="text/x-scss" id="actual-css-code" class=" cm-s-default"><span class="cm-tag">html</span>,
<span class="cm-tag">body</span> {
  <span class="cm-property">margin</span>: <span class="cm-number">0</span>;
  <span class="cm-property">padding</span>: <span class="cm-number">0</span>;
}

<span class="cm-tag">body</span> {
  <span class="cm-property">background-color</span>: <span class="cm-atom">#31102F</span>; <span class="cm-comment">//#280B29</span>
  <span class="cm-property">background</span>: <span class="cm-variable cm-callee">radial-gradient</span>(<span class="cm-atom">ellipse</span> <span class="cm-variable">at</span> <span class="cm-atom">center</span>, <span class="cm-variable cm-callee">rgba</span>(<span class="cm-number">49</span>,<span class="cm-number">16</span>,<span class="cm-number">47</span>,<span class="cm-number">1</span>) <span class="cm-number">0%</span>, <span class="cm-variable cm-callee">rgba</span>(<span class="cm-number">40</span>,<span class="cm-number">11</span>,<span class="cm-number">41</span>,<span class="cm-number">1</span>) <span class="cm-number">100%</span>);
}

<span class="cm-builtin">#stars</span> {
  <span class="cm-property">display</span>: <span class="cm-atom">block</span>;
  <span class="cm-property">position</span>: <span class="cm-atom">relative</span>;
  <span class="cm-property">width</span>: <span class="cm-number">100%</span>;
  <span class="cm-property">height</span>: <span class="cm-number">16rem</span>;
  <span class="cm-property">height</span>: <span class="cm-number">100vh</span>;
  <span class="cm-property">z-index</span>: <span class="cm-number">1</span>;
}</code></pre>

            <a href="https://codepen.io/anon/embed/zNyYeW?height=500&amp;theme-id=1&amp;slug-hash=zNyYeW&amp;default-tab=result#0" id="view-css-compiled-button" class="action-button bottom right view-compiled-button" data-type="css">
              View Compiled
            </a>
        </div>



        <div id="js-box" class="code-wrap code-box box " role="region" aria-label="JS">


          <pre tabindex="0"><code data-lang="javascript" id="actual-js-code" class=" cm-s-default"><span class="cm-comment">/**</span>
<span class="cm-comment"> * Stars</span>
<span class="cm-comment"> * Inspired by Steve Courtney's poster art for Celsius GS's Drifter - http://celsiusgs.com/drifter/posters.php</span>
<span class="cm-comment"> * by Cory Hughart - http://coryhughart.com</span>
<span class="cm-comment"> */</span>

<span class="cm-comment">// Settings</span>
<span class="cm-keyword">var</span> <span class="cm-def">particleCount</span> <span class="cm-operator">=</span> <span class="cm-number">40</span>,
  <span class="cm-def">flareCount</span> <span class="cm-operator">=</span> <span class="cm-number">10</span>,
  <span class="cm-def">motion</span> <span class="cm-operator">=</span> <span class="cm-number">0.05</span>,
  <span class="cm-def">tilt</span> <span class="cm-operator">=</span> <span class="cm-number">0.05</span>,
  <span class="cm-def">color</span> <span class="cm-operator">=</span> <span class="cm-string">'#FFEED4'</span>,
  <span class="cm-def">particleSizeBase</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>,
  <span class="cm-def">particleSizeMultiplier</span> <span class="cm-operator">=</span> <span class="cm-number">0.5</span>,
  <span class="cm-def">flareSizeBase</span> <span class="cm-operator">=</span> <span class="cm-number">100</span>,
  <span class="cm-def">flareSizeMultiplier</span> <span class="cm-operator">=</span> <span class="cm-number">100</span>,
  <span class="cm-def">lineWidth</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>,
  <span class="cm-def">linkChance</span> <span class="cm-operator">=</span> <span class="cm-number">75</span>, <span class="cm-comment">// chance per frame of link, higher = smaller chance</span>
  <span class="cm-def">linkLengthMin</span> <span class="cm-operator">=</span> <span class="cm-number">5</span>, <span class="cm-comment">// min linked vertices</span>
  <span class="cm-def">linkLengthMax</span> <span class="cm-operator">=</span> <span class="cm-number">7</span>, <span class="cm-comment">// max linked vertices</span>
  <span class="cm-def">linkOpacity</span> <span class="cm-operator">=</span> <span class="cm-number">0.25</span>; <span class="cm-comment">// number between 0 &amp; 1</span>
  <span class="cm-variable">linkFade</span> <span class="cm-operator">=</span> <span class="cm-number">90</span>, <span class="cm-comment">// link fade-out frames</span>
  <span class="cm-variable">linkSpeed</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>, <span class="cm-comment">// distance a link travels in 1 frame</span>
  <span class="cm-variable">glareAngle</span> <span class="cm-operator">=</span> <span class="cm-operator">-</span><span class="cm-number">60</span>,
  <span class="cm-variable">glareOpacityMultiplier</span> <span class="cm-operator">=</span> <span class="cm-number">0.05</span>,
  <span class="cm-variable">renderParticles</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>,
  <span class="cm-variable">renderParticleGlare</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>,
  <span class="cm-variable">renderFlares</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>,
  <span class="cm-variable">renderLinks</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>,
  <span class="cm-variable">renderMesh</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>,
  <span class="cm-variable">flicker</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>,
  <span class="cm-variable">flickerSmoothing</span> <span class="cm-operator">=</span> <span class="cm-number">15</span>, <span class="cm-comment">// higher = smoother flicker</span>
  <span class="cm-variable">blurSize</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>,
  <span class="cm-variable">orbitTilt</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>,
  <span class="cm-variable">randomMotion</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>,
  <span class="cm-variable">noiseLength</span> <span class="cm-operator">=</span> <span class="cm-number">1000</span>,
  <span class="cm-variable">noiseStrength</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>;

<span class="cm-keyword">var</span> <span class="cm-def">canvas</span> <span class="cm-operator">=</span> <span class="cm-variable">document</span>.<span class="cm-property">getElementById</span>(<span class="cm-string">'stars'</span>),
  <span class="cm-comment">//orbits = document.getElementById('orbits'),</span>
  <span class="cm-def">context</span> <span class="cm-operator">=</span> <span class="cm-variable">canvas</span>.<span class="cm-property">getContext</span>(<span class="cm-string">'2d'</span>),
  <span class="cm-def">mouse</span> <span class="cm-operator">=</span> { <span class="cm-property">x</span>: <span class="cm-number">0</span>, <span class="cm-property">y</span>: <span class="cm-number">0</span> },
  <span class="cm-def">m</span> <span class="cm-operator">=</span> {},
  <span class="cm-def">r</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>,
  <span class="cm-def">c</span> <span class="cm-operator">=</span> <span class="cm-number">1000</span>, <span class="cm-comment">// multiplier for delaunay points, since floats too small can mess up the algorithm</span>
  <span class="cm-def">n</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>,
  <span class="cm-def">nAngle</span> <span class="cm-operator">=</span> (<span class="cm-variable">Math</span>.<span class="cm-property">PI</span> <span class="cm-operator">*</span> <span class="cm-number">2</span>) <span class="cm-operator">/</span> <span class="cm-variable">noiseLength</span>,
  <span class="cm-def">nRad</span> <span class="cm-operator">=</span> <span class="cm-number">100</span>,
  <span class="cm-def">nScale</span> <span class="cm-operator">=</span> <span class="cm-number">0.5</span>,
  <span class="cm-def">nPos</span> <span class="cm-operator">=</span> {<span class="cm-property">x</span>: <span class="cm-number">0</span>, <span class="cm-property">y</span>: <span class="cm-number">0</span>},
  <span class="cm-def">points</span> <span class="cm-operator">=</span> [],
  <span class="cm-def">vertices</span> <span class="cm-operator">=</span> [],
  <span class="cm-def">triangles</span> <span class="cm-operator">=</span> [],
  <span class="cm-def">links</span> <span class="cm-operator">=</span> [],
  <span class="cm-def">particles</span> <span class="cm-operator">=</span> [],
  <span class="cm-def">flares</span> <span class="cm-operator">=</span> [];

<span class="cm-keyword">function</span> <span class="cm-def">init</span>() {
  <span class="cm-keyword">var</span> <span class="cm-def">i</span>, <span class="cm-def">j</span>, <span class="cm-def">k</span>;

  <span class="cm-comment">// requestAnimFrame polyfill</span>
  <span class="cm-variable">window</span>.<span class="cm-property">requestAnimFrame</span> <span class="cm-operator">=</span> (<span class="cm-keyword">function</span>(){
    <span class="cm-keyword">return</span>  <span class="cm-variable">window</span>.<span class="cm-property">requestAnimationFrame</span> <span class="cm-operator">||</span>
        <span class="cm-variable">window</span>.<span class="cm-property">webkitRequestAnimationFrame</span> <span class="cm-operator">||</span>
        <span class="cm-variable">window</span>.<span class="cm-property">mozRequestAnimationFrame</span> <span class="cm-operator">||</span>
        <span class="cm-keyword">function</span>( <span class="cm-def">callback</span> ){
          <span class="cm-variable">window</span>.<span class="cm-property">setTimeout</span>(<span class="cm-variable-2">callback</span>, <span class="cm-number">1000</span> <span class="cm-operator">/</span> <span class="cm-number">60</span>);
        };
  })();

  <span class="cm-comment">// Fade in background</span>
  <span class="cm-comment">/*</span>
<span class="cm-comment">  var background = document.getElementById('background'),</span>
<span class="cm-comment">    bgImg = new Image(),</span>
<span class="cm-comment">    bgURL = '/img/background.jpg';</span>
<span class="cm-comment">  bgImg.onload = function() {</span>
<span class="cm-comment">    //console.log('background loaded');</span>
<span class="cm-comment">    background.style.backgroundImage = 'url("'+bgURL+'")';</span>
<span class="cm-comment">    background.className += ' loaded';</span>
<span class="cm-comment">  }</span>
<span class="cm-comment">  bgImg.src = bgURL;</span>
<span class="cm-comment">  */</span>

  <span class="cm-comment">// Size canvas</span>
  <span class="cm-variable">resize</span>();

  <span class="cm-variable">mouse</span>.<span class="cm-property">x</span> <span class="cm-operator">=</span> <span class="cm-variable">canvas</span>.<span class="cm-property">clientWidth</span> <span class="cm-operator">/</span> <span class="cm-number">2</span>;
  <span class="cm-variable">mouse</span>.<span class="cm-property">y</span> <span class="cm-operator">=</span> <span class="cm-variable">canvas</span>.<span class="cm-property">clientHeight</span> <span class="cm-operator">/</span> <span class="cm-number">2</span>;

  <span class="cm-comment">// Create particle positions</span>
  <span class="cm-keyword">for</span> (<span class="cm-variable-2">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable-2">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">particleCount</span>; <span class="cm-variable-2">i</span><span class="cm-operator">++</span>) {
    <span class="cm-keyword">var</span> <span class="cm-def">p</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">Particle</span>();
    <span class="cm-variable">particles</span>.<span class="cm-property">push</span>(<span class="cm-variable-2">p</span>);
    <span class="cm-variable">points</span>.<span class="cm-property">push</span>([<span class="cm-variable-2">p</span>.<span class="cm-property">x</span><span class="cm-operator">*</span><span class="cm-variable">c</span>, <span class="cm-variable-2">p</span>.<span class="cm-property">y</span><span class="cm-operator">*</span><span class="cm-variable">c</span>]);
  }

  <span class="cm-comment">//console.log(JSON.stringify(points));</span>

  <span class="cm-comment">// Delaunay triangulation</span>
  <span class="cm-comment">//var Delaunay = require('delaunay-fast');</span>
  <span class="cm-variable">vertices</span> <span class="cm-operator">=</span> <span class="cm-variable">Delaunay</span>.<span class="cm-property">triangulate</span>(<span class="cm-variable">points</span>);
  <span class="cm-comment">//console.log(JSON.stringify(vertices));</span>
  <span class="cm-comment">// Create an array of "triangles" (groups of 3 indices)</span>
  <span class="cm-keyword">var</span> <span class="cm-def">tri</span> <span class="cm-operator">=</span> [];
  <span class="cm-keyword">for</span> (<span class="cm-variable-2">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable-2">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">vertices</span>.<span class="cm-property">length</span>; <span class="cm-variable-2">i</span><span class="cm-operator">++</span>) {
    <span class="cm-keyword">if</span> (<span class="cm-variable-2">tri</span>.<span class="cm-property">length</span> <span class="cm-operator">==</span> <span class="cm-number">3</span>) {
      <span class="cm-variable">triangles</span>.<span class="cm-property">push</span>(<span class="cm-variable-2">tri</span>);
      <span class="cm-variable-2">tri</span> <span class="cm-operator">=</span> [];
    }
    <span class="cm-variable-2">tri</span>.<span class="cm-property">push</span>(<span class="cm-variable">vertices</span>[<span class="cm-variable-2">i</span>]);
  }
  <span class="cm-comment">//console.log(JSON.stringify(triangles));</span>

  <span class="cm-comment">// Tell all the particles who their neighbors are</span>
  <span class="cm-keyword">for</span> (<span class="cm-variable-2">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable-2">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">particles</span>.<span class="cm-property">length</span>; <span class="cm-variable-2">i</span><span class="cm-operator">++</span>) {
    <span class="cm-comment">// Loop through all tirangles</span>
    <span class="cm-keyword">for</span> (<span class="cm-variable-2">j</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable-2">j</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">triangles</span>.<span class="cm-property">length</span>; <span class="cm-variable-2">j</span><span class="cm-operator">++</span>) {
      <span class="cm-comment">// Check if this particle's index is in this triangle</span>
      <span class="cm-variable-2">k</span> <span class="cm-operator">=</span> <span class="cm-variable">triangles</span>[<span class="cm-variable-2">j</span>].<span class="cm-property">indexOf</span>(<span class="cm-variable-2">i</span>);
      <span class="cm-comment">// If it is, add its neighbors to the particles contacts list</span>
      <span class="cm-keyword">if</span> (<span class="cm-variable-2">k</span> <span class="cm-operator">!==</span> <span class="cm-operator">-</span><span class="cm-number">1</span>) {
        <span class="cm-variable">triangles</span>[<span class="cm-variable-2">j</span>].<span class="cm-property">forEach</span>(<span class="cm-keyword">function</span>(<span class="cm-def">value</span>, <span class="cm-def">index</span>, <span class="cm-def">array</span>) {
          <span class="cm-keyword">if</span> (<span class="cm-variable-2">value</span> <span class="cm-operator">!==</span> <span class="cm-variable-2">i</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable">particles</span>[<span class="cm-variable-2">i</span>].<span class="cm-property">neighbors</span>.<span class="cm-property">indexOf</span>(<span class="cm-variable-2">value</span>) <span class="cm-operator">==</span> <span class="cm-operator">-</span><span class="cm-number">1</span>) {
            <span class="cm-variable">particles</span>[<span class="cm-variable-2">i</span>].<span class="cm-property">neighbors</span>.<span class="cm-property">push</span>(<span class="cm-variable-2">value</span>);
          }
        });
      }
    }
  }
  <span class="cm-comment">//console.log(JSON.stringify(particles));</span>

  <span class="cm-keyword">if</span> (<span class="cm-variable">renderFlares</span>) {
    <span class="cm-comment">// Create flare positions</span>
    <span class="cm-keyword">for</span> (<span class="cm-variable-2">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable-2">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">flareCount</span>; <span class="cm-variable-2">i</span><span class="cm-operator">++</span>) {
      <span class="cm-variable">flares</span>.<span class="cm-property">push</span>(<span class="cm-keyword">new</span> <span class="cm-variable">Flare</span>());
    }
  }

  <span class="cm-comment">// Motion mode</span>
  <span class="cm-comment">//if (Modernizr &amp;&amp; Modernizr.deviceorientation) {</span>
  <span class="cm-keyword">if</span> (<span class="cm-string">'ontouchstart'</span> <span class="cm-keyword">in</span> <span class="cm-variable">document</span>.<span class="cm-property">documentElement</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable">window</span>.<span class="cm-property">DeviceOrientationEvent</span>) {
    <span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-string">'Using device orientation'</span>);
    <span class="cm-variable">window</span>.<span class="cm-property">addEventListener</span>(<span class="cm-string">'deviceorientation'</span>, <span class="cm-keyword">function</span>(<span class="cm-def">e</span>) {
      <span class="cm-variable">mouse</span>.<span class="cm-property">x</span> <span class="cm-operator">=</span> (<span class="cm-variable">canvas</span>.<span class="cm-property">clientWidth</span> <span class="cm-operator">/</span> <span class="cm-number">2</span>) <span class="cm-operator">-</span> ((<span class="cm-variable-2">e</span>.<span class="cm-property">gamma</span> <span class="cm-operator">/</span> <span class="cm-number">90</span>) <span class="cm-operator">*</span> (<span class="cm-variable">canvas</span>.<span class="cm-property">clientWidth</span> <span class="cm-operator">/</span> <span class="cm-number">2</span>) <span class="cm-operator">*</span> <span class="cm-number">2</span>);
      <span class="cm-variable">mouse</span>.<span class="cm-property">y</span> <span class="cm-operator">=</span> (<span class="cm-variable">canvas</span>.<span class="cm-property">clientHeight</span> <span class="cm-operator">/</span> <span class="cm-number">2</span>) <span class="cm-operator">-</span> ((<span class="cm-variable-2">e</span>.<span class="cm-property">beta</span> <span class="cm-operator">/</span> <span class="cm-number">90</span>) <span class="cm-operator">*</span> (<span class="cm-variable">canvas</span>.<span class="cm-property">clientHeight</span> <span class="cm-operator">/</span> <span class="cm-number">2</span>) <span class="cm-operator">*</span> <span class="cm-number">2</span>);
      <span class="cm-comment">//console.log('Center: x:'+(canvas.clientWidth/2)+' y:'+(canvas.clientHeight/2));</span>
      <span class="cm-comment">//console.log('Orientation: x:'+mouse.x+' ('+e.gamma+') y:'+mouse.y+' ('+e.beta+')');</span>
    }, <span class="cm-atom">true</span>);
  }
  <span class="cm-keyword">else</span> {
    <span class="cm-comment">// Mouse move listener</span>
    <span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-string">'Using mouse movement'</span>);
    <span class="cm-variable">document</span>.<span class="cm-property">body</span>.<span class="cm-property">addEventListener</span>(<span class="cm-string">'mousemove'</span>, <span class="cm-keyword">function</span>(<span class="cm-def">e</span>) {
      <span class="cm-comment">//console.log('moved');</span>
      <span class="cm-variable">mouse</span>.<span class="cm-property">x</span> <span class="cm-operator">=</span> <span class="cm-variable-2">e</span>.<span class="cm-property">clientX</span>;
      <span class="cm-variable">mouse</span>.<span class="cm-property">y</span> <span class="cm-operator">=</span> <span class="cm-variable-2">e</span>.<span class="cm-property">clientY</span>;
    });
  }

  <span class="cm-comment">// Random motion</span>
  <span class="cm-keyword">if</span> (<span class="cm-variable">randomMotion</span>) {
    <span class="cm-comment">//var SimplexNoise = require('simplex-noise');</span>
    <span class="cm-comment">//var simplex = new SimplexNoise();</span>
  }

  <span class="cm-comment">// Animation loop</span>
  (<span class="cm-keyword">function</span> <span class="cm-def">animloop</span>(){
    <span class="cm-variable">requestAnimFrame</span>(<span class="cm-variable-2">animloop</span>);
    <span class="cm-variable">resize</span>();
    <span class="cm-variable">render</span>();
  })();
}

<span class="cm-keyword">function</span> <span class="cm-def">render</span>() {
  <span class="cm-keyword">if</span> (<span class="cm-variable">randomMotion</span>) {
    <span class="cm-variable">n</span><span class="cm-operator">++</span>;
    <span class="cm-keyword">if</span> (<span class="cm-variable">n</span> <span class="cm-operator">&gt;=</span> <span class="cm-variable">noiseLength</span>) {
      <span class="cm-variable">n</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;
    }

    <span class="cm-variable">nPos</span> <span class="cm-operator">=</span> <span class="cm-variable">noisePoint</span>(<span class="cm-variable">n</span>);
    <span class="cm-comment">//console.log('NOISE x:'+nPos.x+' y:'+nPos.y);</span>
  }

  <span class="cm-comment">// Clear</span>
  <span class="cm-variable">context</span>.<span class="cm-property">clearRect</span>(<span class="cm-number">0</span>, <span class="cm-number">0</span>, <span class="cm-variable">canvas</span>.<span class="cm-property">width</span>, <span class="cm-variable">canvas</span>.<span class="cm-property">height</span>);

  <span class="cm-keyword">if</span> (<span class="cm-variable">blurSize</span> <span class="cm-operator">&gt;</span> <span class="cm-number">0</span>) {
    <span class="cm-variable">context</span>.<span class="cm-property">shadowBlur</span> <span class="cm-operator">=</span> <span class="cm-variable">blurSize</span>;
    <span class="cm-variable">context</span>.<span class="cm-property">shadowColor</span> <span class="cm-operator">=</span> <span class="cm-variable">color</span>;
  }

  <span class="cm-keyword">if</span> (<span class="cm-variable">renderParticles</span>) {
    <span class="cm-comment">// Render particles</span>
    <span class="cm-keyword">for</span> (<span class="cm-keyword">var</span> <span class="cm-def">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable-2">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">particleCount</span>; <span class="cm-variable-2">i</span><span class="cm-operator">++</span>) {
      <span class="cm-variable">particles</span>[<span class="cm-variable-2">i</span>].<span class="cm-property">render</span>();
    }
  }

  <span class="cm-keyword">if</span> (<span class="cm-variable">renderMesh</span>) {
    <span class="cm-comment">// Render all lines</span>
    <span class="cm-variable">context</span>.<span class="cm-property">beginPath</span>();
    <span class="cm-keyword">for</span> (<span class="cm-keyword">var</span> <span class="cm-def">v</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable-2">v</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">vertices</span>.<span class="cm-property">length</span><span class="cm-operator">-</span><span class="cm-number">1</span>; <span class="cm-variable-2">v</span><span class="cm-operator">++</span>) {
      <span class="cm-comment">// Splits the array into triplets</span>
      <span class="cm-keyword">if</span> ((<span class="cm-variable-2">v</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>) <span class="cm-operator">%</span> <span class="cm-number">3</span> <span class="cm-operator">===</span> <span class="cm-number">0</span>) { <span class="cm-keyword">continue</span>; }

      <span class="cm-keyword">var</span> <span class="cm-def">p1</span> <span class="cm-operator">=</span> <span class="cm-variable">particles</span>[<span class="cm-variable">vertices</span>[<span class="cm-variable-2">v</span>]],
        <span class="cm-def">p2</span> <span class="cm-operator">=</span> <span class="cm-variable">particles</span>[<span class="cm-variable">vertices</span>[<span class="cm-variable-2">v</span><span class="cm-operator">+</span><span class="cm-number">1</span>]];

      <span class="cm-comment">//console.log('Line: '+p1.x+','+p1.y+'-&gt;'+p2.x+','+p2.y);</span>

      <span class="cm-keyword">var</span> <span class="cm-def">pos1</span> <span class="cm-operator">=</span> <span class="cm-variable">position</span>(<span class="cm-variable-2">p1</span>.<span class="cm-property">x</span>, <span class="cm-variable-2">p1</span>.<span class="cm-property">y</span>, <span class="cm-variable-2">p1</span>.<span class="cm-property">z</span>),
        <span class="cm-def">pos2</span> <span class="cm-operator">=</span> <span class="cm-variable">position</span>(<span class="cm-variable-2">p2</span>.<span class="cm-property">x</span>, <span class="cm-variable-2">p2</span>.<span class="cm-property">y</span>, <span class="cm-variable-2">p2</span>.<span class="cm-property">z</span>);

      <span class="cm-variable">context</span>.<span class="cm-property">moveTo</span>(<span class="cm-variable-2">pos1</span>.<span class="cm-property">x</span>, <span class="cm-variable-2">pos1</span>.<span class="cm-property">y</span>);
      <span class="cm-variable">context</span>.<span class="cm-property">lineTo</span>(<span class="cm-variable-2">pos2</span>.<span class="cm-property">x</span>, <span class="cm-variable-2">pos2</span>.<span class="cm-property">y</span>);
    }
    <span class="cm-variable">context</span>.<span class="cm-property">strokeStyle</span> <span class="cm-operator">=</span> <span class="cm-variable">color</span>;
    <span class="cm-variable">context</span>.<span class="cm-property">lineWidth</span> <span class="cm-operator">=</span> <span class="cm-variable">lineWidth</span>;
    <span class="cm-variable">context</span>.<span class="cm-property">stroke</span>();
    <span class="cm-variable">context</span>.<span class="cm-property">closePath</span>();
  }

  <span class="cm-keyword">if</span> (<span class="cm-variable">renderLinks</span>) {
    <span class="cm-comment">// Possibly start a new link</span>
    <span class="cm-keyword">if</span> (<span class="cm-variable">random</span>(<span class="cm-number">0</span>, <span class="cm-variable">linkChance</span>) <span class="cm-operator">==</span> <span class="cm-variable">linkChance</span>) {
      <span class="cm-keyword">var</span> <span class="cm-def">length</span> <span class="cm-operator">=</span> <span class="cm-variable">random</span>(<span class="cm-variable">linkLengthMin</span>, <span class="cm-variable">linkLengthMax</span>);
      <span class="cm-keyword">var</span> <span class="cm-def">start</span> <span class="cm-operator">=</span> <span class="cm-variable">random</span>(<span class="cm-number">0</span>, <span class="cm-variable">particles</span>.<span class="cm-property">length</span><span class="cm-operator">-</span><span class="cm-number">1</span>);
      <span class="cm-variable">startLink</span>(<span class="cm-variable-2">start</span>, <span class="cm-variable-2">length</span>);
    }

    <span class="cm-comment">// Render existing links</span>
    <span class="cm-comment">// Iterate in reverse so that removing items doesn't affect the loop</span>
    <span class="cm-keyword">for</span> (<span class="cm-keyword">var</span> <span class="cm-def">l</span> <span class="cm-operator">=</span> <span class="cm-variable">links</span>.<span class="cm-property">length</span><span class="cm-operator">-</span><span class="cm-number">1</span>; <span class="cm-variable-2">l</span> <span class="cm-operator">&gt;=</span> <span class="cm-number">0</span>; <span class="cm-variable-2">l</span><span class="cm-operator">--</span>) {
      <span class="cm-keyword">if</span> (<span class="cm-variable">links</span>[<span class="cm-variable-2">l</span>] <span class="cm-operator">&amp;&amp;</span> <span class="cm-operator">!</span><span class="cm-variable">links</span>[<span class="cm-variable-2">l</span>].<span class="cm-property">finished</span>) {
        <span class="cm-variable">links</span>[<span class="cm-variable-2">l</span>].<span class="cm-property">render</span>();
      }
      <span class="cm-keyword">else</span> {
        <span class="cm-keyword">delete</span> <span class="cm-variable">links</span>[<span class="cm-variable-2">l</span>];
      }
    }
  }

  <span class="cm-keyword">if</span> (<span class="cm-variable">renderFlares</span>) {
    <span class="cm-comment">// Render flares</span>
    <span class="cm-keyword">for</span> (<span class="cm-keyword">var</span> <span class="cm-def">j</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable-2">j</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">flareCount</span>; <span class="cm-variable-2">j</span><span class="cm-operator">++</span>) {
      <span class="cm-variable">flares</span>[<span class="cm-variable-2">j</span>].<span class="cm-property">render</span>();
    }
  }

  <span class="cm-comment">/*</span>
<span class="cm-comment">  if (orbitTilt) {</span>
<span class="cm-comment">    var tiltX = -(((canvas.clientWidth / 2) - mouse.x + ((nPos.x - 0.5) * noiseStrength)) * tilt),</span>
<span class="cm-comment">      tiltY = (((canvas.clientHeight / 2) - mouse.y + ((nPos.y - 0.5) * noiseStrength)) * tilt);</span>

<span class="cm-comment">    orbits.style.transform = 'rotateY('+tiltX+'deg) rotateX('+tiltY+'deg)';</span>
<span class="cm-comment">  }</span>
<span class="cm-comment">  */</span>
}

<span class="cm-keyword">function</span> <span class="cm-def">resize</span>() {
  <span class="cm-variable">canvas</span>.<span class="cm-property">width</span> <span class="cm-operator">=</span> <span class="cm-variable">window</span>.<span class="cm-property">innerWidth</span> <span class="cm-operator">*</span> (<span class="cm-variable">window</span>.<span class="cm-property">devicePixelRatio</span> <span class="cm-operator">||</span> <span class="cm-number">1</span>);
  <span class="cm-variable">canvas</span>.<span class="cm-property">height</span> <span class="cm-operator">=</span> <span class="cm-variable">canvas</span>.<span class="cm-property">width</span> <span class="cm-operator">*</span> (<span class="cm-variable">canvas</span>.<span class="cm-property">clientHeight</span> <span class="cm-operator">/</span> <span class="cm-variable">canvas</span>.<span class="cm-property">clientWidth</span>);
}

<span class="cm-keyword">function</span> <span class="cm-def">startLink</span>(<span class="cm-def">vertex</span>, <span class="cm-def">length</span>) {
  <span class="cm-comment">//console.log('LINK from '+vertex+' (length '+length+')');</span>
  <span class="cm-variable">links</span>.<span class="cm-property">push</span>(<span class="cm-keyword">new</span> <span class="cm-variable">Link</span>(<span class="cm-variable-2">vertex</span>, <span class="cm-variable-2">length</span>));
}

<span class="cm-comment">// Particle class</span>
<span class="cm-keyword">var</span> <span class="cm-def">Particle</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span>() {
  <span class="cm-keyword">this</span>.<span class="cm-property">x</span> <span class="cm-operator">=</span> <span class="cm-variable">random</span>(<span class="cm-operator">-</span><span class="cm-number">0.1</span>, <span class="cm-number">1.1</span>, <span class="cm-atom">true</span>);
  <span class="cm-keyword">this</span>.<span class="cm-property">y</span> <span class="cm-operator">=</span> <span class="cm-variable">random</span>(<span class="cm-operator">-</span><span class="cm-number">0.1</span>, <span class="cm-number">1.1</span>, <span class="cm-atom">true</span>);
  <span class="cm-keyword">this</span>.<span class="cm-property">z</span> <span class="cm-operator">=</span> <span class="cm-variable">random</span>(<span class="cm-number">0</span>,<span class="cm-number">4</span>);
  <span class="cm-keyword">this</span>.<span class="cm-property">color</span> <span class="cm-operator">=</span> <span class="cm-variable">color</span>;
  <span class="cm-keyword">this</span>.<span class="cm-property">opacity</span> <span class="cm-operator">=</span> <span class="cm-variable">random</span>(<span class="cm-number">0.1</span>,<span class="cm-number">1</span>,<span class="cm-atom">true</span>);
  <span class="cm-keyword">this</span>.<span class="cm-property">flicker</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;
  <span class="cm-keyword">this</span>.<span class="cm-property">neighbors</span> <span class="cm-operator">=</span> []; <span class="cm-comment">// placeholder for neighbors</span>
};
<span class="cm-variable">Particle</span>.<span class="cm-property">prototype</span>.<span class="cm-property">render</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span>() {
  <span class="cm-keyword">var</span> <span class="cm-def">pos</span> <span class="cm-operator">=</span> <span class="cm-variable">position</span>(<span class="cm-keyword">this</span>.<span class="cm-property">x</span>, <span class="cm-keyword">this</span>.<span class="cm-property">y</span>, <span class="cm-keyword">this</span>.<span class="cm-property">z</span>),
    <span class="cm-def">r</span> <span class="cm-operator">=</span> ((<span class="cm-keyword">this</span>.<span class="cm-property">z</span> <span class="cm-operator">*</span> <span class="cm-variable">particleSizeMultiplier</span>) <span class="cm-operator">+</span> <span class="cm-variable">particleSizeBase</span>) <span class="cm-operator">*</span> (<span class="cm-variable">sizeRatio</span>() <span class="cm-operator">/</span> <span class="cm-number">1000</span>),
    <span class="cm-def">o</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">opacity</span>;

  <span class="cm-keyword">if</span> (<span class="cm-variable">flicker</span>) {
    <span class="cm-keyword">var</span> <span class="cm-def">newVal</span> <span class="cm-operator">=</span> <span class="cm-variable">random</span>(<span class="cm-operator">-</span><span class="cm-number">0.5</span>, <span class="cm-number">0.5</span>, <span class="cm-atom">true</span>);
    <span class="cm-keyword">this</span>.<span class="cm-property">flicker</span> <span class="cm-operator">+=</span> (<span class="cm-variable-2">newVal</span> <span class="cm-operator">-</span> <span class="cm-keyword">this</span>.<span class="cm-property">flicker</span>) <span class="cm-operator">/</span> <span class="cm-variable">flickerSmoothing</span>;
    <span class="cm-keyword">if</span> (<span class="cm-keyword">this</span>.<span class="cm-property">flicker</span> <span class="cm-operator">&gt;</span> <span class="cm-number">0.5</span>) <span class="cm-keyword">this</span>.<span class="cm-property">flicker</span> <span class="cm-operator">=</span> <span class="cm-number">0.5</span>;
    <span class="cm-keyword">if</span> (<span class="cm-keyword">this</span>.<span class="cm-property">flicker</span> <span class="cm-operator">&lt;</span> <span class="cm-operator">-</span><span class="cm-number">0.5</span>) <span class="cm-keyword">this</span>.<span class="cm-property">flicker</span> <span class="cm-operator">=</span> <span class="cm-operator">-</span><span class="cm-number">0.5</span>;
    <span class="cm-variable-2">o</span> <span class="cm-operator">+=</span> <span class="cm-keyword">this</span>.<span class="cm-property">flicker</span>;
    <span class="cm-keyword">if</span> (<span class="cm-variable-2">o</span> <span class="cm-operator">&gt;</span> <span class="cm-number">1</span>) <span class="cm-variable-2">o</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>;
    <span class="cm-keyword">if</span> (<span class="cm-variable-2">o</span> <span class="cm-operator">&lt;</span> <span class="cm-number">0</span>) <span class="cm-variable-2">o</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;
  }

  <span class="cm-variable">context</span>.<span class="cm-property">fillStyle</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">color</span>;
  <span class="cm-variable">context</span>.<span class="cm-property">globalAlpha</span> <span class="cm-operator">=</span> <span class="cm-variable-2">o</span>;
  <span class="cm-variable">context</span>.<span class="cm-property">beginPath</span>();
  <span class="cm-variable">context</span>.<span class="cm-property">arc</span>(<span class="cm-variable-2">pos</span>.<span class="cm-property">x</span>, <span class="cm-variable-2">pos</span>.<span class="cm-property">y</span>, <span class="cm-variable-2">r</span>, <span class="cm-number">0</span>, <span class="cm-number">2</span> <span class="cm-operator">*</span> <span class="cm-variable">Math</span>.<span class="cm-property">PI</span>, <span class="cm-atom">false</span>);
  <span class="cm-variable">context</span>.<span class="cm-property">fill</span>();
  <span class="cm-variable">context</span>.<span class="cm-property">closePath</span>();

  <span class="cm-keyword">if</span> (<span class="cm-variable">renderParticleGlare</span>) {
    <span class="cm-variable">context</span>.<span class="cm-property">globalAlpha</span> <span class="cm-operator">=</span> <span class="cm-variable-2">o</span> <span class="cm-operator">*</span> <span class="cm-variable">glareOpacityMultiplier</span>;
    <span class="cm-comment">/*</span>
<span class="cm-comment">    context.ellipse(pos.x, pos.y, r * 30, r, 90 * (Math.PI / 180), 0, 2 * Math.PI, false);</span>
<span class="cm-comment">    context.fill();</span>
<span class="cm-comment">    context.closePath();</span>
<span class="cm-comment">    */</span>
    <span class="cm-variable">context</span>.<span class="cm-property">ellipse</span>(<span class="cm-variable-2">pos</span>.<span class="cm-property">x</span>, <span class="cm-variable-2">pos</span>.<span class="cm-property">y</span>, <span class="cm-variable-2">r</span> <span class="cm-operator">*</span> <span class="cm-number">100</span>, <span class="cm-variable-2">r</span>, (<span class="cm-variable">glareAngle</span> <span class="cm-operator">-</span> ((<span class="cm-variable">nPos</span>.<span class="cm-property">x</span> <span class="cm-operator">-</span> <span class="cm-number">0.5</span>) <span class="cm-operator">*</span> <span class="cm-variable">noiseStrength</span> <span class="cm-operator">*</span> <span class="cm-variable">motion</span>)) <span class="cm-operator">*</span> (<span class="cm-variable">Math</span>.<span class="cm-property">PI</span> <span class="cm-operator">/</span> <span class="cm-number">180</span>), <span class="cm-number">0</span>, <span class="cm-number">2</span> <span class="cm-operator">*</span> <span class="cm-variable">Math</span>.<span class="cm-property">PI</span>, <span class="cm-atom">false</span>);
    <span class="cm-variable">context</span>.<span class="cm-property">fill</span>();
    <span class="cm-variable">context</span>.<span class="cm-property">closePath</span>();
  }

  <span class="cm-variable">context</span>.<span class="cm-property">globalAlpha</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>;
};

<span class="cm-comment">// Flare class</span>
<span class="cm-keyword">var</span> <span class="cm-def">Flare</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span>() {
  <span class="cm-keyword">this</span>.<span class="cm-property">x</span> <span class="cm-operator">=</span> <span class="cm-variable">random</span>(<span class="cm-operator">-</span><span class="cm-number">0.25</span>, <span class="cm-number">1.25</span>, <span class="cm-atom">true</span>);
  <span class="cm-keyword">this</span>.<span class="cm-property">y</span> <span class="cm-operator">=</span> <span class="cm-variable">random</span>(<span class="cm-operator">-</span><span class="cm-number">0.25</span>, <span class="cm-number">1.25</span>, <span class="cm-atom">true</span>);
  <span class="cm-keyword">this</span>.<span class="cm-property">z</span> <span class="cm-operator">=</span> <span class="cm-variable">random</span>(<span class="cm-number">0</span>,<span class="cm-number">2</span>);
  <span class="cm-keyword">this</span>.<span class="cm-property">color</span> <span class="cm-operator">=</span> <span class="cm-variable">color</span>;
  <span class="cm-keyword">this</span>.<span class="cm-property">opacity</span> <span class="cm-operator">=</span> <span class="cm-variable">random</span>(<span class="cm-number">0.001</span>, <span class="cm-number">0.01</span>, <span class="cm-atom">true</span>);
};
<span class="cm-variable">Flare</span>.<span class="cm-property">prototype</span>.<span class="cm-property">render</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span>() {
  <span class="cm-keyword">var</span> <span class="cm-def">pos</span> <span class="cm-operator">=</span> <span class="cm-variable">position</span>(<span class="cm-keyword">this</span>.<span class="cm-property">x</span>, <span class="cm-keyword">this</span>.<span class="cm-property">y</span>, <span class="cm-keyword">this</span>.<span class="cm-property">z</span>),
    <span class="cm-def">r</span> <span class="cm-operator">=</span> ((<span class="cm-keyword">this</span>.<span class="cm-property">z</span> <span class="cm-operator">*</span> <span class="cm-variable">flareSizeMultiplier</span>) <span class="cm-operator">+</span> <span class="cm-variable">flareSizeBase</span>) <span class="cm-operator">*</span> (<span class="cm-variable">sizeRatio</span>() <span class="cm-operator">/</span> <span class="cm-number">1000</span>);

  <span class="cm-comment">// Feathered circles</span>
  <span class="cm-comment">/*</span>
<span class="cm-comment">  var grad = context.createRadialGradient(x+r,y+r,0,x+r,y+r,r);</span>
<span class="cm-comment">  grad.addColorStop(0, 'rgba(255,255,255,'+f.o+')');</span>
<span class="cm-comment">  grad.addColorStop(0.8, 'rgba(255,255,255,'+f.o+')');</span>
<span class="cm-comment">  grad.addColorStop(1, 'rgba(255,255,255,0)');</span>
<span class="cm-comment">  context.fillStyle = grad;</span>
<span class="cm-comment">  context.beginPath();</span>
<span class="cm-comment">  context.fillRect(x, y, r*2, r*2);</span>
<span class="cm-comment">  context.closePath();</span>
<span class="cm-comment">  */</span>

  <span class="cm-variable">context</span>.<span class="cm-property">beginPath</span>();
  <span class="cm-variable">context</span>.<span class="cm-property">globalAlpha</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">opacity</span>;
  <span class="cm-variable">context</span>.<span class="cm-property">arc</span>(<span class="cm-variable-2">pos</span>.<span class="cm-property">x</span>, <span class="cm-variable-2">pos</span>.<span class="cm-property">y</span>, <span class="cm-variable-2">r</span>, <span class="cm-number">0</span>, <span class="cm-number">2</span> <span class="cm-operator">*</span> <span class="cm-variable">Math</span>.<span class="cm-property">PI</span>, <span class="cm-atom">false</span>);
  <span class="cm-variable">context</span>.<span class="cm-property">fillStyle</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">color</span>;
  <span class="cm-variable">context</span>.<span class="cm-property">fill</span>();
  <span class="cm-variable">context</span>.<span class="cm-property">closePath</span>();
  <span class="cm-variable">context</span>.<span class="cm-property">globalAlpha</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>;
};

<span class="cm-comment">// Link class</span>
<span class="cm-keyword">var</span> <span class="cm-def">Link</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span>(<span class="cm-def">startVertex</span>, <span class="cm-def">numPoints</span>) {
  <span class="cm-keyword">this</span>.<span class="cm-property">length</span> <span class="cm-operator">=</span> <span class="cm-variable-2">numPoints</span>;
  <span class="cm-keyword">this</span>.<span class="cm-property">verts</span> <span class="cm-operator">=</span> [<span class="cm-variable-2">startVertex</span>];
  <span class="cm-keyword">this</span>.<span class="cm-property">stage</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;
  <span class="cm-keyword">this</span>.<span class="cm-property">linked</span> <span class="cm-operator">=</span> [<span class="cm-variable-2">startVertex</span>];
  <span class="cm-keyword">this</span>.<span class="cm-property">distances</span> <span class="cm-operator">=</span> [];
  <span class="cm-keyword">this</span>.<span class="cm-property">traveled</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;
  <span class="cm-keyword">this</span>.<span class="cm-property">fade</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;
  <span class="cm-keyword">this</span>.<span class="cm-property">finished</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;
};
<span class="cm-variable">Link</span>.<span class="cm-property">prototype</span>.<span class="cm-property">render</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span>() {
  <span class="cm-comment">// Stages:</span>
  <span class="cm-comment">// 0. Vertex collection</span>
  <span class="cm-comment">// 1. Render line reaching from vertex to vertex</span>
  <span class="cm-comment">// 2. Fade out</span>
  <span class="cm-comment">// 3. Finished (delete me)</span>

  <span class="cm-keyword">var</span> <span class="cm-def">i</span>, <span class="cm-def">p</span>, <span class="cm-def">pos</span>, <span class="cm-def">points</span>;

  <span class="cm-keyword">switch</span> (<span class="cm-keyword">this</span>.<span class="cm-property">stage</span>) {
    <span class="cm-comment">// VERTEX COLLECTION STAGE</span>
    <span class="cm-keyword">case</span> <span class="cm-number">0</span>:

      <span class="cm-comment">// Grab the last member of the link</span>
      <span class="cm-keyword">var</span> <span class="cm-def">last</span> <span class="cm-operator">=</span> <span class="cm-variable">particles</span>[<span class="cm-keyword">this</span>.<span class="cm-property">verts</span>[<span class="cm-keyword">this</span>.<span class="cm-property">verts</span>.<span class="cm-property">length</span><span class="cm-operator">-</span><span class="cm-number">1</span>]];
      <span class="cm-comment">//console.log(JSON.stringify(last));</span>
      <span class="cm-keyword">if</span> (<span class="cm-variable-2">last</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable-2">last</span>.<span class="cm-property">neighbors</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable-2">last</span>.<span class="cm-property">neighbors</span>.<span class="cm-property">length</span> <span class="cm-operator">&gt;</span> <span class="cm-number">0</span>) {
        <span class="cm-comment">// Grab a random neighbor</span>
        <span class="cm-keyword">var</span> <span class="cm-def">neighbor</span> <span class="cm-operator">=</span> <span class="cm-variable-2">last</span>.<span class="cm-property">neighbors</span>[<span class="cm-variable">random</span>(<span class="cm-number">0</span>, <span class="cm-variable-2">last</span>.<span class="cm-property">neighbors</span>.<span class="cm-property">length</span><span class="cm-operator">-</span><span class="cm-number">1</span>)];
        <span class="cm-comment">// If we haven't seen that particle before, add it to the link</span>
        <span class="cm-keyword">if</span> (<span class="cm-keyword">this</span>.<span class="cm-property">verts</span>.<span class="cm-property">indexOf</span>(<span class="cm-variable-2">neighbor</span>) <span class="cm-operator">==</span> <span class="cm-operator">-</span><span class="cm-number">1</span>) {
          <span class="cm-keyword">this</span>.<span class="cm-property">verts</span>.<span class="cm-property">push</span>(<span class="cm-variable-2">neighbor</span>);
        }
        <span class="cm-comment">// If we have seen that particle before, we'll just wait for the next frame</span>
      }
      <span class="cm-keyword">else</span> {
        <span class="cm-comment">//console.log(this.verts[0]+' prematurely moving to stage 3 (0)');</span>
        <span class="cm-keyword">this</span>.<span class="cm-property">stage</span> <span class="cm-operator">=</span> <span class="cm-number">3</span>;
        <span class="cm-keyword">this</span>.<span class="cm-property">finished</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;
      }

      <span class="cm-keyword">if</span> (<span class="cm-keyword">this</span>.<span class="cm-property">verts</span>.<span class="cm-property">length</span> <span class="cm-operator">&gt;=</span> <span class="cm-keyword">this</span>.<span class="cm-property">length</span>) {
        <span class="cm-comment">// Calculate all distances at once</span>
        <span class="cm-keyword">for</span> (<span class="cm-variable-2">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable-2">i</span> <span class="cm-operator">&lt;</span> <span class="cm-keyword">this</span>.<span class="cm-property">verts</span>.<span class="cm-property">length</span><span class="cm-operator">-</span><span class="cm-number">1</span>; <span class="cm-variable-2">i</span><span class="cm-operator">++</span>) {
          <span class="cm-keyword">var</span> <span class="cm-def">p1</span> <span class="cm-operator">=</span> <span class="cm-variable">particles</span>[<span class="cm-keyword">this</span>.<span class="cm-property">verts</span>[<span class="cm-variable-2">i</span>]],
            <span class="cm-def">p2</span> <span class="cm-operator">=</span> <span class="cm-variable">particles</span>[<span class="cm-keyword">this</span>.<span class="cm-property">verts</span>[<span class="cm-variable-2">i</span><span class="cm-operator">+</span><span class="cm-number">1</span>]],
            <span class="cm-def">dx</span> <span class="cm-operator">=</span> <span class="cm-variable-2">p1</span>.<span class="cm-property">x</span> <span class="cm-operator">-</span> <span class="cm-variable-2">p2</span>.<span class="cm-property">x</span>,
            <span class="cm-def">dy</span> <span class="cm-operator">=</span> <span class="cm-variable-2">p1</span>.<span class="cm-property">y</span> <span class="cm-operator">-</span> <span class="cm-variable-2">p2</span>.<span class="cm-property">y</span>,
            <span class="cm-def">dist</span> <span class="cm-operator">=</span> <span class="cm-variable">Math</span>.<span class="cm-property">sqrt</span>(<span class="cm-variable-2">dx</span><span class="cm-operator">*</span><span class="cm-variable-2">dx</span> <span class="cm-operator">+</span> <span class="cm-variable-2">dy</span><span class="cm-operator">*</span><span class="cm-variable-2">dy</span>);

            <span class="cm-keyword">this</span>.<span class="cm-property">distances</span>.<span class="cm-property">push</span>(<span class="cm-variable-2">dist</span>);
        }
        <span class="cm-comment">//console.log('Distances: '+JSON.stringify(this.distances));</span>
        <span class="cm-comment">//console.log('verts: '+this.verts.length+' distances: '+this.distances.length);</span>

        <span class="cm-comment">//console.log(this.verts[0]+' moving to stage 1');</span>
        <span class="cm-keyword">this</span>.<span class="cm-property">stage</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>;
      }
    <span class="cm-keyword">break</span>;

    <span class="cm-comment">// RENDER LINE ANIMATION STAGE</span>
    <span class="cm-keyword">case</span> <span class="cm-number">1</span>:
      <span class="cm-keyword">if</span> (<span class="cm-keyword">this</span>.<span class="cm-property">distances</span>.<span class="cm-property">length</span> <span class="cm-operator">&gt;</span> <span class="cm-number">0</span>) {

        <span class="cm-variable-2">points</span> <span class="cm-operator">=</span> [];
        <span class="cm-comment">//var a = 1;</span>

        <span class="cm-comment">// Gather all points already linked</span>
        <span class="cm-keyword">for</span> (<span class="cm-variable-2">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable-2">i</span> <span class="cm-operator">&lt;</span> <span class="cm-keyword">this</span>.<span class="cm-property">linked</span>.<span class="cm-property">length</span>; <span class="cm-variable-2">i</span><span class="cm-operator">++</span>) {
          <span class="cm-variable-2">p</span> <span class="cm-operator">=</span> <span class="cm-variable">particles</span>[<span class="cm-keyword">this</span>.<span class="cm-property">linked</span>[<span class="cm-variable-2">i</span>]];
          <span class="cm-variable-2">pos</span> <span class="cm-operator">=</span> <span class="cm-variable">position</span>(<span class="cm-variable-2">p</span>.<span class="cm-property">x</span>, <span class="cm-variable-2">p</span>.<span class="cm-property">y</span>, <span class="cm-variable-2">p</span>.<span class="cm-property">z</span>);
          <span class="cm-variable-2">points</span>.<span class="cm-property">push</span>([<span class="cm-variable-2">pos</span>.<span class="cm-property">x</span>, <span class="cm-variable-2">pos</span>.<span class="cm-property">y</span>]);
        }

        <span class="cm-keyword">var</span> <span class="cm-def">linkSpeedRel</span> <span class="cm-operator">=</span> <span class="cm-variable">linkSpeed</span> <span class="cm-operator">*</span> <span class="cm-number">0.00001</span> <span class="cm-operator">*</span> <span class="cm-variable">canvas</span>.<span class="cm-property">width</span>;
        <span class="cm-keyword">this</span>.<span class="cm-property">traveled</span> <span class="cm-operator">+=</span> <span class="cm-variable-2">linkSpeedRel</span>;
        <span class="cm-keyword">var</span> <span class="cm-def">d</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">distances</span>[<span class="cm-keyword">this</span>.<span class="cm-property">linked</span>.<span class="cm-property">length</span><span class="cm-operator">-</span><span class="cm-number">1</span>];
        <span class="cm-comment">// Calculate last point based on linkSpeed and distance travelled to next point</span>
        <span class="cm-keyword">if</span> (<span class="cm-keyword">this</span>.<span class="cm-property">traveled</span> <span class="cm-operator">&gt;=</span> <span class="cm-variable-2">d</span>) {
          <span class="cm-keyword">this</span>.<span class="cm-property">traveled</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;
          <span class="cm-comment">// We've reached the next point, add coordinates to array</span>
          <span class="cm-comment">//console.log(this.verts[0]+' reached vertex '+(this.linked.length+1)+' of '+this.verts.length);</span>

          <span class="cm-keyword">this</span>.<span class="cm-property">linked</span>.<span class="cm-property">push</span>(<span class="cm-keyword">this</span>.<span class="cm-property">verts</span>[<span class="cm-keyword">this</span>.<span class="cm-property">linked</span>.<span class="cm-property">length</span>]);
          <span class="cm-variable-2">p</span> <span class="cm-operator">=</span> <span class="cm-variable">particles</span>[<span class="cm-keyword">this</span>.<span class="cm-property">linked</span>[<span class="cm-keyword">this</span>.<span class="cm-property">linked</span>.<span class="cm-property">length</span><span class="cm-operator">-</span><span class="cm-number">1</span>]];
          <span class="cm-variable-2">pos</span> <span class="cm-operator">=</span> <span class="cm-variable">position</span>(<span class="cm-variable-2">p</span>.<span class="cm-property">x</span>, <span class="cm-variable-2">p</span>.<span class="cm-property">y</span>, <span class="cm-variable-2">p</span>.<span class="cm-property">z</span>);
          <span class="cm-variable-2">points</span>.<span class="cm-property">push</span>([<span class="cm-variable-2">pos</span>.<span class="cm-property">x</span>, <span class="cm-variable-2">pos</span>.<span class="cm-property">y</span>]);

          <span class="cm-keyword">if</span> (<span class="cm-keyword">this</span>.<span class="cm-property">linked</span>.<span class="cm-property">length</span> <span class="cm-operator">&gt;=</span> <span class="cm-keyword">this</span>.<span class="cm-property">verts</span>.<span class="cm-property">length</span>) {
            <span class="cm-comment">//console.log(this.verts[0]+' moving to stage 2 (1)');</span>
            <span class="cm-keyword">this</span>.<span class="cm-property">stage</span> <span class="cm-operator">=</span> <span class="cm-number">2</span>;
          }
        }
        <span class="cm-keyword">else</span> {
          <span class="cm-comment">// We're still travelling to the next point, get coordinates at travel distance</span>
          <span class="cm-comment">// http://math.stackexchange.com/a/85582</span>
          <span class="cm-keyword">var</span> <span class="cm-def">a</span> <span class="cm-operator">=</span> <span class="cm-variable">particles</span>[<span class="cm-keyword">this</span>.<span class="cm-property">linked</span>[<span class="cm-keyword">this</span>.<span class="cm-property">linked</span>.<span class="cm-property">length</span><span class="cm-operator">-</span><span class="cm-number">1</span>]],
            <span class="cm-def">b</span> <span class="cm-operator">=</span> <span class="cm-variable">particles</span>[<span class="cm-keyword">this</span>.<span class="cm-property">verts</span>[<span class="cm-keyword">this</span>.<span class="cm-property">linked</span>.<span class="cm-property">length</span>]],
            <span class="cm-def">t</span> <span class="cm-operator">=</span> <span class="cm-variable-2">d</span> <span class="cm-operator">-</span> <span class="cm-keyword">this</span>.<span class="cm-property">traveled</span>,
            <span class="cm-def">x</span> <span class="cm-operator">=</span> ((<span class="cm-keyword">this</span>.<span class="cm-property">traveled</span> <span class="cm-operator">*</span> <span class="cm-variable-2">b</span>.<span class="cm-property">x</span>) <span class="cm-operator">+</span> (<span class="cm-variable-2">t</span> <span class="cm-operator">*</span> <span class="cm-variable-2">a</span>.<span class="cm-property">x</span>)) <span class="cm-operator">/</span> <span class="cm-variable-2">d</span>,
            <span class="cm-def">y</span> <span class="cm-operator">=</span> ((<span class="cm-keyword">this</span>.<span class="cm-property">traveled</span> <span class="cm-operator">*</span> <span class="cm-variable-2">b</span>.<span class="cm-property">y</span>) <span class="cm-operator">+</span> (<span class="cm-variable-2">t</span> <span class="cm-operator">*</span> <span class="cm-variable-2">a</span>.<span class="cm-property">y</span>)) <span class="cm-operator">/</span> <span class="cm-variable-2">d</span>,
            <span class="cm-def">z</span> <span class="cm-operator">=</span> ((<span class="cm-keyword">this</span>.<span class="cm-property">traveled</span> <span class="cm-operator">*</span> <span class="cm-variable-2">b</span>.<span class="cm-property">z</span>) <span class="cm-operator">+</span> (<span class="cm-variable-2">t</span> <span class="cm-operator">*</span> <span class="cm-variable-2">a</span>.<span class="cm-property">z</span>)) <span class="cm-operator">/</span> <span class="cm-variable-2">d</span>;

          <span class="cm-variable-2">pos</span> <span class="cm-operator">=</span> <span class="cm-variable">position</span>(<span class="cm-variable-2">x</span>, <span class="cm-variable-2">y</span>, <span class="cm-variable-2">z</span>);

          <span class="cm-comment">//console.log(this.verts[0]+' traveling to vertex '+(this.linked.length+1)+' of '+this.verts.length+' ('+this.traveled+' of '+this.distances[this.linked.length]+')');</span>

          <span class="cm-variable-2">points</span>.<span class="cm-property">push</span>([<span class="cm-variable-2">pos</span>.<span class="cm-property">x</span>, <span class="cm-variable-2">pos</span>.<span class="cm-property">y</span>]);
        }

        <span class="cm-keyword">this</span>.<span class="cm-property">drawLine</span>(<span class="cm-variable-2">points</span>);
      }
      <span class="cm-keyword">else</span> {
        <span class="cm-comment">//console.log(this.verts[0]+' prematurely moving to stage 3 (1)');</span>
        <span class="cm-keyword">this</span>.<span class="cm-property">stage</span> <span class="cm-operator">=</span> <span class="cm-number">3</span>;
        <span class="cm-keyword">this</span>.<span class="cm-property">finished</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;
      }
    <span class="cm-keyword">break</span>;

    <span class="cm-comment">// FADE OUT STAGE</span>
    <span class="cm-keyword">case</span> <span class="cm-number">2</span>:
      <span class="cm-keyword">if</span> (<span class="cm-keyword">this</span>.<span class="cm-property">verts</span>.<span class="cm-property">length</span> <span class="cm-operator">&gt;</span> <span class="cm-number">1</span>) {
        <span class="cm-keyword">if</span> (<span class="cm-keyword">this</span>.<span class="cm-property">fade</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">linkFade</span>) {
          <span class="cm-keyword">this</span>.<span class="cm-property">fade</span><span class="cm-operator">++</span>;

          <span class="cm-comment">// Render full link between all vertices and fade over time</span>
          <span class="cm-variable-2">points</span> <span class="cm-operator">=</span> [];
          <span class="cm-keyword">var</span> <span class="cm-def">alpha</span> <span class="cm-operator">=</span> (<span class="cm-number">1</span> <span class="cm-operator">-</span> (<span class="cm-keyword">this</span>.<span class="cm-property">fade</span> <span class="cm-operator">/</span> <span class="cm-variable">linkFade</span>)) <span class="cm-operator">*</span> <span class="cm-variable">linkOpacity</span>;
          <span class="cm-keyword">for</span> (<span class="cm-variable-2">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable-2">i</span> <span class="cm-operator">&lt;</span> <span class="cm-keyword">this</span>.<span class="cm-property">verts</span>.<span class="cm-property">length</span>; <span class="cm-variable-2">i</span><span class="cm-operator">++</span>) {
            <span class="cm-variable-2">p</span> <span class="cm-operator">=</span> <span class="cm-variable">particles</span>[<span class="cm-keyword">this</span>.<span class="cm-property">verts</span>[<span class="cm-variable-2">i</span>]];
            <span class="cm-variable-2">pos</span> <span class="cm-operator">=</span> <span class="cm-variable">position</span>(<span class="cm-variable-2">p</span>.<span class="cm-property">x</span>, <span class="cm-variable-2">p</span>.<span class="cm-property">y</span>, <span class="cm-variable-2">p</span>.<span class="cm-property">z</span>);
            <span class="cm-variable-2">points</span>.<span class="cm-property">push</span>([<span class="cm-variable-2">pos</span>.<span class="cm-property">x</span>, <span class="cm-variable-2">pos</span>.<span class="cm-property">y</span>]);
          }
          <span class="cm-keyword">this</span>.<span class="cm-property">drawLine</span>(<span class="cm-variable-2">points</span>, <span class="cm-variable-2">alpha</span>);
        }
        <span class="cm-keyword">else</span> {
          <span class="cm-comment">//console.log(this.verts[0]+' moving to stage 3 (2a)');</span>
          <span class="cm-keyword">this</span>.<span class="cm-property">stage</span> <span class="cm-operator">=</span> <span class="cm-number">3</span>;
          <span class="cm-keyword">this</span>.<span class="cm-property">finished</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;
        }
      }
      <span class="cm-keyword">else</span> {
        <span class="cm-comment">//console.log(this.verts[0]+' prematurely moving to stage 3 (2b)');</span>
        <span class="cm-keyword">this</span>.<span class="cm-property">stage</span> <span class="cm-operator">=</span> <span class="cm-number">3</span>;
        <span class="cm-keyword">this</span>.<span class="cm-property">finished</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;
      }
    <span class="cm-keyword">break</span>;

    <span class="cm-comment">// FINISHED STAGE</span>
    <span class="cm-keyword">case</span> <span class="cm-number">3</span>:
    <span class="cm-keyword">default</span>:
      <span class="cm-keyword">this</span>.<span class="cm-property">finished</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;
    <span class="cm-keyword">break</span>;
  }
};
<span class="cm-variable">Link</span>.<span class="cm-property">prototype</span>.<span class="cm-property">drawLine</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span>(<span class="cm-def">points</span>, <span class="cm-def">alpha</span>) {
  <span class="cm-keyword">if</span> (<span class="cm-keyword">typeof</span> <span class="cm-variable-2">alpha</span> <span class="cm-operator">!==</span> <span class="cm-string">'number'</span>) <span class="cm-variable-2">alpha</span> <span class="cm-operator">=</span> <span class="cm-variable">linkOpacity</span>;

  <span class="cm-keyword">if</span> (<span class="cm-variable-2">points</span>.<span class="cm-property">length</span> <span class="cm-operator">&gt;</span> <span class="cm-number">1</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable-2">alpha</span> <span class="cm-operator">&gt;</span> <span class="cm-number">0</span>) {
    <span class="cm-comment">//console.log(this.verts[0]+': Drawing line '+alpha);</span>
    <span class="cm-variable">context</span>.<span class="cm-property">globalAlpha</span> <span class="cm-operator">=</span> <span class="cm-variable-2">alpha</span>;
    <span class="cm-variable">context</span>.<span class="cm-property">beginPath</span>();
    <span class="cm-keyword">for</span> (<span class="cm-keyword">var</span> <span class="cm-def">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable-2">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable-2">points</span>.<span class="cm-property">length</span><span class="cm-operator">-</span><span class="cm-number">1</span>; <span class="cm-variable-2">i</span><span class="cm-operator">++</span>) {
      <span class="cm-variable">context</span>.<span class="cm-property">moveTo</span>(<span class="cm-variable-2">points</span>[<span class="cm-variable-2">i</span>][<span class="cm-number">0</span>], <span class="cm-variable-2">points</span>[<span class="cm-variable-2">i</span>][<span class="cm-number">1</span>]);
      <span class="cm-variable">context</span>.<span class="cm-property">lineTo</span>(<span class="cm-variable-2">points</span>[<span class="cm-variable-2">i</span><span class="cm-operator">+</span><span class="cm-number">1</span>][<span class="cm-number">0</span>], <span class="cm-variable-2">points</span>[<span class="cm-variable-2">i</span><span class="cm-operator">+</span><span class="cm-number">1</span>][<span class="cm-number">1</span>]);
    }
    <span class="cm-variable">context</span>.<span class="cm-property">strokeStyle</span> <span class="cm-operator">=</span> <span class="cm-variable">color</span>;
    <span class="cm-variable">context</span>.<span class="cm-property">lineWidth</span> <span class="cm-operator">=</span> <span class="cm-variable">lineWidth</span>;
    <span class="cm-variable">context</span>.<span class="cm-property">stroke</span>();
    <span class="cm-variable">context</span>.<span class="cm-property">closePath</span>();
    <span class="cm-variable">context</span>.<span class="cm-property">globalAlpha</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>;
  }
};


<span class="cm-comment">// Utils</span>

<span class="cm-keyword">function</span> <span class="cm-def">noisePoint</span>(<span class="cm-def">i</span>) {
  <span class="cm-keyword">var</span> <span class="cm-def">a</span> <span class="cm-operator">=</span> <span class="cm-variable">nAngle</span> <span class="cm-operator">*</span> <span class="cm-variable-2">i</span>,
    <span class="cm-def">cosA</span> <span class="cm-operator">=</span> <span class="cm-variable">Math</span>.<span class="cm-property">cos</span>(<span class="cm-variable-2">a</span>),
    <span class="cm-def">sinA</span> <span class="cm-operator">=</span> <span class="cm-variable">Math</span>.<span class="cm-property">sin</span>(<span class="cm-variable-2">a</span>),
    <span class="cm-comment">//value = simplex.noise2D(nScale * cosA + nScale, nScale * sinA + nScale),</span>
    <span class="cm-comment">//rad = nRad + value;</span>
    <span class="cm-def">rad</span> <span class="cm-operator">=</span> <span class="cm-variable">nRad</span>;
  <span class="cm-keyword">return</span> {
    <span class="cm-property">x</span>: <span class="cm-variable-2">rad</span> <span class="cm-operator">*</span> <span class="cm-variable-2">cosA</span>,
    <span class="cm-property">y</span>: <span class="cm-variable-2">rad</span> <span class="cm-operator">*</span> <span class="cm-variable-2">sinA</span>
  };
}

<span class="cm-keyword">function</span> <span class="cm-def">position</span>(<span class="cm-def">x</span>, <span class="cm-def">y</span>, <span class="cm-def">z</span>) {
  <span class="cm-keyword">return</span> {
    <span class="cm-property">x</span>: (<span class="cm-variable-2">x</span> <span class="cm-operator">*</span> <span class="cm-variable">canvas</span>.<span class="cm-property">width</span>) <span class="cm-operator">+</span> ((((<span class="cm-variable">canvas</span>.<span class="cm-property">width</span> <span class="cm-operator">/</span> <span class="cm-number">2</span>) <span class="cm-operator">-</span> <span class="cm-variable">mouse</span>.<span class="cm-property">x</span> <span class="cm-operator">+</span> ((<span class="cm-variable">nPos</span>.<span class="cm-property">x</span> <span class="cm-operator">-</span> <span class="cm-number">0.5</span>) <span class="cm-operator">*</span> <span class="cm-variable">noiseStrength</span>)) <span class="cm-operator">*</span> <span class="cm-variable-2">z</span>) <span class="cm-operator">*</span> <span class="cm-variable">motion</span>),
    <span class="cm-property">y</span>: (<span class="cm-variable-2">y</span> <span class="cm-operator">*</span> <span class="cm-variable">canvas</span>.<span class="cm-property">height</span>) <span class="cm-operator">+</span> ((((<span class="cm-variable">canvas</span>.<span class="cm-property">height</span> <span class="cm-operator">/</span> <span class="cm-number">2</span>) <span class="cm-operator">-</span> <span class="cm-variable">mouse</span>.<span class="cm-property">y</span> <span class="cm-operator">+</span> ((<span class="cm-variable">nPos</span>.<span class="cm-property">y</span> <span class="cm-operator">-</span> <span class="cm-number">0.5</span>) <span class="cm-operator">*</span> <span class="cm-variable">noiseStrength</span>)) <span class="cm-operator">*</span> <span class="cm-variable-2">z</span>) <span class="cm-operator">*</span> <span class="cm-variable">motion</span>)
  };
}

<span class="cm-keyword">function</span> <span class="cm-def">sizeRatio</span>() {
  <span class="cm-keyword">return</span> <span class="cm-variable">canvas</span>.<span class="cm-property">width</span> <span class="cm-operator">&gt;=</span> <span class="cm-variable">canvas</span>.<span class="cm-property">height</span> <span class="cm-operator">?</span> <span class="cm-variable">canvas</span>.<span class="cm-property">width</span> : <span class="cm-variable">canvas</span>.<span class="cm-property">height</span>;
}

<span class="cm-keyword">function</span> <span class="cm-def">random</span>(<span class="cm-def">min</span>, <span class="cm-def">max</span>, <span class="cm-def">float</span>) {
  <span class="cm-keyword">return</span> <span class="cm-variable-2">float</span> <span class="cm-operator">?</span>
    <span class="cm-variable">Math</span>.<span class="cm-property">random</span>() <span class="cm-operator">*</span> (<span class="cm-variable-2">max</span> <span class="cm-operator">-</span> <span class="cm-variable-2">min</span>) <span class="cm-operator">+</span> <span class="cm-variable-2">min</span> :
    <span class="cm-variable">Math</span>.<span class="cm-property">floor</span>(<span class="cm-variable">Math</span>.<span class="cm-property">random</span>() <span class="cm-operator">*</span> (<span class="cm-variable-2">max</span> <span class="cm-operator">-</span> <span class="cm-variable-2">min</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>)) <span class="cm-operator">+</span> <span class="cm-variable-2">min</span>;
}


<span class="cm-comment">// init</span>
<span class="cm-keyword">if</span> (<span class="cm-variable">canvas</span>) <span class="cm-variable">init</span>();
</code></pre>

        </div>



    <div id="result-box" class="code-box active zoom-1" role="region" aria-label="Result">


  <iframe allow="accelerometer *; bluetooth *; camera *; encrypted-media *; display-capture *; geolocation *; gyroscope *; microphone *; midi *; clipboard-read *; clipboard-write *; web-share *; serial *; xr-spatial-tracking *" allowfullscreen="true" allowpaymentrequest="true" allowtransparency="true" class="result-iframe  " frameborder="0" id="result-iframe" loading="lazy" name="CodePen Preview for Drifter Stars" sandbox="allow-downloads allow-forms allow-modals allow-pointer-lock allow-popups-to-escape-sandbox allow-popups allow-presentation allow-same-origin allow-scripts allow-top-navigation-by-user-activation" scrolling="yes" title="CodePen Preview for Drifter Stars" data-src="https://codepen.io/cr0ybot/fullembedgrid/zNyYeW?animations=run&amp;type=embed" src="./zNyYeW(1).html">
  </iframe>


</div>


    <div id="about-box">

  <div class="about-container">


    <div class="about-user">

        <a href="https://codepen.io/cr0ybot" target="_blank" rel="noopener"><img src="./default(24).png" loading="lazy" alt="" class="about-image"></a>

      <div class="about-user-info">


        <p>
          This Pen is owned by <a href="https://codepen.io/cr0ybot" target="_blank" rel="noopener">Cory Hughart</a> on <a href="https://codepen.io/" target="_blank" rel="noopener">CodePen</a>.

        </p>

        <p>
          <a href="https://codepen.io/cr0ybot" target="_blank" rel="noopener" class="about-user-more">
          See more by @cr0ybot on CodePen
          </a>
        </p>


      </div>

    </div>


  </div>

</div>


    <div id="resources-box" class="resources-box">

  <h3>External CSS</h3>
    <p>
      This Pen doesn't use any external CSS resources.
    </p>

  <h3>External JavaScript</h3>
    <ol class="list-of-resources">
        <li>
          <a href="http://requirejs.org/docs/release/2.1.15/minified/require.js" target="_blank">http://requirejs.org/docs/release/2.1.15/minified/require.js</a>
        </li>
        <li>
          <a href="https://rawgit.com/ironwallaby/delaunay/master/delaunay.js" target="_blank">https://rawgit.com/ironwallaby/delaunay/master/delaunay.js</a>
        </li>
    </ol>

</div>


  </div>

    <footer class="embed-footer" id="embed-footer">

    <button id="resources-link" class="resources-link action-button bottom left" href="#resources-box" aria-pressed="false" role="button">
      Resources
    </button>

    <ul class="scaling-choices bottom right">
  <li><button class="action-button" id="zoom-button-1">1</button></li>
  <li><button class="action-button" id="zoom-button-05">0.5</button></li>
  <li><button class="action-button" id="zoom-button-025">0.25</button></li>
</ul>

<button id="rerun-button" class="action-button rerun-button bottom right">
  Rerun
</button>

  </footer>



  <script nonce="">
    __processedPen = {"html":"&lt;canvas id=&quot;stars&quot; width=&quot;300&quot; height=&quot;300&quot;&gt;&lt;/canvas&gt;","css":"html,\nbody {\n  margin: 0;\n  padding: 0;\n}\n\nbody {\n  background-color: #31102F;\n  background: radial-gradient(ellipse at center, #31102f 0%, #280b29 100%);\n}\n\n#stars {\n  display: block;\n  position: relative;\n  width: 100%;\n  height: 16rem;\n  height: 100vh;\n  z-index: 1;\n}","js":"/**\n * Stars\n * Inspired by Steve Courtney&#39;s poster art for Celsius GS&#39;s Drifter - http://celsiusgs.com/drifter/posters.php\n * by Cory Hughart - http://coryhughart.com\n */\n\n// Settings\nvar particleCount = 40,\nflareCount = 10,\nmotion = 0.05,\ntilt = 0.05,\ncolor = &#39;#FFEED4&#39;,\nparticleSizeBase = 1,\nparticleSizeMultiplier = 0.5,\nflareSizeBase = 100,\nflareSizeMultiplier = 100,\nlineWidth = 1,\nlinkChance = 75, // chance per frame of link, higher = smaller chance\nlinkLengthMin = 5, // min linked vertices\nlinkLengthMax = 7, // max linked vertices\nlinkOpacity = 0.25; // number between 0 &amp; 1\nlinkFade = 90, // link fade-out frames\nlinkSpeed = 1, // distance a link travels in 1 frame\nglareAngle = -60,\nglareOpacityMultiplier = 0.05,\nrenderParticles = true,\nrenderParticleGlare = true,\nrenderFlares = true,\nrenderLinks = true,\nrenderMesh = false,\nflicker = true,\nflickerSmoothing = 15, // higher = smoother flicker\nblurSize = 0,\norbitTilt = true,\nrandomMotion = true,\nnoiseLength = 1000,\nnoiseStrength = 1;\n\nvar canvas = document.getElementById(&#39;stars&#39;),\n//orbits = document.getElementById(&#39;orbits&#39;),\ncontext = canvas.getContext(&#39;2d&#39;),\nmouse = { x: 0, y: 0 },\nm = {},\nr = 0,\nc = 1000, // multiplier for delaunay points, since floats too small can mess up the algorithm\nn = 0,\nnAngle = Math.PI * 2 / noiseLength,\nnRad = 100,\nnScale = 0.5,\nnPos = { x: 0, y: 0 },\npoints = [],\nvertices = [],\ntriangles = [],\nlinks = [],\nparticles = [],\nflares = [];\n\nfunction init() {\n  var i, j, k;\n\n  // requestAnimFrame polyfill\n  window.requestAnimFrame = function () {\n    return window.requestAnimationFrame ||\n    window.webkitRequestAnimationFrame ||\n    window.mozRequestAnimationFrame ||\n    function (callback) {\n      window.setTimeout(callback, 1000 / 60);\n    };\n  }();\n\n  // Fade in background\n  /*\n  var background = document.getElementById(&#39;background&#39;),\n  \tbgImg = new Image(),\n  \tbgURL = &#39;/img/background.jpg&#39;;\n  bgImg.onload = function() {\n  \t//console.log(&#39;background loaded&#39;);\n  \tbackground.style.backgroundImage = &#39;url(&quot;&#39;+bgURL+&#39;&quot;)&#39;;\n  \tbackground.className += &#39; loaded&#39;;\n  }\n  bgImg.src = bgURL;\n  */\n\n  // Size canvas\n  resize();\n\n  mouse.x = canvas.clientWidth / 2;\n  mouse.y = canvas.clientHeight / 2;\n\n  // Create particle positions\n  for (i = 0; i &lt; particleCount; i++) {\n    var p = new Particle();\n    particles.push(p);\n    points.push([p.x * c, p.y * c]);\n  }\n\n  //console.log(JSON.stringify(points));\n\n  // Delaunay triangulation\n  //var Delaunay = require(&#39;delaunay-fast&#39;);\n  vertices = Delaunay.triangulate(points);\n  //console.log(JSON.stringify(vertices));\n  // Create an array of &quot;triangles&quot; (groups of 3 indices)\n  var tri = [];\n  for (i = 0; i &lt; vertices.length; i++) {\n    if (tri.length == 3) {\n      triangles.push(tri);\n      tri = [];\n    }\n    tri.push(vertices[i]);\n  }\n  //console.log(JSON.stringify(triangles));\n\n  // Tell all the particles who their neighbors are\n  for (i = 0; i &lt; particles.length; i++) {\n    // Loop through all tirangles\n    for (j = 0; j &lt; triangles.length; j++) {\n      // Check if this particle&#39;s index is in this triangle\n      k = triangles[j].indexOf(i);\n      // If it is, add its neighbors to the particles contacts list\n      if (k !== -1) {\n        triangles[j].forEach(function (value, index, array) {\n          if (value !== i &amp;&amp; particles[i].neighbors.indexOf(value) == -1) {\n            particles[i].neighbors.push(value);\n          }\n        });\n      }\n    }\n  }\n  //console.log(JSON.stringify(particles));\n\n  if (renderFlares) {\n    // Create flare positions\n    for (i = 0; i &lt; flareCount; i++) {\n      flares.push(new Flare());\n    }\n  }\n\n  // Motion mode\n  //if (Modernizr &amp;&amp; Modernizr.deviceorientation) {\n  if (&#39;ontouchstart&#39; in document.documentElement &amp;&amp; window.DeviceOrientationEvent) {\n    console.log(&#39;Using device orientation&#39;);\n    window.addEventListener(&#39;deviceorientation&#39;, function (e) {\n      mouse.x = canvas.clientWidth / 2 - e.gamma / 90 * (canvas.clientWidth / 2) * 2;\n      mouse.y = canvas.clientHeight / 2 - e.beta / 90 * (canvas.clientHeight / 2) * 2;\n      //console.log(&#39;Center: x:&#39;+(canvas.clientWidth/2)+&#39; y:&#39;+(canvas.clientHeight/2));\n      //console.log(&#39;Orientation: x:&#39;+mouse.x+&#39; (&#39;+e.gamma+&#39;) y:&#39;+mouse.y+&#39; (&#39;+e.beta+&#39;)&#39;);\n    }, true);\n  } else\n  {\n    // Mouse move listener\n    console.log(&#39;Using mouse movement&#39;);\n    document.body.addEventListener(&#39;mousemove&#39;, function (e) {\n      //console.log(&#39;moved&#39;);\n      mouse.x = e.clientX;\n      mouse.y = e.clientY;\n    });\n  }\n\n  // Random motion\n  if (randomMotion) {\n    //var SimplexNoise = require(&#39;simplex-noise&#39;);\n    //var simplex = new SimplexNoise();\n  }\n\n  // Animation loop\n  (function animloop() {\n    requestAnimFrame(animloop);\n    resize();\n    render();\n  })();\n}\n\nfunction render() {\n  if (randomMotion) {\n    n++;\n    if (n &gt;= noiseLength) {\n      n = 0;\n    }\n\n    nPos = noisePoint(n);\n    //console.log(&#39;NOISE x:&#39;+nPos.x+&#39; y:&#39;+nPos.y);\n  }\n\n  // Clear\n  context.clearRect(0, 0, canvas.width, canvas.height);\n\n  if (blurSize &gt; 0) {\n    context.shadowBlur = blurSize;\n    context.shadowColor = color;\n  }\n\n  if (renderParticles) {\n    // Render particles\n    for (var i = 0; i &lt; particleCount; i++) {\n      particles[i].render();\n    }\n  }\n\n  if (renderMesh) {\n    // Render all lines\n    context.beginPath();\n    for (var v = 0; v &lt; vertices.length - 1; v++) {\n      // Splits the array into triplets\n      if ((v + 1) % 3 === 0) {continue;}\n\n      var p1 = particles[vertices[v]],\n      p2 = particles[vertices[v + 1]];\n\n      //console.log(&#39;Line: &#39;+p1.x+&#39;,&#39;+p1.y+&#39;-&gt;&#39;+p2.x+&#39;,&#39;+p2.y);\n\n      var pos1 = position(p1.x, p1.y, p1.z),\n      pos2 = position(p2.x, p2.y, p2.z);\n\n      context.moveTo(pos1.x, pos1.y);\n      context.lineTo(pos2.x, pos2.y);\n    }\n    context.strokeStyle = color;\n    context.lineWidth = lineWidth;\n    context.stroke();\n    context.closePath();\n  }\n\n  if (renderLinks) {\n    // Possibly start a new link\n    if (random(0, linkChance) == linkChance) {\n      var length = random(linkLengthMin, linkLengthMax);\n      var start = random(0, particles.length - 1);\n      startLink(start, length);\n    }\n\n    // Render existing links\n    // Iterate in reverse so that removing items doesn&#39;t affect the loop\n    for (var l = links.length - 1; l &gt;= 0; l--) {\n      if (links[l] &amp;&amp; !links[l].finished) {\n        links[l].render();\n      } else\n      {\n        delete links[l];\n      }\n    }\n  }\n\n  if (renderFlares) {\n    // Render flares\n    for (var j = 0; j &lt; flareCount; j++) {\n      flares[j].render();\n    }\n  }\n\n  /*\n  if (orbitTilt) {\n  \tvar tiltX = -(((canvas.clientWidth / 2) - mouse.x + ((nPos.x - 0.5) * noiseStrength)) * tilt),\n  \t\ttiltY = (((canvas.clientHeight / 2) - mouse.y + ((nPos.y - 0.5) * noiseStrength)) * tilt);\n  \t\torbits.style.transform = &#39;rotateY(&#39;+tiltX+&#39;deg) rotateX(&#39;+tiltY+&#39;deg)&#39;;\n  }\n  */\n\n}\n\nfunction resize() {\n  canvas.width = window.innerWidth * (window.devicePixelRatio || 1);\n  canvas.height = canvas.width * (canvas.clientHeight / canvas.clientWidth);\n}\n\nfunction startLink(vertex, length) {\n  //console.log(&#39;LINK from &#39;+vertex+&#39; (length &#39;+length+&#39;)&#39;);\n  links.push(new Link(vertex, length));\n}\n\n// Particle class\nvar Particle = function () {\n  this.x = random(-0.1, 1.1, true);\n  this.y = random(-0.1, 1.1, true);\n  this.z = random(0, 4);\n  this.color = color;\n  this.opacity = random(0.1, 1, true);\n  this.flicker = 0;\n  this.neighbors = []; // placeholder for neighbors\n};\nParticle.prototype.render = function () {\n  var pos = position(this.x, this.y, this.z),\n  r = (this.z * particleSizeMultiplier + particleSizeBase) * (sizeRatio() / 1000),\n  o = this.opacity;\n\n  if (flicker) {\n    var newVal = random(-0.5, 0.5, true);\n    this.flicker += (newVal - this.flicker) / flickerSmoothing;\n    if (this.flicker &gt; 0.5) this.flicker = 0.5;\n    if (this.flicker &lt; -0.5) this.flicker = -0.5;\n    o += this.flicker;\n    if (o &gt; 1) o = 1;\n    if (o &lt; 0) o = 0;\n  }\n\n  context.fillStyle = this.color;\n  context.globalAlpha = o;\n  context.beginPath();\n  context.arc(pos.x, pos.y, r, 0, 2 * Math.PI, false);\n  context.fill();\n  context.closePath();\n\n  if (renderParticleGlare) {\n    context.globalAlpha = o * glareOpacityMultiplier;\n    /*\n    context.ellipse(pos.x, pos.y, r * 30, r, 90 * (Math.PI / 180), 0, 2 * Math.PI, false);\n    context.fill();\n    context.closePath();\n    */\n    context.ellipse(pos.x, pos.y, r * 100, r, (glareAngle - (nPos.x - 0.5) * noiseStrength * motion) * (Math.PI / 180), 0, 2 * Math.PI, false);\n    context.fill();\n    context.closePath();\n  }\n\n  context.globalAlpha = 1;\n};\n\n// Flare class\nvar Flare = function () {\n  this.x = random(-0.25, 1.25, true);\n  this.y = random(-0.25, 1.25, true);\n  this.z = random(0, 2);\n  this.color = color;\n  this.opacity = random(0.001, 0.01, true);\n};\nFlare.prototype.render = function () {\n  var pos = position(this.x, this.y, this.z),\n  r = (this.z * flareSizeMultiplier + flareSizeBase) * (sizeRatio() / 1000);\n\n  // Feathered circles\n  /*\n  var grad = context.createRadialGradient(x+r,y+r,0,x+r,y+r,r);\n  grad.addColorStop(0, &#39;rgba(255,255,255,&#39;+f.o+&#39;)&#39;);\n  grad.addColorStop(0.8, &#39;rgba(255,255,255,&#39;+f.o+&#39;)&#39;);\n  grad.addColorStop(1, &#39;rgba(255,255,255,0)&#39;);\n  context.fillStyle = grad;\n  context.beginPath();\n  context.fillRect(x, y, r*2, r*2);\n  context.closePath();\n  */\n\n  context.beginPath();\n  context.globalAlpha = this.opacity;\n  context.arc(pos.x, pos.y, r, 0, 2 * Math.PI, false);\n  context.fillStyle = this.color;\n  context.fill();\n  context.closePath();\n  context.globalAlpha = 1;\n};\n\n// Link class\nvar Link = function (startVertex, numPoints) {\n  this.length = numPoints;\n  this.verts = [startVertex];\n  this.stage = 0;\n  this.linked = [startVertex];\n  this.distances = [];\n  this.traveled = 0;\n  this.fade = 0;\n  this.finished = false;\n};\nLink.prototype.render = function () {\n  // Stages:\n  // 0. Vertex collection\n  // 1. Render line reaching from vertex to vertex\n  // 2. Fade out\n  // 3. Finished (delete me)\n\n  var i, p, pos, points;\n\n  switch (this.stage) {\n    // VERTEX COLLECTION STAGE\n    case 0:\n\n      // Grab the last member of the link\n      var last = particles[this.verts[this.verts.length - 1]];\n      //console.log(JSON.stringify(last));\n      if (last &amp;&amp; last.neighbors &amp;&amp; last.neighbors.length &gt; 0) {\n        // Grab a random neighbor\n        var neighbor = last.neighbors[random(0, last.neighbors.length - 1)];\n        // If we haven&#39;t seen that particle before, add it to the link\n        if (this.verts.indexOf(neighbor) == -1) {\n          this.verts.push(neighbor);\n        }\n        // If we have seen that particle before, we&#39;ll just wait for the next frame\n      } else\n      {\n        //console.log(this.verts[0]+&#39; prematurely moving to stage 3 (0)&#39;);\n        this.stage = 3;\n        this.finished = true;\n      }\n\n      if (this.verts.length &gt;= this.length) {\n        // Calculate all distances at once\n        for (i = 0; i &lt; this.verts.length - 1; i++) {\n          var p1 = particles[this.verts[i]],\n          p2 = particles[this.verts[i + 1]],\n          dx = p1.x - p2.x,\n          dy = p1.y - p2.y,\n          dist = Math.sqrt(dx * dx + dy * dy);\n\n          this.distances.push(dist);\n        }\n        //console.log(&#39;Distances: &#39;+JSON.stringify(this.distances));\n        //console.log(&#39;verts: &#39;+this.verts.length+&#39; distances: &#39;+this.distances.length);\n\n        //console.log(this.verts[0]+&#39; moving to stage 1&#39;);\n        this.stage = 1;\n      }\n      break;\n\n    // RENDER LINE ANIMATION STAGE\n    case 1:\n      if (this.distances.length &gt; 0) {\n\n        points = [];\n        //var a = 1;\n\n        // Gather all points already linked\n        for (i = 0; i &lt; this.linked.length; i++) {\n          p = particles[this.linked[i]];\n          pos = position(p.x, p.y, p.z);\n          points.push([pos.x, pos.y]);\n        }\n\n        var linkSpeedRel = linkSpeed * 0.00001 * canvas.width;\n        this.traveled += linkSpeedRel;\n        var d = this.distances[this.linked.length - 1];\n        // Calculate last point based on linkSpeed and distance travelled to next point\n        if (this.traveled &gt;= d) {\n          this.traveled = 0;\n          // We&#39;ve reached the next point, add coordinates to array\n          //console.log(this.verts[0]+&#39; reached vertex &#39;+(this.linked.length+1)+&#39; of &#39;+this.verts.length);\n\n          this.linked.push(this.verts[this.linked.length]);\n          p = particles[this.linked[this.linked.length - 1]];\n          pos = position(p.x, p.y, p.z);\n          points.push([pos.x, pos.y]);\n\n          if (this.linked.length &gt;= this.verts.length) {\n            //console.log(this.verts[0]+&#39; moving to stage 2 (1)&#39;);\n            this.stage = 2;\n          }\n        } else\n        {\n          // We&#39;re still travelling to the next point, get coordinates at travel distance\n          // http://math.stackexchange.com/a/85582\n          var a = particles[this.linked[this.linked.length - 1]],\n          b = particles[this.verts[this.linked.length]],\n          t = d - this.traveled,\n          x = (this.traveled * b.x + t * a.x) / d,\n          y = (this.traveled * b.y + t * a.y) / d,\n          z = (this.traveled * b.z + t * a.z) / d;\n\n          pos = position(x, y, z);\n\n          //console.log(this.verts[0]+&#39; traveling to vertex &#39;+(this.linked.length+1)+&#39; of &#39;+this.verts.length+&#39; (&#39;+this.traveled+&#39; of &#39;+this.distances[this.linked.length]+&#39;)&#39;);\n\n          points.push([pos.x, pos.y]);\n        }\n\n        this.drawLine(points);\n      } else\n      {\n        //console.log(this.verts[0]+&#39; prematurely moving to stage 3 (1)&#39;);\n        this.stage = 3;\n        this.finished = true;\n      }\n      break;\n\n    // FADE OUT STAGE\n    case 2:\n      if (this.verts.length &gt; 1) {\n        if (this.fade &lt; linkFade) {\n          this.fade++;\n\n          // Render full link between all vertices and fade over time\n          points = [];\n          var alpha = (1 - this.fade / linkFade) * linkOpacity;\n          for (i = 0; i &lt; this.verts.length; i++) {\n            p = particles[this.verts[i]];\n            pos = position(p.x, p.y, p.z);\n            points.push([pos.x, pos.y]);\n          }\n          this.drawLine(points, alpha);\n        } else\n        {\n          //console.log(this.verts[0]+&#39; moving to stage 3 (2a)&#39;);\n          this.stage = 3;\n          this.finished = true;\n        }\n      } else\n      {\n        //console.log(this.verts[0]+&#39; prematurely moving to stage 3 (2b)&#39;);\n        this.stage = 3;\n        this.finished = true;\n      }\n      break;\n\n    // FINISHED STAGE\n    case 3:\n    default:\n      this.finished = true;\n      break;}\n\n};\nLink.prototype.drawLine = function (points, alpha) {\n  if (typeof alpha !== &#39;number&#39;) alpha = linkOpacity;\n\n  if (points.length &gt; 1 &amp;&amp; alpha &gt; 0) {\n    //console.log(this.verts[0]+&#39;: Drawing line &#39;+alpha);\n    context.globalAlpha = alpha;\n    context.beginPath();\n    for (var i = 0; i &lt; points.length - 1; i++) {\n      context.moveTo(points[i][0], points[i][1]);\n      context.lineTo(points[i + 1][0], points[i + 1][1]);\n    }\n    context.strokeStyle = color;\n    context.lineWidth = lineWidth;\n    context.stroke();\n    context.closePath();\n    context.globalAlpha = 1;\n  }\n};\n\n\n// Utils\n\nfunction noisePoint(i) {\n  var a = nAngle * i,\n  cosA = Math.cos(a),\n  sinA = Math.sin(a),\n  //value = simplex.noise2D(nScale * cosA + nScale, nScale * sinA + nScale),\n  //rad = nRad + value;\n  rad = nRad;\n  return {\n    x: rad * cosA,\n    y: rad * sinA };\n\n}\n\nfunction position(x, y, z) {\n  return {\n    x: x * canvas.width + (canvas.width / 2 - mouse.x + (nPos.x - 0.5) * noiseStrength) * z * motion,\n    y: y * canvas.height + (canvas.height / 2 - mouse.y + (nPos.y - 0.5) * noiseStrength) * z * motion };\n\n}\n\nfunction sizeRatio() {\n  return canvas.width &gt;= canvas.height ? canvas.width : canvas.height;\n}\n\nfunction random(min, max, float) {\n  return float ?\n  Math.random() * (max - min) + min :\n  Math.floor(Math.random() * (max - min + 1)) + min;\n}\n\n\n// init\nif (canvas) init();"};
    __preprocessors = {
      "html": "none",
      "css": "scss",
      "js": "none"
    };
    __preprocessorNames = {
      "html": "HTML",
      "css": "SCSS",
      "js": "JS"
    };
    __editable = false;
    __embed_prefill = false;
  </script>

  <script src="./embed-d492f8b0f63f0a8ba679c9cd0a2fffbaa24504a7928435ba1bfc1859f904e02b.js.download"></script>


<script nonce="">(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.nonce='NsDt5b4A5Ws=';d.innerHTML="window.__CF$cv$params={r:'90d31c7a0d1d96ec',t:'MTczODc2MDcxOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='NsDt5b4A5Ws=';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script><iframe height="1" width="1" style="position: absolute; top: 0px; left: 0px; border: none; visibility: hidden;" src="./saved_resource(42).html"></iframe>

</body></html>