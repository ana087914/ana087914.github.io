<!DOCTYPE html>
<!-- saved from url=(0094)https://codepen.io/anon/embed/oPGyQw?height=500&theme-id=1&slug-hash=oPGyQw&default-tab=result -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <meta name="viewport" content="width=device-width">

  <title>CodePen Embed - Ashfall</title>

  <meta name="csrf-param" content="authenticity_token">
<meta name="csrf-token" content="W3rDTUL7ePJtditC/Vv3/dERblmagELUmw6ePCUGOPIVjIH6dQO7wlJTFiN4ebDgz4yuwOwvEwt1HV00HduzAQ==">

  <link rel="stylesheet" media="all" href="./embed-ad67fe72acfeb011f9e0361df99b8dd024a995b725b6034694d1529c4f6bd5ca.css">

  <style>
    .hide {
      display: none !important;
    }
    .embed-footer,
    .embed-nav {
      background: #28282a;
      
    }
    .embed-nav .code-types a,
    .embed-nav .result-button-list a,
    .action-button {
      color: #ffffff;
      background-color: #424242;
    }
    .embed-nav .code-types a.active,
    .embed-nav .result-button-list a.active,
    .action-button.active {
      background: #212121;
      color: #ffffff;
      box-shadow: inset 0px 3px #ff8a00;
    }
    .embed-nav .logo-wrap .edit-on-codepen {
      color: #a9a9a9;
    }

    .embed-nav svg {
      stroke: #a9a9a9 !important;
    }
  </style>

  <link rel="stylesheet" media="all" href="./highcontrast-dark-f425686592da923b79e7aaab67bb8c72ee517d989ff13dfb02586480a6810ad6.css">

  <link rel="stylesheet" href="./maVRwd.css">
</head>

<body id="the-body" style="border: 1px solid #39231b; --borderWidth: 1px;" class="codepen-embed-body static results-active">

  <nav class="embed-nav group" id="embed-nav">

  <ul class="code-types">


        <li class="code-type">
          <a id="html-link" href="https://codepen.io/anon/embed/oPGyQw?height=500&amp;theme-id=1&amp;slug-hash=oPGyQw&amp;default-tab=result#html-box" role="button" aria-pressed="false">
              HTML
          </a>
        </li>


        <li class="code-type">
          <a id="css-link" href="https://codepen.io/anon/embed/oPGyQw?height=500&amp;theme-id=1&amp;slug-hash=oPGyQw&amp;default-tab=result#css-box" role="button" aria-pressed="false">
              SCSS
          </a>
        </li>


        <li class="code-type">
          <a id="js-link" href="https://codepen.io/anon/embed/oPGyQw?height=500&amp;theme-id=1&amp;slug-hash=oPGyQw&amp;default-tab=result#js-box" role="button" aria-pressed="false">
              Babel
          </a>
        </li>


  </ul>

  <ul class="result-button-list">
    <li class="results results-type">
      <a id="result-link" href="https://codepen.io/anon/embed/oPGyQw?height=500&amp;theme-id=1&amp;slug-hash=oPGyQw&amp;default-tab=result#result-box" class="active" aria-pressed="true" role="button">
        Result
      </a>
    </li>
    <li>
      <a href="https://codepen.io/anon/embed/oPGyQw?height=500&amp;theme-id=1&amp;slug-hash=oPGyQw&amp;default-tab=result#resources-link" id="skip-results-iframe-link">Skip Results Iframe</a>
    </li>
  </ul>


    <div class="logo-wrap" id="edit-area">

        <a class="edit-on-codepen" target="_blank" rel="noopener" href="https://codepen.io/shubniggurath/pen/oPGyQw" title="Edit on CodePen">
            <div class="large-logo">
    <span id="edit-on-text" class="open-on">EDIT ON</span>
    <svg id="embed-codepen-logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 138 26" fill="none" stroke="#000" stroke-width="2.3" stroke-linecap="round" stroke-linejoin="round" role="img" aria-label="CodePen">
  <path d="M80 6h-9v14h9m34-14h-9v14h9m-3-7h-6m-28 0h-6m51 7V6l11 14V6M22 16.7L33 24l11-7.3V9.3L33 2 22 9.3v7.4zm22 0L33 9.3l-11 7.4m0-7.4l11 7.3 11-7.3M33 2v7.3m0 7.4V24m55-10h6c2.2 0 4-1.8 4-4s-1.8-4-4-4h-6v14M15 8c-1.3-1.3-3-2-5-2-4 0-7 3-7 7s3 7 7 7c2 0 3.7-.8 5-2m49-5c0 4-3 7-7 7h-5V6h5c4 0 7 3 7 7z"></path>
</svg>
  </div>
  <div class="box-logo">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="20 0 26 26" fill="none" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.3" role="img" aria-label="Edit on CodePen">
  <path id="icon-codepen-box" d="M22 16.7L33 24l11-7.3V9.3L33 2 22 9.3v7.4zm22 0L33 9.3l-11 7.4m0-7.4l11 7.3 11-7.3M33 2v7.3m0 7.4V24"></path>
</svg>
  </div>
        </a>

    
    </div>


</nav>


  <div id="output" data-border-style="thin" data-header="true">



        <div id="html-box" class="code-wrap code-box box " role="region" aria-label="HTML">


          <pre tabindex="0"><code data-lang="htmlmixed" id="actual-html-code" class=" cm-s-default"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">script</span> <span class="cm-attribute">src</span>=<span class="cm-string">"https://cdnjs.cloudflare.com/ajax/libs/three.js/88/three.min.js"</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">&gt;</span>
<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">script</span> <span class="cm-attribute">id</span>=<span class="cm-string">"vertexShader"</span> <span class="cm-attribute">type</span>=<span class="cm-string">"x-shader/x-vertex"</span><span class="cm-tag cm-bracket">&gt;</span>
    void main() {
        gl_Position = vec4( position, 1.0 );
    }
<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">&gt;</span>
<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">script</span> <span class="cm-attribute">id</span>=<span class="cm-string">"fragmentShader"</span> <span class="cm-attribute">type</span>=<span class="cm-string">"x-shader/x-fragment"</span><span class="cm-tag cm-bracket">&gt;</span>
  uniform vec2 u_resolution;
  uniform vec2 u_mouse;
  uniform float u_time;
  uniform sampler2D u_noise;
  
  #define PI 3.141592653589793
  #define TAU 6.
  
  const float multiplier = 15.5;

  const float zoomSpeed = 10.;
  const int layers = 10;

  const int octaves = 5;

  vec2 hash2(vec2 p)
  {
    vec2 o = texture2D( u_noise, (p+0.5)/256.0, -100.0 ).xy;
    return o;
  }
  
  mat2 rotate2d(float _angle){
      return mat2(cos(_angle),sin(_angle),
                  -sin(_angle),cos(_angle));
  }
  
  vec3 hsb2rgb( in vec3 c ){
    vec3 rgb = clamp(abs(mod(c.x*6.0+vec3(0.0,4.0,2.0),
                             6.0)-3.0)-1.0,
                     0.0,
                     1.0 );
    rgb = rgb*rgb*(3.0-2.0*rgb);
    return c.z * mix( vec3(1.0), rgb, c.y);
  }
  
  float hash(vec2 p)
  {
    float o = texture2D( u_noise, (p+0.5)/256.0, -100.0 ).x;
    return o;
  }
  float noise(vec2 uv) {
    vec2 id = floor(uv);
    vec2 subuv = fract(uv);
    vec2 u = subuv * subuv * (3. - 2. * subuv);
    float a = hash(id);
    float b = hash(id + vec2(1., 0.));
    float c = hash(id + vec2(0., 1.));
    float d = hash(id + vec2(1., 1.));
    return mix(mix(a, b, u.x), mix(c, d, u.x), u.y);
  }
  float fbm(in vec2 uv) {
    float s = .0;
    float m = .0;
    float a = .5;
    for(int i = 0; i &lt; octaves; i++) {
      s += a * noise(uv);
      m += a;
      a *= .5;
      uv *= 2.;
    }
    return s / m;
  }
  
  vec3 domain(vec2 z){
    return vec3(hsb2rgb(vec3(atan(z.y,z.x)/TAU,1.,1.)));
  }
  vec3 colour(vec2 z) {
      return domain(z);
  }
  
  // The render function is where we render the pattern to be added to the layer
  vec3 render(vec2 uv, float scale, vec3 colour) {
    vec2 id = floor(uv);
    vec2 subuv = fract(uv);
    vec2 rand = hash2(id);
    float bokeh = abs(scale) * 1.;
    
    float particle = 0.;
    
    if(length(rand) &gt; 1.3) {
      vec2 pos = subuv-.5;
      float field = length(pos);
      particle = smoothstep(.3, 0., field);
      particle += smoothstep(.4 * bokeh, 0.34 * bokeh, field);
    }
    return vec3(particle*2.);
  }
  
  vec3 renderLayer(int layer, int layers, vec2 uv, inout float opacity, vec3 colour, float n) {
    vec2 _uv = uv;
    // Scale
    // Generating a scale value between zero and 1 based on a mod of u_time
    // A frequency of 10 dixided by the layer index (10 / layers * layer)
    float scale = mod((u_time + zoomSpeed / float(layers) * float(layer)) / zoomSpeed, -1.);
    uv *= 20.; // The initial scale. Increasing this makes the cells smaller and the "speed" apepar faster
    uv *= scale*scale; // then modifying the overall scale by the generated amount
    // uv *= 1. + ( ( n*.5 ) * ( length(_uv) ) );
    // uv += .5*float(layer);
    uv = rotate2d(u_time / 10.) * uv; // rotarting
    uv += vec2(25. + sin(u_time*.1)) * float(layer); // ofsetting the UV by an arbitrary amount to make the layer appear different

    // render
    vec3 pass = render(uv * multiplier, scale, colour) * .2; // render the pass

     // this is the opacity of the layer fading in from the "bottom"
    opacity = 1. + scale;
    float _opacity = opacity;
    
    // pass += n * .5 * mix(vec3(0., .5, 1.5), vec3(1., .5, 0.), opacity);
    
    // This is the opacity of the layer fading out at the top (we want this minimal, hence the smoothstep)
    float endOpacity = smoothstep(0., 0.4, scale * -1.);
    opacity += endOpacity;

    return pass * _opacity * endOpacity;
  }

  void main() {
      vec2 uv = (gl_FragCoord.xy - 0.5 * u_resolution.xy);

      if(u_resolution.y &lt; u_resolution.x) {
        uv /= u_resolution.y;
      } else {
        uv /= u_resolution.x;
      }

      // uv.y += cos(u_time * .1) * .5;
      // uv.x += sin(u_time * .1) * .5;
    
      // float n = fbm(uv * 3. - 2.);
      float n = fbm((uv + vec2(sin(u_time*.1), u_time*.1)) * 2. - 2.);

      vec3 colour = vec3(0.);
      // colour = n * mix(vec3(0., .5, 1.5), vec3(1., .5, -.1), n);
      colour = n * mix(vec3(0., .5, 1.5)*-1.5, clamp(vec3(1., .5, .25)*2., 0., 1.), n);
      // colour -= n*n*n*n*.4;
      // colour += smoothstep(.8, 2.5, sin(n*n*n*8.))*.4;

      float opacity = 1.;
      float opacity_sum = 1.;

      for(int i = 1; i &lt;= layers; i++) {
        colour -= renderLayer(i, layers, uv, opacity, colour, n);
        opacity_sum += opacity;
      }

      colour /= opacity_sum;

      gl_FragColor = vec4(clamp(colour * 20., 0., 1.),1.0);
  }
<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">script</span><span class="cm-tag cm-bracket">&gt;</span>


<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">div</span> <span class="cm-attribute">id</span>=<span class="cm-string">"container"</span> <span class="cm-attribute">touch-action</span>=<span class="cm-string">"none"</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">div</span><span class="cm-tag cm-bracket">&gt;</span></code></pre>

        </div>



        <div id="css-box" class="code-wrap code-box box " role="region" aria-label="CSS">


          <pre tabindex="0"><code data-lang="text/x-scss" id="actual-css-code" class=" cm-s-default"><span class="cm-tag">body</span> {
  <span class="cm-property">margin</span>: <span class="cm-number">0</span>;
  <span class="cm-property">padding</span>: <span class="cm-number">0</span>;
}

<span class="cm-builtin">#container</span> {
  <span class="cm-property">position</span>: <span class="cm-atom">fixed</span>;
  <span class="cm-property">touch-action</span>: <span class="cm-atom">none</span>;
}</code></pre>

            <a href="https://codepen.io/anon/embed/oPGyQw?height=500&amp;theme-id=1&amp;slug-hash=oPGyQw&amp;default-tab=result#0" id="view-css-compiled-button" class="action-button bottom right view-compiled-button" data-type="css">
              View Compiled
            </a>
        </div>



        <div id="js-box" class="code-wrap code-box box " role="region" aria-label="JS">


          <pre tabindex="0"><code data-lang="jsx" id="actual-js-code" class=" cm-s-default"><span class="cm-comment">/*</span>
<span class="cm-comment">Most of the stuff in here is just bootstrapping. Essentially it's just</span>
<span class="cm-comment">setting ThreeJS up so that it renders a flat surface upon which to draw </span>
<span class="cm-comment">the shader. The only thing to see here really is the uniforms sent to </span>
<span class="cm-comment">the shader. Apart from that all of the magic happens in the HTML view</span>
<span class="cm-comment">under the fragment shader.</span>
<span class="cm-comment">*/</span>

<span class="cm-keyword">let</span> <span class="cm-def">container</span>;
<span class="cm-keyword">let</span> <span class="cm-def">camera</span>, <span class="cm-def">scene</span>, <span class="cm-def">renderer</span>;
<span class="cm-keyword">let</span> <span class="cm-def">uniforms</span>;

<span class="cm-keyword">let</span> <span class="cm-def">loader</span><span class="cm-operator">=</span><span class="cm-keyword">new</span> <span class="cm-variable">THREE</span>.<span class="cm-property">TextureLoader</span>();
<span class="cm-keyword">let</span> <span class="cm-def">texture</span>;
<span class="cm-variable">loader</span>.<span class="cm-property">setCrossOrigin</span>(<span class="cm-string">"anonymous"</span>);
<span class="cm-variable">loader</span>.<span class="cm-property">load</span>(
  <span class="cm-string">'https://s3-us-west-2.amazonaws.com/s.cdpn.io/982762/noise.png'</span>,
  <span class="cm-keyword">function</span> <span class="cm-def">do_something_with_texture</span>(<span class="cm-def">tex</span>) {
    <span class="cm-variable">texture</span> <span class="cm-operator">=</span> <span class="cm-variable-2">tex</span>;
    <span class="cm-variable">texture</span>.<span class="cm-property">wrapS</span> <span class="cm-operator">=</span> <span class="cm-variable">THREE</span>.<span class="cm-property">RepeatWrapping</span>;
    <span class="cm-variable">texture</span>.<span class="cm-property">wrapT</span> <span class="cm-operator">=</span> <span class="cm-variable">THREE</span>.<span class="cm-property">RepeatWrapping</span>;
    <span class="cm-variable">texture</span>.<span class="cm-property">minFilter</span> <span class="cm-operator">=</span> <span class="cm-variable">THREE</span>.<span class="cm-property">LinearFilter</span>;
    <span class="cm-variable">init</span>();
    <span class="cm-variable">animate</span>();
  }
);

<span class="cm-keyword">function</span> <span class="cm-def">init</span>() {
  <span class="cm-variable">container</span> <span class="cm-operator">=</span> <span class="cm-variable">document</span>.<span class="cm-property">getElementById</span>( <span class="cm-string">'container'</span> );

  <span class="cm-variable">camera</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">THREE</span>.<span class="cm-property">Camera</span>();
  <span class="cm-variable">camera</span>.<span class="cm-property">position</span>.<span class="cm-property">z</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>;

  <span class="cm-variable">scene</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">THREE</span>.<span class="cm-property">Scene</span>();

  <span class="cm-keyword">var</span> <span class="cm-def">geometry</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">THREE</span>.<span class="cm-property">PlaneBufferGeometry</span>( <span class="cm-number">2</span>, <span class="cm-number">2</span> );

  <span class="cm-variable">uniforms</span> <span class="cm-operator">=</span> {
    <span class="cm-property">u_time</span>: { <span class="cm-property">type</span>: <span class="cm-string">"f"</span>, <span class="cm-property">value</span>: <span class="cm-number">1.0</span> },
    <span class="cm-property">u_resolution</span>: { <span class="cm-property">type</span>: <span class="cm-string">"v2"</span>, <span class="cm-property">value</span>: <span class="cm-keyword">new</span> <span class="cm-variable">THREE</span>.<span class="cm-property">Vector2</span>() },
    <span class="cm-property">u_noise</span>: { <span class="cm-property">type</span>: <span class="cm-string">"t"</span>, <span class="cm-property">value</span>: <span class="cm-variable">texture</span> },
    <span class="cm-property">u_mouse</span>: { <span class="cm-property">type</span>: <span class="cm-string">"v2"</span>, <span class="cm-property">value</span>: <span class="cm-keyword">new</span> <span class="cm-variable">THREE</span>.<span class="cm-property">Vector2</span>() }
  };

  <span class="cm-keyword">var</span> <span class="cm-def">material</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">THREE</span>.<span class="cm-property">ShaderMaterial</span>( {
    <span class="cm-property">uniforms</span>: <span class="cm-variable">uniforms</span>,
    <span class="cm-property">vertexShader</span>: <span class="cm-variable">document</span>.<span class="cm-property">getElementById</span>( <span class="cm-string">'vertexShader'</span> ).<span class="cm-property">textContent</span>,
    <span class="cm-property">fragmentShader</span>: <span class="cm-variable">document</span>.<span class="cm-property">getElementById</span>( <span class="cm-string">'fragmentShader'</span> ).<span class="cm-property">textContent</span>
  } );
  <span class="cm-variable-2">material</span>.<span class="cm-property">extensions</span>.<span class="cm-property">derivatives</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;

  <span class="cm-keyword">var</span> <span class="cm-def">mesh</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">THREE</span>.<span class="cm-property">Mesh</span>( <span class="cm-variable-2">geometry</span>, <span class="cm-variable-2">material</span> );
  <span class="cm-variable">scene</span>.<span class="cm-property">add</span>( <span class="cm-variable-2">mesh</span> );

  <span class="cm-variable">renderer</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">THREE</span>.<span class="cm-property">WebGLRenderer</span>();
  <span class="cm-variable">renderer</span>.<span class="cm-property">setPixelRatio</span>( <span class="cm-variable">window</span>.<span class="cm-property">devicePixelRatio</span> );

  <span class="cm-variable">container</span>.<span class="cm-property">appendChild</span>( <span class="cm-variable">renderer</span>.<span class="cm-property">domElement</span> );

  <span class="cm-variable">onWindowResize</span>();
  <span class="cm-variable">window</span>.<span class="cm-property">addEventListener</span>( <span class="cm-string">'resize'</span>, <span class="cm-variable">onWindowResize</span>, <span class="cm-atom">false</span> );

  <span class="cm-variable">document</span>.<span class="cm-property">addEventListener</span>(<span class="cm-string">'pointermove'</span>, (<span class="cm-def">e</span>)<span class="cm-operator">=&gt;</span> {
    <span class="cm-keyword">let</span> <span class="cm-def">ratio</span> <span class="cm-operator">=</span> <span class="cm-variable">window</span>.<span class="cm-property">innerHeight</span> <span class="cm-operator">/</span> <span class="cm-variable">window</span>.<span class="cm-property">innerWidth</span>;
    <span class="cm-variable">uniforms</span>.<span class="cm-property">u_mouse</span>.<span class="cm-property">value</span>.<span class="cm-property">x</span> <span class="cm-operator">=</span> (<span class="cm-variable-2">e</span>.<span class="cm-property">pageX</span> <span class="cm-operator">-</span> <span class="cm-variable">window</span>.<span class="cm-property">innerWidth</span> <span class="cm-operator">/</span> <span class="cm-number">2</span>) <span class="cm-operator">/</span> <span class="cm-variable">window</span>.<span class="cm-property">innerWidth</span> <span class="cm-operator">/</span> <span class="cm-variable-2">ratio</span>;
    <span class="cm-variable">uniforms</span>.<span class="cm-property">u_mouse</span>.<span class="cm-property">value</span>.<span class="cm-property">y</span> <span class="cm-operator">=</span> (<span class="cm-variable-2">e</span>.<span class="cm-property">pageY</span> <span class="cm-operator">-</span> <span class="cm-variable">window</span>.<span class="cm-property">innerHeight</span> <span class="cm-operator">/</span> <span class="cm-number">2</span>) <span class="cm-operator">/</span> <span class="cm-variable">window</span>.<span class="cm-property">innerHeight</span> <span class="cm-operator">*</span> <span class="cm-operator">-</span><span class="cm-number">1</span>;
    
    <span class="cm-variable-2">e</span>.<span class="cm-property">preventDefault</span>();
  });
}

<span class="cm-keyword">function</span> <span class="cm-def">onWindowResize</span>( <span class="cm-def">event</span> ) {
  <span class="cm-variable">renderer</span>.<span class="cm-property">setSize</span>( <span class="cm-variable">window</span>.<span class="cm-property">innerWidth</span>, <span class="cm-variable">window</span>.<span class="cm-property">innerHeight</span> );
  <span class="cm-variable">uniforms</span>.<span class="cm-property">u_resolution</span>.<span class="cm-property">value</span>.<span class="cm-property">x</span> <span class="cm-operator">=</span> <span class="cm-variable">renderer</span>.<span class="cm-property">domElement</span>.<span class="cm-property">width</span>;
  <span class="cm-variable">uniforms</span>.<span class="cm-property">u_resolution</span>.<span class="cm-property">value</span>.<span class="cm-property">y</span> <span class="cm-operator">=</span> <span class="cm-variable">renderer</span>.<span class="cm-property">domElement</span>.<span class="cm-property">height</span>;
}

<span class="cm-keyword">function</span> <span class="cm-def">animate</span>(<span class="cm-def">delta</span>) {
  <span class="cm-variable">requestAnimationFrame</span>( <span class="cm-variable">animate</span> );
  <span class="cm-variable">render</span>(<span class="cm-variable-2">delta</span>);
}






<span class="cm-keyword">let</span> <span class="cm-def">capturer</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">CCapture</span>( { 
  <span class="cm-property">verbose</span>: <span class="cm-atom">true</span>, 
  <span class="cm-property">framerate</span>: <span class="cm-number">60</span>,
  <span class="cm-comment">// motionBlurFrames: 4,</span>
  <span class="cm-property">quality</span>: <span class="cm-number">90</span>,
  <span class="cm-property">format</span>: <span class="cm-string">'webm'</span>,
  <span class="cm-property">workersPath</span>: <span class="cm-string">'js/'</span>
 } );
<span class="cm-keyword">let</span> <span class="cm-def">capturing</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;

<span class="cm-variable">isCapturing</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span>(<span class="cm-def">val</span>) {
  <span class="cm-keyword">if</span>(<span class="cm-variable-2">val</span> <span class="cm-operator">===</span> <span class="cm-atom">false</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable">window</span>.<span class="cm-property">capturing</span> <span class="cm-operator">===</span> <span class="cm-atom">true</span>) {
    <span class="cm-variable">capturer</span>.<span class="cm-property">stop</span>();
    <span class="cm-variable">capturer</span>.<span class="cm-property">save</span>();
  } <span class="cm-keyword">else</span> <span class="cm-keyword">if</span>(<span class="cm-variable-2">val</span> <span class="cm-operator">===</span> <span class="cm-atom">true</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable">window</span>.<span class="cm-property">capturing</span> <span class="cm-operator">===</span> <span class="cm-atom">false</span>) {
    <span class="cm-variable">capturer</span>.<span class="cm-property">start</span>();
  }
  <span class="cm-variable">capturing</span> <span class="cm-operator">=</span> <span class="cm-variable-2">val</span>;
}
<span class="cm-variable">toggleCapture</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span>() {
  <span class="cm-variable">isCapturing</span>(<span class="cm-operator">!</span><span class="cm-variable">capturing</span>);
}

<span class="cm-variable">window</span>.<span class="cm-property">addEventListener</span>(<span class="cm-string">'keyup'</span>, <span class="cm-keyword">function</span>(<span class="cm-def">e</span>) { <span class="cm-keyword">if</span>(<span class="cm-variable-2">e</span>.<span class="cm-property">keyCode</span> <span class="cm-operator">==</span> <span class="cm-number">68</span>) <span class="cm-variable">toggleCapture</span>(); });

<span class="cm-keyword">let</span> <span class="cm-def">then</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;
<span class="cm-keyword">function</span> <span class="cm-def">render</span>(<span class="cm-def">delta</span>) {
  
  <span class="cm-variable">uniforms</span>.<span class="cm-property">u_time</span>.<span class="cm-property">value</span> <span class="cm-operator">=</span> <span class="cm-operator">-</span><span class="cm-number">10000</span> <span class="cm-operator">+</span> <span class="cm-variable-2">delta</span> <span class="cm-operator">*</span> <span class="cm-number">0.0005</span>;
  <span class="cm-variable">renderer</span>.<span class="cm-property">render</span>( <span class="cm-variable">scene</span>, <span class="cm-variable">camera</span> );
  
  <span class="cm-keyword">if</span>(<span class="cm-variable">capturing</span>) {
    <span class="cm-variable">capturer</span>.<span class="cm-property">capture</span>( <span class="cm-variable">renderer</span>.<span class="cm-property">domElement</span> );
  }
}</code></pre>

            <a href="https://codepen.io/anon/embed/oPGyQw?height=500&amp;theme-id=1&amp;slug-hash=oPGyQw&amp;default-tab=result#0" id="view-js-compiled-button" class="action-button bottom right view-compiled-button" data-type="js">
              View Compiled
            </a>
        </div>



    <div id="result-box" class="code-box active zoom-1" role="region" aria-label="Result">


  <iframe allow="accelerometer *; bluetooth *; camera *; encrypted-media *; display-capture *; geolocation *; gyroscope *; microphone *; midi *; clipboard-read *; clipboard-write *; web-share *; serial *; xr-spatial-tracking *" allowfullscreen="true" allowpaymentrequest="true" allowtransparency="true" class="result-iframe  " frameborder="0" id="result-iframe" loading="lazy" name="CodePen Preview for Ashfall" sandbox="allow-downloads allow-forms allow-modals allow-pointer-lock allow-popups-to-escape-sandbox allow-popups allow-presentation allow-same-origin allow-scripts allow-top-navigation-by-user-activation" scrolling="yes" title="CodePen Preview for Ashfall" data-src="https://codepen.io/shubniggurath/fullembedgrid/oPGyQw?animations=run&amp;type=embed" src="./oPGyQw(1).html">
  </iframe>


</div>


    <div id="about-box">

  <div class="about-container">


    <div class="about-user">

        <a href="https://codepen.io/shubniggurath" target="_blank" rel="noopener"><img src="./default(16).png" loading="lazy" alt="" class="about-image"></a>

      <div class="about-user-info">


        <p>
          This Pen is owned by <a href="https://codepen.io/shubniggurath" target="_blank" rel="noopener">Liam Egan</a> on <a href="https://codepen.io/" target="_blank" rel="noopener">CodePen</a>.

        </p>

        <p>
          <a href="https://codepen.io/shubniggurath" target="_blank" rel="noopener" class="about-user-more">
          See more by @shubniggurath on CodePen
          </a>
        </p>


      </div>

    </div>


  </div>

</div>


    <div id="resources-box" class="resources-box">

  <h3>External CSS</h3>
    <p>
      This Pen doesn't use any external CSS resources.
    </p>

  <h3>External JavaScript</h3>
    <ol class="list-of-resources">
        <li>
          <a href="https://s3-us-west-2.amazonaws.com/s.cdpn.io/982762/ccapture.js" target="_blank">https://s3-us-west-2.amazonaws.com/s.cdpn.io/982762/ccapture.js</a>
        </li>
    </ol>

</div>


  </div>

    <footer class="embed-footer" id="embed-footer">

    <button id="resources-link" class="resources-link action-button bottom left" href="#resources-box" aria-pressed="false" role="button">
      Resources
    </button>

    <ul class="scaling-choices bottom right">
  <li><button class="action-button" id="zoom-button-1">1×</button></li>
  <li><button class="action-button" id="zoom-button-05">0.5×</button></li>
  <li><button class="action-button" id="zoom-button-025">0.25×</button></li>
</ul>

<button id="rerun-button" class="action-button rerun-button bottom right">
  Rerun
</button>

  </footer>



  <script nonce="">
    __processedPen = {"html":"&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/three.js/88/three.min.js&quot;&gt;&lt;/script&gt;\n&lt;script id=&quot;vertexShader&quot; type=&quot;x-shader/x-vertex&quot;&gt;\n    void main() {\n        gl_Position = vec4( position, 1.0 );\n    }\n&lt;/script&gt;\n&lt;script id=&quot;fragmentShader&quot; type=&quot;x-shader/x-fragment&quot;&gt;\n  uniform vec2 u_resolution;\n  uniform vec2 u_mouse;\n  uniform float u_time;\n  uniform sampler2D u_noise;\n  \n  #define PI 3.141592653589793\n  #define TAU 6.\n  \n  const float multiplier = 15.5;\n\n  const float zoomSpeed = 10.;\n  const int layers = 10;\n\n  const int octaves = 5;\n\n  vec2 hash2(vec2 p)\n  {\n    vec2 o = texture2D( u_noise, (p+0.5)/256.0, -100.0 ).xy;\n    return o;\n  }\n  \n  mat2 rotate2d(float _angle){\n      return mat2(cos(_angle),sin(_angle),\n                  -sin(_angle),cos(_angle));\n  }\n  \n  vec3 hsb2rgb( in vec3 c ){\n    vec3 rgb = clamp(abs(mod(c.x*6.0+vec3(0.0,4.0,2.0),\n                             6.0)-3.0)-1.0,\n                     0.0,\n                     1.0 );\n    rgb = rgb*rgb*(3.0-2.0*rgb);\n    return c.z * mix( vec3(1.0), rgb, c.y);\n  }\n  \n  float hash(vec2 p)\n  {\n    float o = texture2D( u_noise, (p+0.5)/256.0, -100.0 ).x;\n    return o;\n  }\n  float noise(vec2 uv) {\n    vec2 id = floor(uv);\n    vec2 subuv = fract(uv);\n    vec2 u = subuv * subuv * (3. - 2. * subuv);\n    float a = hash(id);\n    float b = hash(id + vec2(1., 0.));\n    float c = hash(id + vec2(0., 1.));\n    float d = hash(id + vec2(1., 1.));\n    return mix(mix(a, b, u.x), mix(c, d, u.x), u.y);\n  }\n  float fbm(in vec2 uv) {\n    float s = .0;\n    float m = .0;\n    float a = .5;\n    for(int i = 0; i &lt; octaves; i++) {\n      s += a * noise(uv);\n      m += a;\n      a *= .5;\n      uv *= 2.;\n    }\n    return s / m;\n  }\n  \n  vec3 domain(vec2 z){\n    return vec3(hsb2rgb(vec3(atan(z.y,z.x)/TAU,1.,1.)));\n  }\n  vec3 colour(vec2 z) {\n      return domain(z);\n  }\n  \n  // The render function is where we render the pattern to be added to the layer\n  vec3 render(vec2 uv, float scale, vec3 colour) {\n    vec2 id = floor(uv);\n    vec2 subuv = fract(uv);\n    vec2 rand = hash2(id);\n    float bokeh = abs(scale) * 1.;\n    \n    float particle = 0.;\n    \n    if(length(rand) &gt; 1.3) {\n      vec2 pos = subuv-.5;\n      float field = length(pos);\n      particle = smoothstep(.3, 0., field);\n      particle += smoothstep(.4 * bokeh, 0.34 * bokeh, field);\n    }\n    return vec3(particle*2.);\n  }\n  \n  vec3 renderLayer(int layer, int layers, vec2 uv, inout float opacity, vec3 colour, float n) {\n    vec2 _uv = uv;\n    // Scale\n    // Generating a scale value between zero and 1 based on a mod of u_time\n    // A frequency of 10 dixided by the layer index (10 / layers * layer)\n    float scale = mod((u_time + zoomSpeed / float(layers) * float(layer)) / zoomSpeed, -1.);\n    uv *= 20.; // The initial scale. Increasing this makes the cells smaller and the &quot;speed&quot; apepar faster\n    uv *= scale*scale; // then modifying the overall scale by the generated amount\n    // uv *= 1. + ( ( n*.5 ) * ( length(_uv) ) );\n    // uv += .5*float(layer);\n    uv = rotate2d(u_time / 10.) * uv; // rotarting\n    uv += vec2(25. + sin(u_time*.1)) * float(layer); // ofsetting the UV by an arbitrary amount to make the layer appear different\n\n    // render\n    vec3 pass = render(uv * multiplier, scale, colour) * .2; // render the pass\n\n     // this is the opacity of the layer fading in from the &quot;bottom&quot;\n    opacity = 1. + scale;\n    float _opacity = opacity;\n    \n    // pass += n * .5 * mix(vec3(0., .5, 1.5), vec3(1., .5, 0.), opacity);\n    \n    // This is the opacity of the layer fading out at the top (we want this minimal, hence the smoothstep)\n    float endOpacity = smoothstep(0., 0.4, scale * -1.);\n    opacity += endOpacity;\n\n    return pass * _opacity * endOpacity;\n  }\n\n  void main() {\n      vec2 uv = (gl_FragCoord.xy - 0.5 * u_resolution.xy);\n\n      if(u_resolution.y &lt; u_resolution.x) {\n        uv /= u_resolution.y;\n      } else {\n        uv /= u_resolution.x;\n      }\n\n      // uv.y += cos(u_time * .1) * .5;\n      // uv.x += sin(u_time * .1) * .5;\n    \n      // float n = fbm(uv * 3. - 2.);\n      float n = fbm((uv + vec2(sin(u_time*.1), u_time*.1)) * 2. - 2.);\n\n      vec3 colour = vec3(0.);\n      // colour = n * mix(vec3(0., .5, 1.5), vec3(1., .5, -.1), n);\n      colour = n * mix(vec3(0., .5, 1.5)*-1.5, clamp(vec3(1., .5, .25)*2., 0., 1.), n);\n      // colour -= n*n*n*n*.4;\n      // colour += smoothstep(.8, 2.5, sin(n*n*n*8.))*.4;\n\n      float opacity = 1.;\n      float opacity_sum = 1.;\n\n      for(int i = 1; i &lt;= layers; i++) {\n        colour -= renderLayer(i, layers, uv, opacity, colour, n);\n        opacity_sum += opacity;\n      }\n\n      colour /= opacity_sum;\n\n      gl_FragColor = vec4(clamp(colour * 20., 0., 1.),1.0);\n  }\n&lt;/script&gt;\n\n\n&lt;div id=&quot;container&quot; touch-action=&quot;none&quot;&gt;&lt;/div&gt;","css":"body {\n  margin: 0;\n  padding: 0;\n}\n\n#container {\n  position: fixed;\n  touch-action: none;\n}","js":"/*\nMost of the stuff in here is just bootstrapping. Essentially it&#39;s just\nsetting ThreeJS up so that it renders a flat surface upon which to draw \nthe shader. The only thing to see here really is the uniforms sent to \nthe shader. Apart from that all of the magic happens in the HTML view\nunder the fragment shader.\n*/\n\nlet container;\nlet camera, scene, renderer;\nlet uniforms;\n\nlet loader = new THREE.TextureLoader();\nlet texture;\nloader.setCrossOrigin(&quot;anonymous&quot;);\nloader.load(\n&#39;https://s3-us-west-2.amazonaws.com/s.cdpn.io/982762/noise.png&#39;,\nfunction do_something_with_texture(tex) {\n  texture = tex;\n  texture.wrapS = THREE.RepeatWrapping;\n  texture.wrapT = THREE.RepeatWrapping;\n  texture.minFilter = THREE.LinearFilter;\n  init();\n  animate();\n});\n\n\nfunction init() {\n  container = document.getElementById(&#39;container&#39;);\n\n  camera = new THREE.Camera();\n  camera.position.z = 1;\n\n  scene = new THREE.Scene();\n\n  var geometry = new THREE.PlaneBufferGeometry(2, 2);\n\n  uniforms = {\n    u_time: { type: &quot;f&quot;, value: 1.0 },\n    u_resolution: { type: &quot;v2&quot;, value: new THREE.Vector2() },\n    u_noise: { type: &quot;t&quot;, value: texture },\n    u_mouse: { type: &quot;v2&quot;, value: new THREE.Vector2() } };\n\n\n  var material = new THREE.ShaderMaterial({\n    uniforms: uniforms,\n    vertexShader: document.getElementById(&#39;vertexShader&#39;).textContent,\n    fragmentShader: document.getElementById(&#39;fragmentShader&#39;).textContent });\n\n  material.extensions.derivatives = true;\n\n  var mesh = new THREE.Mesh(geometry, material);\n  scene.add(mesh);\n\n  renderer = new THREE.WebGLRenderer();\n  renderer.setPixelRatio(window.devicePixelRatio);\n\n  container.appendChild(renderer.domElement);\n\n  onWindowResize();\n  window.addEventListener(&#39;resize&#39;, onWindowResize, false);\n\n  document.addEventListener(&#39;pointermove&#39;, e =&gt; {\n    let ratio = window.innerHeight / window.innerWidth;\n    uniforms.u_mouse.value.x = (e.pageX - window.innerWidth / 2) / window.innerWidth / ratio;\n    uniforms.u_mouse.value.y = (e.pageY - window.innerHeight / 2) / window.innerHeight * -1;\n\n    e.preventDefault();\n  });\n}\n\nfunction onWindowResize(event) {\n  renderer.setSize(window.innerWidth, window.innerHeight);\n  uniforms.u_resolution.value.x = renderer.domElement.width;\n  uniforms.u_resolution.value.y = renderer.domElement.height;\n}\n\nfunction animate(delta) {\n  requestAnimationFrame(animate);\n  render(delta);\n}\n\n\n\n\n\n\nlet capturer = new CCapture({\n  verbose: true,\n  framerate: 60,\n  // motionBlurFrames: 4,\n  quality: 90,\n  format: &#39;webm&#39;,\n  workersPath: &#39;js/&#39; });\n\nlet capturing = false;\n\nisCapturing = function (val) {\n  if (val === false &amp;&amp; window.capturing === true) {\n    capturer.stop();\n    capturer.save();\n  } else if (val === true &amp;&amp; window.capturing === false) {\n    capturer.start();\n  }\n  capturing = val;\n};\ntoggleCapture = function () {\n  isCapturing(!capturing);\n};\n\nwindow.addEventListener(&#39;keyup&#39;, function (e) {if (e.keyCode == 68) toggleCapture();});\n\nlet then = 0;\nfunction render(delta) {\n\n  uniforms.u_time.value = -10000 + delta * 0.0005;\n  renderer.render(scene, camera);\n\n  if (capturing) {\n    capturer.capture(renderer.domElement);\n  }\n}"};
    __preprocessors = {
      "html": "none",
      "css": "scss",
      "js": "babel"
    };
    __preprocessorNames = {
      "html": "HTML",
      "css": "SCSS",
      "js": "Babel"
    };
    __editable = false;
    __embed_prefill = false;
  </script>

  <script src="./embed-d492f8b0f63f0a8ba679c9cd0a2fffbaa24504a7928435ba1bfc1859f904e02b.js.download"></script>


<script nonce="">(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.nonce='OZIEeEitwDY=';d.innerHTML="window.__CF$cv$params={r:'90d31c79fd1596ec',t:'MTczODc2MDcxOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='OZIEeEitwDY=';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script><iframe height="1" width="1" style="position: absolute; top: 0px; left: 0px; border: none; visibility: hidden;" src="./saved_resource(41).html"></iframe>

</body></html>