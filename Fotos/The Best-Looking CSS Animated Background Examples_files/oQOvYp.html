<!DOCTYPE html>
<!-- saved from url=(0094)https://codepen.io/anon/embed/oQOvYp?height=500&theme-id=1&slug-hash=oQOvYp&default-tab=result -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <meta name="viewport" content="width=device-width">

  <title>CodePen Embed - Spipa circle</title>

  <meta name="csrf-param" content="authenticity_token">
<meta name="csrf-token" content="dvTiAV5g4giOHMnQ7h/DH+jjId7uYd/bIemUzdQhSkE4AqC2aZghOLE59LFrPYQC9n7hR5jOjgTP+lfF7PzBsg==">

  <link rel="stylesheet" media="all" href="./embed-ad67fe72acfeb011f9e0361df99b8dd024a995b725b6034694d1529c4f6bd5ca.css">

  <style>
    .hide {
      display: none !important;
    }
    .embed-footer,
    .embed-nav {
      background: #28282a;
      
    }
    .embed-nav .code-types a,
    .embed-nav .result-button-list a,
    .action-button {
      color: #ffffff;
      background-color: #424242;
    }
    .embed-nav .code-types a.active,
    .embed-nav .result-button-list a.active,
    .action-button.active {
      background: #212121;
      color: #ffffff;
      box-shadow: inset 0px 3px #ff8a00;
    }
    .embed-nav .logo-wrap .edit-on-codepen {
      color: #a9a9a9;
    }

    .embed-nav svg {
      stroke: #a9a9a9 !important;
    }
  </style>

  <link rel="stylesheet" media="all" href="./highcontrast-dark-f425686592da923b79e7aaab67bb8c72ee517d989ff13dfb02586480a6810ad6.css">

  <link rel="stylesheet" href="./maVRwd.css">
</head>

<body id="the-body" style="border: 1px solid #39231b; --borderWidth: 1px;" class="codepen-embed-body static results-active">

  <nav class="embed-nav group" id="embed-nav">

  <ul class="code-types">


        <li class="code-type">
          <a id="html-link" href="https://codepen.io/anon/embed/oQOvYp?height=500&amp;theme-id=1&amp;slug-hash=oQOvYp&amp;default-tab=result#html-box" role="button" aria-pressed="false">
              HTML
          </a>
        </li>


        <li class="code-type">
          <a id="css-link" href="https://codepen.io/anon/embed/oQOvYp?height=500&amp;theme-id=1&amp;slug-hash=oQOvYp&amp;default-tab=result#css-box" role="button" aria-pressed="false">
              Less
          </a>
        </li>


        <li class="code-type">
          <a id="js-link" href="https://codepen.io/anon/embed/oQOvYp?height=500&amp;theme-id=1&amp;slug-hash=oQOvYp&amp;default-tab=result#js-box" role="button" aria-pressed="false">
              JS
          </a>
        </li>


  </ul>

  <ul class="result-button-list">
    <li class="results results-type">
      <a id="result-link" href="https://codepen.io/anon/embed/oQOvYp?height=500&amp;theme-id=1&amp;slug-hash=oQOvYp&amp;default-tab=result#result-box" class="active" aria-pressed="true" role="button">
        Result
      </a>
    </li>
    <li>
      <a href="https://codepen.io/anon/embed/oQOvYp?height=500&amp;theme-id=1&amp;slug-hash=oQOvYp&amp;default-tab=result#resources-link" id="skip-results-iframe-link">Skip Results Iframe</a>
    </li>
  </ul>


    <div class="logo-wrap" id="edit-area">

        <a class="edit-on-codepen" target="_blank" rel="noopener" href="https://codepen.io/alexandrix/pen/oQOvYp" title="Edit on CodePen">
            <div class="large-logo">
    <span id="edit-on-text" class="open-on">EDIT ON</span>
    <svg id="embed-codepen-logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 138 26" fill="none" stroke="#000" stroke-width="2.3" stroke-linecap="round" stroke-linejoin="round" role="img" aria-label="CodePen">
  <path d="M80 6h-9v14h9m34-14h-9v14h9m-3-7h-6m-28 0h-6m51 7V6l11 14V6M22 16.7L33 24l11-7.3V9.3L33 2 22 9.3v7.4zm22 0L33 9.3l-11 7.4m0-7.4l11 7.3 11-7.3M33 2v7.3m0 7.4V24m55-10h6c2.2 0 4-1.8 4-4s-1.8-4-4-4h-6v14M15 8c-1.3-1.3-3-2-5-2-4 0-7 3-7 7s3 7 7 7c2 0 3.7-.8 5-2m49-5c0 4-3 7-7 7h-5V6h5c4 0 7 3 7 7z"></path>
</svg>
  </div>
  <div class="box-logo">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="20 0 26 26" fill="none" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.3" role="img" aria-label="Edit on CodePen">
  <path id="icon-codepen-box" d="M22 16.7L33 24l11-7.3V9.3L33 2 22 9.3v7.4zm22 0L33 9.3l-11 7.4m0-7.4l11 7.3 11-7.3M33 2v7.3m0 7.4V24"></path>
</svg>
  </div>
        </a>

    
    </div>


</nav>


  <div id="output" data-border-style="thin" data-header="true">



        <div id="html-box" class="code-wrap code-box box " role="region" aria-label="HTML">


          <pre tabindex="0"><code data-lang="htmlmixed" id="actual-html-code" class=" cm-s-default"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">div</span> <span class="cm-attribute">class</span>=<span class="cm-string">"ui"</span><span class="cm-tag cm-bracket">&gt;</span>
  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">p</span> <span class="cm-attribute">class</span>=<span class="cm-string">"zoom"</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">span</span> <span class="cm-attribute">class</span>=<span class="cm-string">"zoom zoomin"</span><span class="cm-tag cm-bracket">&gt;</span>+<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">span</span> <span class="cm-attribute">class</span>=<span class="cm-string">"zoom zoomout"</span><span class="cm-tag cm-bracket">&gt;</span>-<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">p</span><span class="cm-tag cm-bracket">&gt;</span>
  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">p</span> <span class="cm-attribute">class</span>=<span class="cm-string">"zoomlevel"</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">span</span> <span class="cm-attribute">class</span>=<span class="cm-string">"percent"</span><span class="cm-tag cm-bracket">&gt;</span>100<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;</span> % - (<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">span</span> <span class="cm-attribute">class</span>=<span class="cm-string">"width"</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;</span>px)(<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">span</span> <span class="cm-attribute">class</span>=<span class="cm-string">"height"</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;</span>px)<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">p</span><span class="cm-tag cm-bracket">&gt;</span>
  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">p</span><span class="cm-tag cm-bracket">&gt;</span>Dead: <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">span</span> <span class="cm-attribute">class</span>=<span class="cm-string">"dead"</span><span class="cm-tag cm-bracket">&gt;</span>0<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">p</span><span class="cm-tag cm-bracket">&gt;</span>
  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">p</span><span class="cm-tag cm-bracket">&gt;</span>Alive: <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">span</span> <span class="cm-attribute">class</span>=<span class="cm-string">"alive"</span><span class="cm-tag cm-bracket">&gt;</span>0<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">p</span><span class="cm-tag cm-bracket">&gt;</span>
  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">p</span><span class="cm-tag cm-bracket">&gt;</span>Drawn: <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">span</span> <span class="cm-attribute">class</span>=<span class="cm-string">"drawn"</span><span class="cm-tag cm-bracket">&gt;</span>0<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">p</span><span class="cm-tag cm-bracket">&gt;</span>
  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">p</span><span class="cm-tag cm-bracket">&gt;</span><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">span</span> <span class="cm-attribute">class</span>=<span class="cm-string">"fps"</span><span class="cm-tag cm-bracket">&gt;</span>0<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">span</span><span class="cm-tag cm-bracket">&gt;</span> FPS<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">p</span><span class="cm-tag cm-bracket">&gt;</span>
  <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">a</span> <span class="cm-attribute">class</span>=<span class="cm-string">"save"</span> <span class="cm-attribute">href</span>=<span class="cm-string">""</span> <span class="cm-attribute">download</span>=<span class="cm-string">"capture.png"</span><span class="cm-tag cm-bracket">&gt;</span>Save<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">a</span><span class="cm-tag cm-bracket">&gt;</span>
<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">div</span><span class="cm-tag cm-bracket">&gt;</span></code></pre>

        </div>



        <div id="css-box" class="code-wrap code-box box " role="region" aria-label="CSS">


          <pre tabindex="0"><code data-lang="text/x-less" id="actual-css-code" class=" cm-s-default">* {
  <span class="cm-property">border</span>: <span class="cm-atom">none</span>;
  <span class="cm-property">margin</span>: <span class="cm-number">0</span>;
}
<span class="cm-tag">html</span>,
<span class="cm-tag">body</span> {
  <span class="cm-property">width</span>: <span class="cm-number">100%</span>;
  <span class="cm-property">height</span>: <span class="cm-number">100%</span>;
  <span class="cm-property">overflow</span>: <span class="cm-atom">hidden</span>;
}
<span class="cm-tag">body</span> {
  <span class="cm-comment">//background: radial-gradient(#555, #111);</span>
}
<span class="cm-tag">canvas</span> {
  <span class="cm-property">background</span>: <span class="cm-keyword">white</span>;
  <span class="cm-property">background</span>: <span class="cm-variable cm-callee">radial-gradient</span>(<span class="cm-atom">#FFF</span>, <span class="cm-atom">#DDD</span>);
  <span class="cm-comment">//background: radial-gradient(hsl(40, 80%, 60%), hsl(0, 50%, 40%));</span>
  <span class="cm-comment">//filter: blur(1px) contrast(5);</span>
  <span class="cm-comment">//transform: scale(0.1);</span>
  <span class="cm-property">transform-origin</span>: <span class="cm-number">0</span> <span class="cm-number">0</span>;
  <span class="cm-comment">//border: solid .8em green;</span>
  <span class="cm-property">width</span>: <span class="cm-number">100%</span>;
  <span class="cm-property">height</span>: <span class="cm-number">100%</span>;
}
<span class="cm-qualifier">.ui</span> {
  <span class="cm-property">display</span>: <span class="cm-atom">none</span>;
  <span class="cm-property">position</span>: <span class="cm-atom">fixed</span>;
  <span class="cm-property">z-index</span>: <span class="cm-number">5</span>;
  <span class="cm-property">bottom</span>: <span class="cm-number">0</span>;
  <span class="cm-property">left</span>: <span class="cm-number">0</span>;
  <span class="cm-property">width</span>: <span class="cm-number">120px</span>;
  <span class="cm-property">padding</span>: <span class="cm-number">10px</span>;
  <span class="cm-property">background</span>: <span class="cm-variable cm-callee">rgba</span>(<span class="cm-number">255</span>,<span class="cm-number">255</span>,<span class="cm-number">255</span>,<span class="cm-number">0.7</span>);
  
  <span class="cm-tag">p</span> {
    <span class="cm-comment">//color: white;</span>
    <span class="cm-property">font-size</span>: <span class="cm-number">11px</span>;
    <span class="cm-property">font-weight</span>: <span class="cm-number">700</span>;
    
    <span class="cm-atom">&amp;</span><span class="cm-qualifier">.zoom</span> {
      <span class="cm-property">margin-bottom</span>: <span class="cm-number">5px</span>;
      
      <span class="cm-tag">span</span> {
        <span class="cm-property">margin-right</span>: <span class="cm-number">5px</span>;
        <span class="cm-property">border</span>: <span class="cm-atom">solid</span> <span class="cm-number">1px</span> <span class="cm-atom">#777</span>;
        <span class="cm-property">cursor</span>: <span class="cm-atom">pointer</span>;
        <span class="cm-property">border-radius</span>: <span class="cm-number">2px</span>;
        
        <span class="cm-atom">&amp;</span><span class="cm-qualifier">.zoomin</span> {
          <span class="cm-property">padding</span>: <span class="cm-number">2px</span> <span class="cm-number">5px</span>;
        }
        <span class="cm-atom">&amp;</span><span class="cm-qualifier">.zoomout</span> {
          <span class="cm-property">padding</span>: <span class="cm-number">2px</span> <span class="cm-number">8px</span>;
        }
        <span class="cm-atom">&amp;</span>:<span class="cm-variable-3">hover</span> {
          <span class="cm-property">background</span>: <span class="cm-keyword">black</span>;
          <span class="cm-property">color</span>: <span class="cm-keyword">white</span>;
        }
      }
    }
  }
  
  <span class="cm-tag">span</span><span class="cm-qualifier">.zoom</span> {
    
    
  }
}
</code></pre>

            <a href="https://codepen.io/anon/embed/oQOvYp?height=500&amp;theme-id=1&amp;slug-hash=oQOvYp&amp;default-tab=result#0" id="view-css-compiled-button" class="action-button bottom right view-compiled-button" data-type="css">
              View Compiled
            </a>
        </div>



        <div id="js-box" class="code-wrap code-box box " role="region" aria-label="JS">


          <pre tabindex="0"><code data-lang="javascript" id="actual-js-code" class=" cm-s-default"><span class="cm-comment">/**</span>
<span class="cm-comment"> * @author Alex Andrix &lt;alex@alexandrix.com&gt;</span>
<span class="cm-comment"> * @since 2018-12-02</span>
<span class="cm-comment"> */</span>

<span class="cm-keyword">var</span> <span class="cm-def">App</span> <span class="cm-operator">=</span> {};
<span class="cm-variable">App</span>.<span class="cm-property">setup</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span>() {
  <span class="cm-keyword">var</span> <span class="cm-def">canvas</span> <span class="cm-operator">=</span> <span class="cm-variable">document</span>.<span class="cm-property">createElement</span>(<span class="cm-string">'canvas'</span>);
  <span class="cm-keyword">this</span>.<span class="cm-property">filename</span> <span class="cm-operator">=</span> <span class="cm-string">"spipa"</span>;
  <span class="cm-variable-2">canvas</span>.<span class="cm-property">width</span> <span class="cm-operator">=</span> <span class="cm-variable">window</span>.<span class="cm-property">innerWidth</span>;
  <span class="cm-variable-2">canvas</span>.<span class="cm-property">height</span> <span class="cm-operator">=</span> <span class="cm-variable">window</span>.<span class="cm-property">innerHeight</span>;
  <span class="cm-keyword">this</span>.<span class="cm-property">canvas</span> <span class="cm-operator">=</span> <span class="cm-variable-2">canvas</span>;
  <span class="cm-variable">document</span>.<span class="cm-property">getElementsByTagName</span>(<span class="cm-string">'body'</span>)[<span class="cm-number">0</span>].<span class="cm-property">appendChild</span>(<span class="cm-variable-2">canvas</span>);
  <span class="cm-keyword">this</span>.<span class="cm-property">ctx</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">canvas</span>.<span class="cm-property">getContext</span>(<span class="cm-string">'2d'</span>);
  <span class="cm-keyword">this</span>.<span class="cm-property">width</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">canvas</span>.<span class="cm-property">width</span>;
  <span class="cm-keyword">this</span>.<span class="cm-property">height</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">canvas</span>.<span class="cm-property">height</span>;
  <span class="cm-keyword">this</span>.<span class="cm-property">dataToImageRatio</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>;
  <span class="cm-keyword">this</span>.<span class="cm-property">ctx</span>.<span class="cm-property">imageSmoothingEnabled</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;
  <span class="cm-keyword">this</span>.<span class="cm-property">ctx</span>.<span class="cm-property">webkitImageSmoothingEnabled</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;
  <span class="cm-keyword">this</span>.<span class="cm-property">ctx</span>.<span class="cm-property">msImageSmoothingEnabled</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;
  <span class="cm-keyword">this</span>.<span class="cm-property">xC</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">width</span> <span class="cm-operator">/</span> <span class="cm-number">2</span>;
  <span class="cm-keyword">this</span>.<span class="cm-property">yC</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">height</span> <span class="cm-operator">/</span> <span class="cm-number">2</span>;
  
  <span class="cm-keyword">this</span>.<span class="cm-property">stepCount</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;
  <span class="cm-keyword">this</span>.<span class="cm-property">particles</span> <span class="cm-operator">=</span> [];
  <span class="cm-keyword">this</span>.<span class="cm-property">lifespan</span> <span class="cm-operator">=</span> <span class="cm-number">1000</span>;
  <span class="cm-keyword">this</span>.<span class="cm-property">popPerBirth</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>;
  <span class="cm-keyword">this</span>.<span class="cm-property">maxPop</span> <span class="cm-operator">=</span> <span class="cm-number">300</span>;
  <span class="cm-keyword">this</span>.<span class="cm-property">birthFreq</span> <span class="cm-operator">=</span> <span class="cm-number">2</span>;

  <span class="cm-comment">// Build grid</span>
  <span class="cm-keyword">this</span>.<span class="cm-property">gridSize</span> <span class="cm-operator">=</span> <span class="cm-number">8</span>;<span class="cm-comment">// Motion coords</span>
  <span class="cm-keyword">this</span>.<span class="cm-property">gridSteps</span> <span class="cm-operator">=</span> <span class="cm-variable">Math</span>.<span class="cm-property">floor</span>(<span class="cm-number">1000</span> <span class="cm-operator">/</span> <span class="cm-keyword">this</span>.<span class="cm-property">gridSize</span>);
  <span class="cm-keyword">this</span>.<span class="cm-property">grid</span> <span class="cm-operator">=</span> [];
  <span class="cm-keyword">var</span> <span class="cm-def">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;
  <span class="cm-keyword">for</span> (<span class="cm-keyword">var</span> <span class="cm-def">xx</span> <span class="cm-operator">=</span> <span class="cm-operator">-</span><span class="cm-number">500</span>; <span class="cm-variable-2">xx</span> <span class="cm-operator">&lt;</span> <span class="cm-number">500</span>; <span class="cm-variable-2">xx</span> <span class="cm-operator">+=</span> <span class="cm-keyword">this</span>.<span class="cm-property">gridSize</span>) {
    <span class="cm-keyword">for</span> (<span class="cm-keyword">var</span> <span class="cm-def">yy</span> <span class="cm-operator">=</span> <span class="cm-operator">-</span><span class="cm-number">500</span>; <span class="cm-variable-2">yy</span> <span class="cm-operator">&lt;</span> <span class="cm-number">500</span>; <span class="cm-variable-2">yy</span> <span class="cm-operator">+=</span> <span class="cm-keyword">this</span>.<span class="cm-property">gridSize</span>) {
      <span class="cm-comment">// Radial field, triangular function of r with max around r0</span>
      <span class="cm-keyword">var</span> <span class="cm-def">r</span> <span class="cm-operator">=</span> <span class="cm-variable">Math</span>.<span class="cm-property">sqrt</span>(<span class="cm-variable-2">xx</span><span class="cm-operator">*</span><span class="cm-variable-2">xx</span><span class="cm-operator">+</span><span class="cm-variable-2">yy</span><span class="cm-operator">*</span><span class="cm-variable-2">yy</span>),
          <span class="cm-def">r0</span> <span class="cm-operator">=</span> <span class="cm-number">100</span>,
          <span class="cm-def">field</span>;
      
      <span class="cm-keyword">if</span> (<span class="cm-variable-2">r</span> <span class="cm-operator">&lt;</span> <span class="cm-variable-2">r0</span>) <span class="cm-variable-2">field</span> <span class="cm-operator">=</span> <span class="cm-number">255</span> <span class="cm-operator">/</span> <span class="cm-variable-2">r0</span> <span class="cm-operator">*</span> <span class="cm-variable-2">r</span>;
      <span class="cm-keyword">else</span> <span class="cm-keyword">if</span> (<span class="cm-variable-2">r</span> <span class="cm-operator">&gt;</span> <span class="cm-variable-2">r0</span>) <span class="cm-variable-2">field</span> <span class="cm-operator">=</span> <span class="cm-number">255</span> <span class="cm-operator">-</span> <span class="cm-variable">Math</span>.<span class="cm-property">min</span>(<span class="cm-number">255</span>, (<span class="cm-variable-2">r</span> <span class="cm-operator">-</span> <span class="cm-variable-2">r0</span>)<span class="cm-operator">/</span><span class="cm-number">2</span>);
      
      <span class="cm-keyword">this</span>.<span class="cm-property">grid</span>.<span class="cm-property">push</span>({
        <span class="cm-property">x</span>: <span class="cm-variable-2">xx</span>,
        <span class="cm-property">y</span>: <span class="cm-variable-2">yy</span>,
        <span class="cm-property">busyAge</span>: <span class="cm-number">0</span>,
        <span class="cm-property">spotIndex</span>: <span class="cm-variable-2">i</span>,
        <span class="cm-property">isEdge</span>: (<span class="cm-variable-2">xx</span> <span class="cm-operator">==</span> <span class="cm-operator">-</span><span class="cm-number">500</span> <span class="cm-operator">?</span> <span class="cm-string">'left'</span> : 
                 (<span class="cm-variable-2">xx</span> <span class="cm-operator">==</span> (<span class="cm-operator">-</span><span class="cm-number">500</span> <span class="cm-operator">+</span> <span class="cm-keyword">this</span>.<span class="cm-property">gridSize</span> <span class="cm-operator">*</span> (<span class="cm-keyword">this</span>.<span class="cm-property">gridSteps</span><span class="cm-operator">-</span><span class="cm-number">1</span>)) <span class="cm-operator">?</span> <span class="cm-string">'right'</span> : 
                  (<span class="cm-variable-2">yy</span> <span class="cm-operator">==</span> <span class="cm-operator">-</span><span class="cm-number">500</span> <span class="cm-operator">?</span> <span class="cm-string">'top'</span> : 
                   (<span class="cm-variable-2">yy</span> <span class="cm-operator">==</span> (<span class="cm-operator">-</span><span class="cm-number">500</span> <span class="cm-operator">+</span> <span class="cm-keyword">this</span>.<span class="cm-property">gridSize</span> <span class="cm-operator">*</span>(<span class="cm-keyword">this</span>.<span class="cm-property">gridSteps</span><span class="cm-operator">-</span><span class="cm-number">1</span>)) <span class="cm-operator">?</span> <span class="cm-string">'bottom'</span> : 
                    <span class="cm-atom">false</span>
                   )
                  )
                 )
                ),
        <span class="cm-property">field</span>: <span class="cm-variable-2">field</span>
      });
      <span class="cm-variable-2">i</span><span class="cm-operator">++</span>;
    }
  }
  <span class="cm-keyword">this</span>.<span class="cm-property">gridMaxIndex</span> <span class="cm-operator">=</span> <span class="cm-variable-2">i</span>;
  
  <span class="cm-comment">// Counters for UI</span>
  <span class="cm-keyword">this</span>.<span class="cm-property">drawnInLastFrame</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;
  <span class="cm-keyword">this</span>.<span class="cm-property">deathCount</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;
  
  <span class="cm-keyword">this</span>.<span class="cm-property">initDraw</span>();
};
<span class="cm-variable">App</span>.<span class="cm-property">evolve</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span>() {
  <span class="cm-keyword">var</span> <span class="cm-def">time1</span> <span class="cm-operator">=</span> <span class="cm-variable">performance</span>.<span class="cm-property">now</span>();
  
  <span class="cm-keyword">this</span>.<span class="cm-property">stepCount</span><span class="cm-operator">++</span>;
  
  <span class="cm-comment">// Increment all grid ages</span>
  <span class="cm-keyword">this</span>.<span class="cm-property">grid</span>.<span class="cm-property">forEach</span>(<span class="cm-keyword">function</span>(<span class="cm-def">e</span>) {
    <span class="cm-keyword">if</span> (<span class="cm-variable-2">e</span>.<span class="cm-property">busyAge</span> <span class="cm-operator">&gt;</span> <span class="cm-number">0</span>) <span class="cm-variable-2">e</span>.<span class="cm-property">busyAge</span><span class="cm-operator">++</span>;
  });
  
  <span class="cm-keyword">if</span> (<span class="cm-keyword">this</span>.<span class="cm-property">stepCount</span> <span class="cm-operator">%</span> <span class="cm-keyword">this</span>.<span class="cm-property">birthFreq</span> <span class="cm-operator">==</span> <span class="cm-number">0</span> <span class="cm-operator">&amp;&amp;</span> (<span class="cm-keyword">this</span>.<span class="cm-property">particles</span>.<span class="cm-property">length</span> <span class="cm-operator">+</span> <span class="cm-keyword">this</span>.<span class="cm-property">popPerBirth</span>) <span class="cm-operator">&lt;</span> <span class="cm-keyword">this</span>.<span class="cm-property">maxPop</span>) {
    <span class="cm-keyword">this</span>.<span class="cm-property">birth</span>();
  }
  <span class="cm-variable">App</span>.<span class="cm-property">move</span>();
  <span class="cm-variable">App</span>.<span class="cm-property">draw</span>();
  
  <span class="cm-keyword">var</span> <span class="cm-def">time2</span> <span class="cm-operator">=</span> <span class="cm-variable">performance</span>.<span class="cm-property">now</span>();
  
  <span class="cm-comment">// Update UI</span>
  <span class="cm-variable">document</span>.<span class="cm-property">getElementsByClassName</span>(<span class="cm-string">'dead'</span>)[<span class="cm-number">0</span>].<span class="cm-property">textContent</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">deathCount</span>;
  <span class="cm-variable">document</span>.<span class="cm-property">getElementsByClassName</span>(<span class="cm-string">'alive'</span>)[<span class="cm-number">0</span>].<span class="cm-property">textContent</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">particles</span>.<span class="cm-property">length</span>;
  <span class="cm-variable">document</span>.<span class="cm-property">getElementsByClassName</span>(<span class="cm-string">'fps'</span>)[<span class="cm-number">0</span>].<span class="cm-property">textContent</span> <span class="cm-operator">=</span> <span class="cm-variable">Math</span>.<span class="cm-property">floor</span>(<span class="cm-number">1000</span> <span class="cm-operator">/</span> (<span class="cm-variable-2">time2</span> <span class="cm-operator">-</span> <span class="cm-variable-2">time1</span>));
  <span class="cm-variable">document</span>.<span class="cm-property">getElementsByClassName</span>(<span class="cm-string">'drawn'</span>)[<span class="cm-number">0</span>].<span class="cm-property">textContent</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">drawnInLastFrame</span>;
  
};
<span class="cm-variable">App</span>.<span class="cm-property">birth</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span>() {
  <span class="cm-keyword">var</span> <span class="cm-def">x</span>, <span class="cm-def">y</span>;
  <span class="cm-keyword">var</span> <span class="cm-def">gridSpotIndex</span> <span class="cm-operator">=</span> <span class="cm-variable">Math</span>.<span class="cm-property">floor</span>(<span class="cm-variable">Math</span>.<span class="cm-property">random</span>() <span class="cm-operator">*</span> <span class="cm-keyword">this</span>.<span class="cm-property">gridMaxIndex</span>),
      <span class="cm-def">gridSpot</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">grid</span>[<span class="cm-variable-2">gridSpotIndex</span>],
      <span class="cm-def">x</span> <span class="cm-operator">=</span> <span class="cm-variable-2">gridSpot</span>.<span class="cm-property">x</span>, <span class="cm-def">y</span> <span class="cm-operator">=</span> <span class="cm-variable-2">gridSpot</span>.<span class="cm-property">y</span>;
  
  <span class="cm-keyword">var</span> <span class="cm-def">particle</span> <span class="cm-operator">=</span> {
    <span class="cm-property">hue</span>: <span class="cm-number">200</span>,<span class="cm-comment">// + Math.floor(50*Math.random()),</span>
    <span class="cm-property">sat</span>: <span class="cm-number">95</span>,<span class="cm-comment">//30 + Math.floor(70*Math.random()),</span>
    <span class="cm-property">lum</span>: <span class="cm-number">20</span> <span class="cm-operator">+</span> <span class="cm-variable">Math</span>.<span class="cm-property">floor</span>(<span class="cm-number">40</span><span class="cm-operator">*</span><span class="cm-variable">Math</span>.<span class="cm-property">random</span>()),
    <span class="cm-property">x</span>: <span class="cm-variable-2">x</span>, <span class="cm-property">y</span>: <span class="cm-variable-2">y</span>,
    <span class="cm-property">xLast</span>: <span class="cm-variable-2">x</span>, <span class="cm-property">yLast</span>: <span class="cm-variable-2">y</span>,
    <span class="cm-property">xSpeed</span>: <span class="cm-number">0</span>, <span class="cm-property">ySpeed</span>: <span class="cm-number">0</span>,
    <span class="cm-property">age</span>: <span class="cm-number">0</span>,
    <span class="cm-property">ageSinceStuck</span>: <span class="cm-number">0</span>,
    <span class="cm-property">attractor</span>: {
      <span class="cm-property">oldIndex</span>: <span class="cm-variable-2">gridSpotIndex</span>,
      <span class="cm-property">gridSpotIndex</span>: <span class="cm-variable-2">gridSpotIndex</span>,<span class="cm-comment">// Pop at random position on grid</span>
    },
    <span class="cm-property">name</span>: <span class="cm-string">'seed-'</span> <span class="cm-operator">+</span> <span class="cm-variable">Math</span>.<span class="cm-property">ceil</span>(<span class="cm-number">10000000</span> <span class="cm-operator">*</span> <span class="cm-variable">Math</span>.<span class="cm-property">random</span>())
  };
  <span class="cm-keyword">this</span>.<span class="cm-property">particles</span>.<span class="cm-property">push</span>(<span class="cm-variable-2">particle</span>);
};
<span class="cm-variable">App</span>.<span class="cm-property">kill</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span>(<span class="cm-def">particleName</span>) {
 <span class="cm-keyword">var</span> <span class="cm-def">newArray</span> <span class="cm-operator">=</span> <span class="cm-variable">_</span>.<span class="cm-property">reject</span>(<span class="cm-keyword">this</span>.<span class="cm-property">particles</span>, <span class="cm-keyword">function</span>(<span class="cm-def">seed</span>) {
    <span class="cm-keyword">return</span> (<span class="cm-variable-2">seed</span>.<span class="cm-property">name</span> <span class="cm-operator">==</span> <span class="cm-variable-2">particleName</span>);
  });
  <span class="cm-keyword">this</span>.<span class="cm-property">particles</span> <span class="cm-operator">=</span> <span class="cm-variable">_</span>.<span class="cm-property">cloneDeep</span>(<span class="cm-variable-2">newArray</span>);
};
<span class="cm-variable">App</span>.<span class="cm-property">move</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span>() {
  <span class="cm-keyword">for</span> (<span class="cm-keyword">var</span> <span class="cm-def">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable-2">i</span> <span class="cm-operator">&lt;</span> <span class="cm-keyword">this</span>.<span class="cm-property">particles</span>.<span class="cm-property">length</span>; <span class="cm-variable-2">i</span><span class="cm-operator">++</span>) {
    <span class="cm-comment">// Get particle</span>
    <span class="cm-keyword">var</span> <span class="cm-def">p</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">particles</span>[<span class="cm-variable-2">i</span>];
    
    <span class="cm-comment">// Save last position</span>
    <span class="cm-variable-2">p</span>.<span class="cm-property">xLast</span> <span class="cm-operator">=</span> <span class="cm-variable-2">p</span>.<span class="cm-property">x</span>; <span class="cm-variable-2">p</span>.<span class="cm-property">yLast</span> <span class="cm-operator">=</span> <span class="cm-variable-2">p</span>.<span class="cm-property">y</span>;
    
    <span class="cm-comment">// Attractor and corresponding grid spot</span>
    <span class="cm-keyword">var</span> <span class="cm-def">index</span> <span class="cm-operator">=</span> <span class="cm-variable-2">p</span>.<span class="cm-property">attractor</span>.<span class="cm-property">gridSpotIndex</span>,
        <span class="cm-def">gridSpot</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">grid</span>[<span class="cm-variable-2">index</span>];
    
    <span class="cm-comment">// Maybe move attractor and with certain constraints</span>
    <span class="cm-keyword">if</span> (<span class="cm-variable">Math</span>.<span class="cm-property">random</span>() <span class="cm-operator">&lt;</span> <span class="cm-number">0.5</span>) {
      <span class="cm-comment">// Move attractor</span>
      <span class="cm-keyword">if</span> (<span class="cm-operator">!</span><span class="cm-variable-2">gridSpot</span>.<span class="cm-property">isEdge</span>) {
        <span class="cm-comment">// Change particle's attractor grid spot and local move function's grid spot</span>
        <span class="cm-keyword">var</span> <span class="cm-def">topIndex</span> <span class="cm-operator">=</span> <span class="cm-variable-2">index</span> <span class="cm-operator">-</span> <span class="cm-number">1</span>,
            <span class="cm-def">bottomIndex</span> <span class="cm-operator">=</span> <span class="cm-variable-2">index</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>,
            <span class="cm-def">leftIndex</span> <span class="cm-operator">=</span> <span class="cm-variable-2">index</span> <span class="cm-operator">-</span> <span class="cm-keyword">this</span>.<span class="cm-property">gridSteps</span>,
            <span class="cm-def">rightIndex</span> <span class="cm-operator">=</span> <span class="cm-variable-2">index</span> <span class="cm-operator">+</span> <span class="cm-keyword">this</span>.<span class="cm-property">gridSteps</span>,
            <span class="cm-def">topSpot</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">grid</span>[<span class="cm-variable-2">topIndex</span>],
            <span class="cm-def">bottomSpot</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">grid</span>[<span class="cm-variable-2">bottomIndex</span>],
            <span class="cm-def">leftSpot</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">grid</span>[<span class="cm-variable-2">leftIndex</span>],
            <span class="cm-def">rightSpot</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">grid</span>[<span class="cm-variable-2">rightIndex</span>];
        
        <span class="cm-comment">// Choose neighbour with highest field value (with some desobedience...)</span>
        <span class="cm-keyword">var</span> <span class="cm-def">chaos</span> <span class="cm-operator">=</span> <span class="cm-number">30</span>;
        <span class="cm-keyword">var</span> <span class="cm-def">maxFieldSpot</span> <span class="cm-operator">=</span> <span class="cm-variable">_</span>.<span class="cm-property">maxBy</span>([<span class="cm-variable-2">topSpot</span>, <span class="cm-variable-2">bottomSpot</span>, <span class="cm-variable-2">leftSpot</span>, <span class="cm-variable-2">rightSpot</span>], <span class="cm-keyword">function</span>(<span class="cm-def">e</span>) {
          <span class="cm-keyword">return</span> <span class="cm-variable-2">e</span>.<span class="cm-property">field</span> <span class="cm-operator">+</span> <span class="cm-variable-2">chaos</span> <span class="cm-operator">*</span> <span class="cm-variable">Math</span>.<span class="cm-property">random</span>()
        });
        
        <span class="cm-keyword">var</span> <span class="cm-def">potentialNewGridSpot</span> <span class="cm-operator">=</span> <span class="cm-variable-2">maxFieldSpot</span>;
        <span class="cm-keyword">if</span> (<span class="cm-variable-2">potentialNewGridSpot</span>.<span class="cm-property">busyAge</span> <span class="cm-operator">==</span> <span class="cm-number">0</span> <span class="cm-operator">||</span> <span class="cm-variable-2">potentialNewGridSpot</span>.<span class="cm-property">busyAge</span> <span class="cm-operator">&gt;</span> <span class="cm-number">15</span>) {<span class="cm-comment">// Allow wall fading</span>
        <span class="cm-comment">//if (potentialNewGridSpot.busyAge == 0) {// Spots busy forever</span>
          <span class="cm-comment">// Ok it's free let's go there</span>
          <span class="cm-variable-2">p</span>.<span class="cm-property">ageSinceStuck</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;<span class="cm-comment">// Not stuck anymore yay</span>
          <span class="cm-variable-2">p</span>.<span class="cm-property">attractor</span>.<span class="cm-property">oldIndex</span> <span class="cm-operator">=</span> <span class="cm-variable-2">index</span>;
          <span class="cm-variable-2">p</span>.<span class="cm-property">attractor</span>.<span class="cm-property">gridSpotIndex</span> <span class="cm-operator">=</span> <span class="cm-variable-2">potentialNewGridSpot</span>.<span class="cm-property">spotIndex</span>;
          <span class="cm-variable-2">gridSpot</span> <span class="cm-operator">=</span> <span class="cm-variable-2">potentialNewGridSpot</span>;
          <span class="cm-variable-2">gridSpot</span>.<span class="cm-property">busyAge</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>;
        } <span class="cm-keyword">else</span> <span class="cm-variable-2">p</span>.<span class="cm-property">ageSinceStuck</span><span class="cm-operator">++</span>;
        
      } <span class="cm-keyword">else</span> <span class="cm-variable-2">p</span>.<span class="cm-property">ageSinceStuck</span><span class="cm-operator">++</span>;
      
      <span class="cm-keyword">if</span> (<span class="cm-variable-2">p</span>.<span class="cm-property">ageSinceStuck</span> <span class="cm-operator">==</span> <span class="cm-number">10</span>) <span class="cm-keyword">this</span>.<span class="cm-property">kill</span>(<span class="cm-variable-2">p</span>.<span class="cm-property">name</span>);
    }
    
    <span class="cm-comment">// Spring attractor to center with viscosity</span>
    <span class="cm-keyword">var</span> <span class="cm-def">k</span> <span class="cm-operator">=</span> <span class="cm-number">8</span>, <span class="cm-def">visc</span> <span class="cm-operator">=</span> <span class="cm-number">0.4</span>;
    <span class="cm-keyword">var</span> <span class="cm-def">dx</span> <span class="cm-operator">=</span> <span class="cm-variable-2">p</span>.<span class="cm-property">x</span> <span class="cm-operator">-</span> <span class="cm-variable-2">gridSpot</span>.<span class="cm-property">x</span>,
        <span class="cm-def">dy</span> <span class="cm-operator">=</span> <span class="cm-variable-2">p</span>.<span class="cm-property">y</span> <span class="cm-operator">-</span> <span class="cm-variable-2">gridSpot</span>.<span class="cm-property">y</span>,
        <span class="cm-def">dist</span> <span class="cm-operator">=</span> <span class="cm-variable">Math</span>.<span class="cm-property">sqrt</span>(<span class="cm-variable-2">dx</span><span class="cm-operator">*</span><span class="cm-variable-2">dx</span> <span class="cm-operator">+</span> <span class="cm-variable-2">dy</span><span class="cm-operator">*</span><span class="cm-variable-2">dy</span>);
    
    <span class="cm-comment">// Spring</span>
    <span class="cm-keyword">var</span> <span class="cm-def">xAcc</span> <span class="cm-operator">=</span> <span class="cm-operator">-</span><span class="cm-variable-2">k</span> <span class="cm-operator">*</span> <span class="cm-variable-2">dx</span>,
        <span class="cm-def">yAcc</span> <span class="cm-operator">=</span> <span class="cm-operator">-</span><span class="cm-variable-2">k</span> <span class="cm-operator">*</span> <span class="cm-variable-2">dy</span>;
    
    <span class="cm-variable-2">p</span>.<span class="cm-property">xSpeed</span> <span class="cm-operator">+=</span> <span class="cm-variable-2">xAcc</span>; <span class="cm-variable-2">p</span>.<span class="cm-property">ySpeed</span> <span class="cm-operator">+=</span> <span class="cm-variable-2">yAcc</span>;
    
    <span class="cm-comment">// Calm the f*ck down</span>
    <span class="cm-variable-2">p</span>.<span class="cm-property">xSpeed</span> <span class="cm-operator">*=</span> <span class="cm-variable-2">visc</span>; <span class="cm-variable-2">p</span>.<span class="cm-property">ySpeed</span> <span class="cm-operator">*=</span> <span class="cm-variable-2">visc</span>;
    
    <span class="cm-comment">// Store stuff in particle brain</span>
    <span class="cm-variable-2">p</span>.<span class="cm-property">speed</span> <span class="cm-operator">=</span> <span class="cm-variable">Math</span>.<span class="cm-property">sqrt</span>(<span class="cm-variable-2">p</span>.<span class="cm-property">xSpeed</span> <span class="cm-operator">*</span> <span class="cm-variable-2">p</span>.<span class="cm-property">xSpeed</span> <span class="cm-operator">+</span> <span class="cm-variable-2">p</span>.<span class="cm-property">ySpeed</span> <span class="cm-operator">*</span> <span class="cm-variable-2">p</span>.<span class="cm-property">ySpeed</span>);
    <span class="cm-variable-2">p</span>.<span class="cm-property">dist</span> <span class="cm-operator">=</span> <span class="cm-variable-2">dist</span>;
    
    <span class="cm-comment">// Update position</span>
    <span class="cm-variable-2">p</span>.<span class="cm-property">x</span> <span class="cm-operator">+=</span> <span class="cm-number">0.1</span> <span class="cm-operator">*</span> <span class="cm-variable-2">p</span>.<span class="cm-property">xSpeed</span>; <span class="cm-variable-2">p</span>.<span class="cm-property">y</span> <span class="cm-operator">+=</span> <span class="cm-number">0.1</span> <span class="cm-operator">*</span> <span class="cm-variable-2">p</span>.<span class="cm-property">ySpeed</span>;
    
    <span class="cm-comment">// Get older</span>
    <span class="cm-variable-2">p</span>.<span class="cm-property">age</span><span class="cm-operator">++</span>;
    
    <span class="cm-comment">// Kill if too old</span>
    <span class="cm-keyword">if</span> (<span class="cm-variable-2">p</span>.<span class="cm-property">age</span> <span class="cm-operator">&gt;</span> <span class="cm-keyword">this</span>.<span class="cm-property">lifespan</span>) {
      <span class="cm-keyword">this</span>.<span class="cm-property">kill</span>(<span class="cm-variable-2">p</span>.<span class="cm-property">name</span>);
      <span class="cm-keyword">this</span>.<span class="cm-property">deathCount</span><span class="cm-operator">++</span>;
    }
  }
};
<span class="cm-variable">App</span>.<span class="cm-property">initDraw</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span>() {
  <span class="cm-keyword">this</span>.<span class="cm-property">ctx</span>.<span class="cm-property">beginPath</span>();
  <span class="cm-keyword">this</span>.<span class="cm-property">ctx</span>.<span class="cm-property">rect</span>(<span class="cm-number">0</span>, <span class="cm-number">0</span>, <span class="cm-keyword">this</span>.<span class="cm-property">width</span>, <span class="cm-keyword">this</span>.<span class="cm-property">height</span>);
  <span class="cm-keyword">this</span>.<span class="cm-property">ctx</span>.<span class="cm-property">fillStyle</span> <span class="cm-operator">=</span> <span class="cm-string">'black'</span>;
  <span class="cm-keyword">this</span>.<span class="cm-property">ctx</span>.<span class="cm-property">fill</span>();
  <span class="cm-keyword">this</span>.<span class="cm-property">ctx</span>.<span class="cm-property">closePath</span>();
};
<span class="cm-variable">App</span>.<span class="cm-property">draw</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span>() {
  <span class="cm-keyword">this</span>.<span class="cm-property">drawnInLastFrame</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;
  <span class="cm-keyword">if</span> (<span class="cm-operator">!</span><span class="cm-keyword">this</span>.<span class="cm-property">particles</span>.<span class="cm-property">length</span>) <span class="cm-keyword">return</span> <span class="cm-atom">false</span>;
  
  <span class="cm-keyword">this</span>.<span class="cm-property">ctx</span>.<span class="cm-property">beginPath</span>();
  <span class="cm-keyword">this</span>.<span class="cm-property">ctx</span>.<span class="cm-property">rect</span>(<span class="cm-number">0</span>, <span class="cm-number">0</span>, <span class="cm-keyword">this</span>.<span class="cm-property">width</span>, <span class="cm-keyword">this</span>.<span class="cm-property">height</span>);
  <span class="cm-keyword">this</span>.<span class="cm-property">ctx</span>.<span class="cm-property">fillStyle</span> <span class="cm-operator">=</span> <span class="cm-string">'rgba(0, 0, 0, 0.1)'</span>;
  <span class="cm-comment">//this.ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';</span>
  <span class="cm-keyword">this</span>.<span class="cm-property">ctx</span>.<span class="cm-property">fill</span>();
  <span class="cm-keyword">this</span>.<span class="cm-property">ctx</span>.<span class="cm-property">closePath</span>();
  
  <span class="cm-keyword">for</span> (<span class="cm-keyword">var</span> <span class="cm-def">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable-2">i</span> <span class="cm-operator">&lt;</span> <span class="cm-keyword">this</span>.<span class="cm-property">particles</span>.<span class="cm-property">length</span>; <span class="cm-variable-2">i</span><span class="cm-operator">++</span>) {
    <span class="cm-comment">// Draw particle</span>
    <span class="cm-keyword">var</span> <span class="cm-def">p</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">particles</span>[<span class="cm-variable-2">i</span>];
    
    <span class="cm-keyword">var</span> <span class="cm-def">h</span>, <span class="cm-def">s</span>, <span class="cm-def">l</span>, <span class="cm-def">a</span>;
    
    <span class="cm-variable-2">h</span> <span class="cm-operator">=</span> <span class="cm-variable-2">p</span>.<span class="cm-property">hue</span> <span class="cm-operator">+</span> <span class="cm-keyword">this</span>.<span class="cm-property">stepCount</span><span class="cm-operator">/</span><span class="cm-number">30</span>;
    <span class="cm-variable-2">s</span> <span class="cm-operator">=</span> <span class="cm-variable-2">p</span>.<span class="cm-property">sat</span>;
    <span class="cm-variable-2">l</span> <span class="cm-operator">=</span> <span class="cm-variable-2">p</span>.<span class="cm-property">lum</span>;
    <span class="cm-variable-2">a</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>;
    
    <span class="cm-keyword">var</span> <span class="cm-def">last</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">dataXYtoCanvasXY</span>(<span class="cm-variable-2">p</span>.<span class="cm-property">xLast</span>, <span class="cm-variable-2">p</span>.<span class="cm-property">yLast</span>),
        <span class="cm-def">now</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">dataXYtoCanvasXY</span>(<span class="cm-variable-2">p</span>.<span class="cm-property">x</span>, <span class="cm-variable-2">p</span>.<span class="cm-property">y</span>);
    <span class="cm-keyword">var</span> <span class="cm-def">attracSpot</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">grid</span>[<span class="cm-variable-2">p</span>.<span class="cm-property">attractor</span>.<span class="cm-property">gridSpotIndex</span>],
        <span class="cm-def">attracXY</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">dataXYtoCanvasXY</span>(<span class="cm-variable-2">attracSpot</span>.<span class="cm-property">x</span>, <span class="cm-variable-2">attracSpot</span>.<span class="cm-property">y</span>);
    <span class="cm-keyword">var</span> <span class="cm-def">oldAttracSpot</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">grid</span>[<span class="cm-variable-2">p</span>.<span class="cm-property">attractor</span>.<span class="cm-property">oldIndex</span>],
        <span class="cm-def">oldAttracXY</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">dataXYtoCanvasXY</span>(<span class="cm-variable-2">oldAttracSpot</span>.<span class="cm-property">x</span>, <span class="cm-variable-2">oldAttracSpot</span>.<span class="cm-property">y</span>);
    
    <span class="cm-keyword">this</span>.<span class="cm-property">ctx</span>.<span class="cm-property">beginPath</span>();
    
    <span class="cm-keyword">this</span>.<span class="cm-property">ctx</span>.<span class="cm-property">strokeStyle</span> <span class="cm-operator">=</span> <span class="cm-string">'hsla('</span> <span class="cm-operator">+</span> <span class="cm-variable-2">h</span> <span class="cm-operator">+</span> <span class="cm-string">', '</span> <span class="cm-operator">+</span> <span class="cm-variable-2">s</span> <span class="cm-operator">+</span> <span class="cm-string">'%, '</span> <span class="cm-operator">+</span> <span class="cm-variable-2">l</span> <span class="cm-operator">+</span> <span class="cm-string">'%, '</span> <span class="cm-operator">+</span> <span class="cm-variable-2">a</span> <span class="cm-operator">+</span> <span class="cm-string">')'</span>;
    <span class="cm-keyword">this</span>.<span class="cm-property">ctx</span>.<span class="cm-property">fillStyle</span> <span class="cm-operator">=</span> <span class="cm-string">'hsla('</span> <span class="cm-operator">+</span> <span class="cm-variable-2">h</span> <span class="cm-operator">+</span> <span class="cm-string">', '</span> <span class="cm-operator">+</span> <span class="cm-variable-2">s</span> <span class="cm-operator">+</span> <span class="cm-string">'%, '</span> <span class="cm-operator">+</span> <span class="cm-variable-2">l</span> <span class="cm-operator">+</span> <span class="cm-string">'%, '</span> <span class="cm-operator">+</span> <span class="cm-variable-2">a</span> <span class="cm-operator">+</span> <span class="cm-string">')'</span>;
    
    <span class="cm-comment">// Particle trail</span>
    <span class="cm-keyword">this</span>.<span class="cm-property">ctx</span>.<span class="cm-property">moveTo</span>(<span class="cm-variable-2">last</span>.<span class="cm-property">x</span>, <span class="cm-variable-2">last</span>.<span class="cm-property">y</span>);
    <span class="cm-keyword">this</span>.<span class="cm-property">ctx</span>.<span class="cm-property">lineTo</span>(<span class="cm-variable-2">now</span>.<span class="cm-property">x</span>, <span class="cm-variable-2">now</span>.<span class="cm-property">y</span>);
    
    <span class="cm-keyword">this</span>.<span class="cm-property">ctx</span>.<span class="cm-property">lineWidth</span> <span class="cm-operator">=</span> <span class="cm-number">1.5</span> <span class="cm-operator">*</span> <span class="cm-keyword">this</span>.<span class="cm-property">dataToImageRatio</span>;
    <span class="cm-keyword">this</span>.<span class="cm-property">ctx</span>.<span class="cm-property">stroke</span>();
    <span class="cm-keyword">this</span>.<span class="cm-property">ctx</span>.<span class="cm-property">closePath</span>();
    
    <span class="cm-comment">// Attractor positions</span>
    <span class="cm-keyword">this</span>.<span class="cm-property">ctx</span>.<span class="cm-property">beginPath</span>();
    <span class="cm-keyword">this</span>.<span class="cm-property">ctx</span>.<span class="cm-property">lineWidth</span> <span class="cm-operator">=</span> <span class="cm-number">1.5</span> <span class="cm-operator">*</span> <span class="cm-keyword">this</span>.<span class="cm-property">dataToImageRatio</span>;
    <span class="cm-keyword">this</span>.<span class="cm-property">ctx</span>.<span class="cm-property">moveTo</span>(<span class="cm-variable-2">oldAttracXY</span>.<span class="cm-property">x</span>, <span class="cm-variable-2">oldAttracXY</span>.<span class="cm-property">y</span>);
    <span class="cm-keyword">this</span>.<span class="cm-property">ctx</span>.<span class="cm-property">lineTo</span>(<span class="cm-variable-2">attracXY</span>.<span class="cm-property">x</span>, <span class="cm-variable-2">attracXY</span>.<span class="cm-property">y</span>);
    <span class="cm-keyword">this</span>.<span class="cm-property">ctx</span>.<span class="cm-property">arc</span>(<span class="cm-variable-2">attracXY</span>.<span class="cm-property">x</span>, <span class="cm-variable-2">attracXY</span>.<span class="cm-property">y</span>, <span class="cm-number">1.5</span> <span class="cm-operator">*</span> <span class="cm-keyword">this</span>.<span class="cm-property">dataToImageRatio</span>, <span class="cm-number">0</span>, <span class="cm-number">2</span> <span class="cm-operator">*</span> <span class="cm-variable">Math</span>.<span class="cm-property">PI</span>, <span class="cm-atom">false</span>);
    
    <span class="cm-comment">//a /= 20;</span>
    <span class="cm-keyword">this</span>.<span class="cm-property">ctx</span>.<span class="cm-property">strokeStyle</span> <span class="cm-operator">=</span> <span class="cm-string">'hsla('</span> <span class="cm-operator">+</span> <span class="cm-variable-2">h</span> <span class="cm-operator">+</span> <span class="cm-string">', '</span> <span class="cm-operator">+</span> <span class="cm-variable-2">s</span> <span class="cm-operator">+</span> <span class="cm-string">'%, '</span> <span class="cm-operator">+</span> <span class="cm-variable-2">l</span> <span class="cm-operator">+</span> <span class="cm-string">'%, '</span> <span class="cm-operator">+</span> <span class="cm-variable-2">a</span> <span class="cm-operator">+</span> <span class="cm-string">')'</span>;
    <span class="cm-keyword">this</span>.<span class="cm-property">ctx</span>.<span class="cm-property">fillStyle</span> <span class="cm-operator">=</span> <span class="cm-string">'hsla('</span> <span class="cm-operator">+</span> <span class="cm-variable-2">h</span> <span class="cm-operator">+</span> <span class="cm-string">', '</span> <span class="cm-operator">+</span> <span class="cm-variable-2">s</span> <span class="cm-operator">+</span> <span class="cm-string">'%, '</span> <span class="cm-operator">+</span> <span class="cm-variable-2">l</span> <span class="cm-operator">+</span> <span class="cm-string">'%, '</span> <span class="cm-operator">+</span> <span class="cm-variable-2">a</span> <span class="cm-operator">+</span> <span class="cm-string">')'</span>;
    <span class="cm-keyword">this</span>.<span class="cm-property">ctx</span>.<span class="cm-property">stroke</span>();
    <span class="cm-keyword">this</span>.<span class="cm-property">ctx</span>.<span class="cm-property">fill</span>();
    
    <span class="cm-keyword">this</span>.<span class="cm-property">ctx</span>.<span class="cm-property">closePath</span>();
    
    <span class="cm-comment">// UI counter</span>
    <span class="cm-keyword">this</span>.<span class="cm-property">drawnInLastFrame</span><span class="cm-operator">++</span>;
  }
  
};
<span class="cm-variable">App</span>.<span class="cm-property">dataXYtoCanvasXY</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span>(<span class="cm-def">x</span>, <span class="cm-def">y</span>) {
  <span class="cm-keyword">var</span> <span class="cm-def">zoom</span> <span class="cm-operator">=</span> <span class="cm-number">1.6</span>;
  <span class="cm-keyword">var</span> <span class="cm-def">xx</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">xC</span> <span class="cm-operator">+</span> <span class="cm-variable-2">x</span> <span class="cm-operator">*</span> <span class="cm-variable-2">zoom</span> <span class="cm-operator">*</span> <span class="cm-keyword">this</span>.<span class="cm-property">dataToImageRatio</span>,
      <span class="cm-def">yy</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">yC</span> <span class="cm-operator">+</span> <span class="cm-variable-2">y</span> <span class="cm-operator">*</span> <span class="cm-variable-2">zoom</span> <span class="cm-operator">*</span> <span class="cm-keyword">this</span>.<span class="cm-property">dataToImageRatio</span>;
  
  <span class="cm-keyword">return</span> {<span class="cm-property">x</span>: <span class="cm-variable-2">xx</span>, <span class="cm-property">y</span>: <span class="cm-variable-2">yy</span>};
};

<span class="cm-variable">document</span>.<span class="cm-property">addEventListener</span>(<span class="cm-string">'DOMContentLoaded'</span>, <span class="cm-keyword">function</span>() {
  <span class="cm-variable">App</span>.<span class="cm-property">setup</span>();
  <span class="cm-variable">App</span>.<span class="cm-property">draw</span>();
  
  <span class="cm-keyword">var</span> <span class="cm-def">frame</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span>() {
    <span class="cm-variable">App</span>.<span class="cm-property">evolve</span>();
    <span class="cm-variable">requestAnimationFrame</span>(<span class="cm-variable-2">frame</span>);
  };
  <span class="cm-variable-2">frame</span>();
});

 
<span class="cm-comment">/**</span>
<span class="cm-comment"> * Some old util I use at times</span>
<span class="cm-comment"> *</span>
<span class="cm-comment"> * @param {Number} Xstart X value of the segment starting point</span>
<span class="cm-comment"> * @param {Number} Ystart Y value of the segment starting point</span>
<span class="cm-comment"> * @param {Number} Xtarget X value of the segment target point</span>
<span class="cm-comment"> * @param {Number} Ytarget Y value of the segment target point</span>
<span class="cm-comment"> * @param {Boolean} realOrWeb true if Real (Y towards top), false if Web (Y towards bottom)</span>
<span class="cm-comment"> * @returns {Number} Angle between 0 and 2PI</span>
<span class="cm-comment"> */</span>
<span class="cm-variable">segmentAngleRad</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span>(<span class="cm-def">Xstart</span>, <span class="cm-def">Ystart</span>, <span class="cm-def">Xtarget</span>, <span class="cm-def">Ytarget</span>, <span class="cm-def">realOrWeb</span>) {
  <span class="cm-keyword">var</span> <span class="cm-def">result</span>;<span class="cm-comment">// Will range between 0 and 2PI</span>
  <span class="cm-keyword">if</span> (<span class="cm-variable-2">Xstart</span> <span class="cm-operator">==</span> <span class="cm-variable-2">Xtarget</span>) {
    <span class="cm-keyword">if</span> (<span class="cm-variable-2">Ystart</span> <span class="cm-operator">==</span> <span class="cm-variable-2">Ytarget</span>) {
      <span class="cm-variable-2">result</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; 
    } <span class="cm-keyword">else</span> <span class="cm-keyword">if</span> (<span class="cm-variable-2">Ystart</span> <span class="cm-operator">&lt;</span> <span class="cm-variable-2">Ytarget</span>) {
      <span class="cm-variable-2">result</span> <span class="cm-operator">=</span> <span class="cm-variable">Math</span>.<span class="cm-property">PI</span><span class="cm-operator">/</span><span class="cm-number">2</span>;
    } <span class="cm-keyword">else</span> <span class="cm-keyword">if</span> (<span class="cm-variable-2">Ystart</span> <span class="cm-operator">&gt;</span> <span class="cm-variable-2">Ytarget</span>) {
      <span class="cm-variable-2">result</span> <span class="cm-operator">=</span> <span class="cm-number">3</span><span class="cm-operator">*</span><span class="cm-variable">Math</span>.<span class="cm-property">PI</span><span class="cm-operator">/</span><span class="cm-number">2</span>;
    } <span class="cm-keyword">else</span> {}
  } <span class="cm-keyword">else</span> <span class="cm-keyword">if</span> (<span class="cm-variable-2">Xstart</span> <span class="cm-operator">&lt;</span> <span class="cm-variable-2">Xtarget</span>) {
    <span class="cm-variable-2">result</span> <span class="cm-operator">=</span> <span class="cm-variable">Math</span>.<span class="cm-property">atan</span>((<span class="cm-variable-2">Ytarget</span> <span class="cm-operator">-</span> <span class="cm-variable-2">Ystart</span>)<span class="cm-operator">/</span>(<span class="cm-variable-2">Xtarget</span> <span class="cm-operator">-</span> <span class="cm-variable-2">Xstart</span>));
  } <span class="cm-keyword">else</span> <span class="cm-keyword">if</span> (<span class="cm-variable-2">Xstart</span> <span class="cm-operator">&gt;</span> <span class="cm-variable-2">Xtarget</span>) {
    <span class="cm-variable-2">result</span> <span class="cm-operator">=</span> <span class="cm-variable">Math</span>.<span class="cm-property">PI</span> <span class="cm-operator">+</span> <span class="cm-variable">Math</span>.<span class="cm-property">atan</span>((<span class="cm-variable-2">Ytarget</span> <span class="cm-operator">-</span> <span class="cm-variable-2">Ystart</span>)<span class="cm-operator">/</span>(<span class="cm-variable-2">Xtarget</span> <span class="cm-operator">-</span> <span class="cm-variable-2">Xstart</span>));
  }
  
  <span class="cm-variable-2">result</span> <span class="cm-operator">=</span> (<span class="cm-variable-2">result</span> <span class="cm-operator">+</span> <span class="cm-number">2</span><span class="cm-operator">*</span><span class="cm-variable">Math</span>.<span class="cm-property">PI</span>)<span class="cm-operator">%</span>(<span class="cm-number">2</span><span class="cm-operator">*</span><span class="cm-variable">Math</span>.<span class="cm-property">PI</span>);
  
  <span class="cm-keyword">if</span> (<span class="cm-operator">!</span><span class="cm-variable-2">realOrWeb</span>) {
    <span class="cm-variable-2">result</span> <span class="cm-operator">=</span> <span class="cm-number">2</span><span class="cm-operator">*</span><span class="cm-variable">Math</span>.<span class="cm-property">PI</span> <span class="cm-operator">-</span> <span class="cm-variable-2">result</span>;
  }
  
  <span class="cm-keyword">return</span> <span class="cm-variable-2">result</span>;
}
</code></pre>

        </div>



    <div id="result-box" class="code-box active zoom-1" role="region" aria-label="Result">


  <iframe allow="accelerometer *; bluetooth *; camera *; encrypted-media *; display-capture *; geolocation *; gyroscope *; microphone *; midi *; clipboard-read *; clipboard-write *; web-share *; serial *; xr-spatial-tracking *" allowfullscreen="true" allowpaymentrequest="true" allowtransparency="true" class="result-iframe  " frameborder="0" id="result-iframe" loading="lazy" name="CodePen Preview for Spipa circle" sandbox="allow-downloads allow-forms allow-modals allow-pointer-lock allow-popups-to-escape-sandbox allow-popups allow-presentation allow-same-origin allow-scripts allow-top-navigation-by-user-activation" scrolling="yes" title="CodePen Preview for Spipa circle" data-src="https://codepen.io/alexandrix/fullembedgrid/oQOvYp?animations=run&amp;type=embed" src="./oQOvYp(1).html">
  </iframe>


</div>


    <div id="about-box">

  <div class="about-container">


    <div class="about-user">

        <a href="https://codepen.io/alexandrix" target="_blank" rel="noopener"><img src="./default(10).png" loading="lazy" alt="" class="about-image"></a>

      <div class="about-user-info">


        <p>
          This Pen is owned by <a href="https://codepen.io/alexandrix" target="_blank" rel="noopener">Alex Andrix</a> on <a href="https://codepen.io/" target="_blank" rel="noopener">CodePen</a>.

        </p>

        <p>
          <a href="https://codepen.io/alexandrix" target="_blank" rel="noopener" class="about-user-more">
          See more by @alexandrix on CodePen
          </a>
        </p>


      </div>

    </div>


  </div>

</div>


    <div id="resources-box" class="resources-box">

  <h3>External CSS</h3>
    <p>
      This Pen doesn't use any external CSS resources.
    </p>

  <h3>External JavaScript</h3>
    <ol class="list-of-resources">
        <li>
          <a href="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.5/lodash.min.js" target="_blank">https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.5/lodash.min.js</a>
        </li>
    </ol>

</div>


  </div>

    <footer class="embed-footer" id="embed-footer">

    <button id="resources-link" class="resources-link action-button bottom left" href="#resources-box" aria-pressed="false" role="button">
      Resources
    </button>

    <ul class="scaling-choices bottom right">
  <li><button class="action-button" id="zoom-button-1">1×</button></li>
  <li><button class="action-button" id="zoom-button-05">0.5×</button></li>
  <li><button class="action-button" id="zoom-button-025">0.25×</button></li>
</ul>

<button id="rerun-button" class="action-button rerun-button bottom right">
  Rerun
</button>

  </footer>



  <script nonce="">
    __processedPen = {"html":"&lt;div class=&quot;ui&quot;&gt;\n  &lt;p class=&quot;zoom&quot;&gt;&lt;span class=&quot;zoom zoomin&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;zoom zoomout&quot;&gt;-&lt;/span&gt;&lt;/p&gt;\n  &lt;p class=&quot;zoomlevel&quot;&gt;&lt;span class=&quot;percent&quot;&gt;100&lt;/span&gt; % - (&lt;span class=&quot;width&quot;&gt;&lt;/span&gt;px)(&lt;span class=&quot;height&quot;&gt;&lt;/span&gt;px)&lt;/p&gt;\n  &lt;p&gt;Dead: &lt;span class=&quot;dead&quot;&gt;0&lt;/span&gt;&lt;/p&gt;\n  &lt;p&gt;Alive: &lt;span class=&quot;alive&quot;&gt;0&lt;/span&gt;&lt;/p&gt;\n  &lt;p&gt;Drawn: &lt;span class=&quot;drawn&quot;&gt;0&lt;/span&gt;&lt;/p&gt;\n  &lt;p&gt;&lt;span class=&quot;fps&quot;&gt;0&lt;/span&gt; FPS&lt;/p&gt;\n  &lt;a class=&quot;save&quot; href=&quot;&quot; download=&quot;capture.png&quot;&gt;Save&lt;/a&gt;\n&lt;/div&gt;","css":"* {\n  border: none;\n  margin: 0;\n}\nhtml,\nbody {\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n}\ncanvas {\n  background: white;\n  background: radial-gradient(#FFF, #DDD);\n  transform-origin: 0 0;\n  width: 100%;\n  height: 100%;\n}\n.ui {\n  display: none;\n  position: fixed;\n  z-index: 5;\n  bottom: 0;\n  left: 0;\n  width: 120px;\n  padding: 10px;\n  background: rgba(255, 255, 255, 0.7);\n}\n.ui p {\n  font-size: 11px;\n  font-weight: 700;\n}\n.ui p.zoom {\n  margin-bottom: 5px;\n}\n.ui p.zoom span {\n  margin-right: 5px;\n  border: solid 1px #777;\n  cursor: pointer;\n  border-radius: 2px;\n}\n.ui p.zoom span.zoomin {\n  padding: 2px 5px;\n}\n.ui p.zoom span.zoomout {\n  padding: 2px 8px;\n}\n.ui p.zoom span:hover {\n  background: black;\n  color: white;\n}","js":"/**\n * @author Alex Andrix &lt;alex@alexandrix.com&gt;\n * @since 2018-12-02\n */\n\nvar App = {};\nApp.setup = function () {\n  var canvas = document.createElement(&#39;canvas&#39;);\n  this.filename = &quot;spipa&quot;;\n  canvas.width = window.innerWidth;\n  canvas.height = window.innerHeight;\n  this.canvas = canvas;\n  document.getElementsByTagName(&#39;body&#39;)[0].appendChild(canvas);\n  this.ctx = this.canvas.getContext(&#39;2d&#39;);\n  this.width = this.canvas.width;\n  this.height = this.canvas.height;\n  this.dataToImageRatio = 1;\n  this.ctx.imageSmoothingEnabled = false;\n  this.ctx.webkitImageSmoothingEnabled = false;\n  this.ctx.msImageSmoothingEnabled = false;\n  this.xC = this.width / 2;\n  this.yC = this.height / 2;\n\n  this.stepCount = 0;\n  this.particles = [];\n  this.lifespan = 1000;\n  this.popPerBirth = 1;\n  this.maxPop = 300;\n  this.birthFreq = 2;\n\n  // Build grid\n  this.gridSize = 8; // Motion coords\n  this.gridSteps = Math.floor(1000 / this.gridSize);\n  this.grid = [];\n  var i = 0;\n  for (var xx = -500; xx &lt; 500; xx += this.gridSize) {\n    for (var yy = -500; yy &lt; 500; yy += this.gridSize) {\n      // Radial field, triangular function of r with max around r0\n      var r = Math.sqrt(xx * xx + yy * yy),\n      r0 = 100,\n      field;\n\n      if (r &lt; r0) field = 255 / r0 * r;else\n      if (r &gt; r0) field = 255 - Math.min(255, (r - r0) / 2);\n\n      this.grid.push({\n        x: xx,\n        y: yy,\n        busyAge: 0,\n        spotIndex: i,\n        isEdge: xx == -500 ? &#39;left&#39; :\n        xx == -500 + this.gridSize * (this.gridSteps - 1) ? &#39;right&#39; :\n        yy == -500 ? &#39;top&#39; :\n        yy == -500 + this.gridSize * (this.gridSteps - 1) ? &#39;bottom&#39; :\n        false,\n\n\n\n\n        field: field });\n\n      i++;\n    }\n  }\n  this.gridMaxIndex = i;\n\n  // Counters for UI\n  this.drawnInLastFrame = 0;\n  this.deathCount = 0;\n\n  this.initDraw();\n};\nApp.evolve = function () {\n  var time1 = performance.now();\n\n  this.stepCount++;\n\n  // Increment all grid ages\n  this.grid.forEach(function (e) {\n    if (e.busyAge &gt; 0) e.busyAge++;\n  });\n\n  if (this.stepCount % this.birthFreq == 0 &amp;&amp; this.particles.length + this.popPerBirth &lt; this.maxPop) {\n    this.birth();\n  }\n  App.move();\n  App.draw();\n\n  var time2 = performance.now();\n\n  // Update UI\n  document.getElementsByClassName(&#39;dead&#39;)[0].textContent = this.deathCount;\n  document.getElementsByClassName(&#39;alive&#39;)[0].textContent = this.particles.length;\n  document.getElementsByClassName(&#39;fps&#39;)[0].textContent = Math.floor(1000 / (time2 - time1));\n  document.getElementsByClassName(&#39;drawn&#39;)[0].textContent = this.drawnInLastFrame;\n\n};\nApp.birth = function () {\n  var x, y;\n  var gridSpotIndex = Math.floor(Math.random() * this.gridMaxIndex),\n  gridSpot = this.grid[gridSpotIndex],\n  x = gridSpot.x,y = gridSpot.y;\n\n  var particle = {\n    hue: 200, // + Math.floor(50*Math.random()),\n    sat: 95, //30 + Math.floor(70*Math.random()),\n    lum: 20 + Math.floor(40 * Math.random()),\n    x: x, y: y,\n    xLast: x, yLast: y,\n    xSpeed: 0, ySpeed: 0,\n    age: 0,\n    ageSinceStuck: 0,\n    attractor: {\n      oldIndex: gridSpotIndex,\n      gridSpotIndex: gridSpotIndex // Pop at random position on grid\n    },\n    name: &#39;seed-&#39; + Math.ceil(10000000 * Math.random()) };\n\n  this.particles.push(particle);\n};\nApp.kill = function (particleName) {\n  var newArray = _.reject(this.particles, function (seed) {\n    return seed.name == particleName;\n  });\n  this.particles = _.cloneDeep(newArray);\n};\nApp.move = function () {\n  for (var i = 0; i &lt; this.particles.length; i++) {\n    // Get particle\n    var p = this.particles[i];\n\n    // Save last position\n    p.xLast = p.x;p.yLast = p.y;\n\n    // Attractor and corresponding grid spot\n    var index = p.attractor.gridSpotIndex,\n    gridSpot = this.grid[index];\n\n    // Maybe move attractor and with certain constraints\n    if (Math.random() &lt; 0.5) {\n      // Move attractor\n      if (!gridSpot.isEdge) {\n        // Change particle&#39;s attractor grid spot and local move function&#39;s grid spot\n        var topIndex = index - 1,\n        bottomIndex = index + 1,\n        leftIndex = index - this.gridSteps,\n        rightIndex = index + this.gridSteps,\n        topSpot = this.grid[topIndex],\n        bottomSpot = this.grid[bottomIndex],\n        leftSpot = this.grid[leftIndex],\n        rightSpot = this.grid[rightIndex];\n\n        // Choose neighbour with highest field value (with some desobedience...)\n        var chaos = 30;\n        var maxFieldSpot = _.maxBy([topSpot, bottomSpot, leftSpot, rightSpot], function (e) {\n          return e.field + chaos * Math.random();\n        });\n\n        var potentialNewGridSpot = maxFieldSpot;\n        if (potentialNewGridSpot.busyAge == 0 || potentialNewGridSpot.busyAge &gt; 15) {// Allow wall fading\n          //if (potentialNewGridSpot.busyAge == 0) {// Spots busy forever\n          // Ok it&#39;s free let&#39;s go there\n          p.ageSinceStuck = 0; // Not stuck anymore yay\n          p.attractor.oldIndex = index;\n          p.attractor.gridSpotIndex = potentialNewGridSpot.spotIndex;\n          gridSpot = potentialNewGridSpot;\n          gridSpot.busyAge = 1;\n        } else p.ageSinceStuck++;\n\n      } else p.ageSinceStuck++;\n\n      if (p.ageSinceStuck == 10) this.kill(p.name);\n    }\n\n    // Spring attractor to center with viscosity\n    var k = 8,visc = 0.4;\n    var dx = p.x - gridSpot.x,\n    dy = p.y - gridSpot.y,\n    dist = Math.sqrt(dx * dx + dy * dy);\n\n    // Spring\n    var xAcc = -k * dx,\n    yAcc = -k * dy;\n\n    p.xSpeed += xAcc;p.ySpeed += yAcc;\n\n    // Calm the f*ck down\n    p.xSpeed *= visc;p.ySpeed *= visc;\n\n    // Store stuff in particle brain\n    p.speed = Math.sqrt(p.xSpeed * p.xSpeed + p.ySpeed * p.ySpeed);\n    p.dist = dist;\n\n    // Update position\n    p.x += 0.1 * p.xSpeed;p.y += 0.1 * p.ySpeed;\n\n    // Get older\n    p.age++;\n\n    // Kill if too old\n    if (p.age &gt; this.lifespan) {\n      this.kill(p.name);\n      this.deathCount++;\n    }\n  }\n};\nApp.initDraw = function () {\n  this.ctx.beginPath();\n  this.ctx.rect(0, 0, this.width, this.height);\n  this.ctx.fillStyle = &#39;black&#39;;\n  this.ctx.fill();\n  this.ctx.closePath();\n};\nApp.draw = function () {\n  this.drawnInLastFrame = 0;\n  if (!this.particles.length) return false;\n\n  this.ctx.beginPath();\n  this.ctx.rect(0, 0, this.width, this.height);\n  this.ctx.fillStyle = &#39;rgba(0, 0, 0, 0.1)&#39;;\n  //this.ctx.fillStyle = &#39;rgba(255, 255, 255, 0.1)&#39;;\n  this.ctx.fill();\n  this.ctx.closePath();\n\n  for (var i = 0; i &lt; this.particles.length; i++) {\n    // Draw particle\n    var p = this.particles[i];\n\n    var h, s, l, a;\n\n    h = p.hue + this.stepCount / 30;\n    s = p.sat;\n    l = p.lum;\n    a = 1;\n\n    var last = this.dataXYtoCanvasXY(p.xLast, p.yLast),\n    now = this.dataXYtoCanvasXY(p.x, p.y);\n    var attracSpot = this.grid[p.attractor.gridSpotIndex],\n    attracXY = this.dataXYtoCanvasXY(attracSpot.x, attracSpot.y);\n    var oldAttracSpot = this.grid[p.attractor.oldIndex],\n    oldAttracXY = this.dataXYtoCanvasXY(oldAttracSpot.x, oldAttracSpot.y);\n\n    this.ctx.beginPath();\n\n    this.ctx.strokeStyle = &#39;hsla(&#39; + h + &#39;, &#39; + s + &#39;%, &#39; + l + &#39;%, &#39; + a + &#39;)&#39;;\n    this.ctx.fillStyle = &#39;hsla(&#39; + h + &#39;, &#39; + s + &#39;%, &#39; + l + &#39;%, &#39; + a + &#39;)&#39;;\n\n    // Particle trail\n    this.ctx.moveTo(last.x, last.y);\n    this.ctx.lineTo(now.x, now.y);\n\n    this.ctx.lineWidth = 1.5 * this.dataToImageRatio;\n    this.ctx.stroke();\n    this.ctx.closePath();\n\n    // Attractor positions\n    this.ctx.beginPath();\n    this.ctx.lineWidth = 1.5 * this.dataToImageRatio;\n    this.ctx.moveTo(oldAttracXY.x, oldAttracXY.y);\n    this.ctx.lineTo(attracXY.x, attracXY.y);\n    this.ctx.arc(attracXY.x, attracXY.y, 1.5 * this.dataToImageRatio, 0, 2 * Math.PI, false);\n\n    //a /= 20;\n    this.ctx.strokeStyle = &#39;hsla(&#39; + h + &#39;, &#39; + s + &#39;%, &#39; + l + &#39;%, &#39; + a + &#39;)&#39;;\n    this.ctx.fillStyle = &#39;hsla(&#39; + h + &#39;, &#39; + s + &#39;%, &#39; + l + &#39;%, &#39; + a + &#39;)&#39;;\n    this.ctx.stroke();\n    this.ctx.fill();\n\n    this.ctx.closePath();\n\n    // UI counter\n    this.drawnInLastFrame++;\n  }\n\n};\nApp.dataXYtoCanvasXY = function (x, y) {\n  var zoom = 1.6;\n  var xx = this.xC + x * zoom * this.dataToImageRatio,\n  yy = this.yC + y * zoom * this.dataToImageRatio;\n\n  return { x: xx, y: yy };\n};\n\ndocument.addEventListener(&#39;DOMContentLoaded&#39;, function () {\n  App.setup();\n  App.draw();\n\n  var frame = function () {\n    App.evolve();\n    requestAnimationFrame(frame);\n  };\n  frame();\n});\n\n\n/**\n * Some old util I use at times\n *\n * @param {Number} Xstart X value of the segment starting point\n * @param {Number} Ystart Y value of the segment starting point\n * @param {Number} Xtarget X value of the segment target point\n * @param {Number} Ytarget Y value of the segment target point\n * @param {Boolean} realOrWeb true if Real (Y towards top), false if Web (Y towards bottom)\n * @returns {Number} Angle between 0 and 2PI\n */\nsegmentAngleRad = function (Xstart, Ystart, Xtarget, Ytarget, realOrWeb) {\n  var result; // Will range between 0 and 2PI\n  if (Xstart == Xtarget) {\n    if (Ystart == Ytarget) {\n      result = 0;\n    } else if (Ystart &lt; Ytarget) {\n      result = Math.PI / 2;\n    } else if (Ystart &gt; Ytarget) {\n      result = 3 * Math.PI / 2;\n    } else {}\n  } else if (Xstart &lt; Xtarget) {\n    result = Math.atan((Ytarget - Ystart) / (Xtarget - Xstart));\n  } else if (Xstart &gt; Xtarget) {\n    result = Math.PI + Math.atan((Ytarget - Ystart) / (Xtarget - Xstart));\n  }\n\n  result = (result + 2 * Math.PI) % (2 * Math.PI);\n\n  if (!realOrWeb) {\n    result = 2 * Math.PI - result;\n  }\n\n  return result;\n};"};
    __preprocessors = {
      "html": "none",
      "css": "less",
      "js": "none"
    };
    __preprocessorNames = {
      "html": "HTML",
      "css": "Less",
      "js": "JS"
    };
    __editable = false;
    __embed_prefill = false;
  </script>

  <script src="./embed-d492f8b0f63f0a8ba679c9cd0a2fffbaa24504a7928435ba1bfc1859f904e02b.js.download"></script>


<script nonce="">(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.nonce='evx0bmPxemM=';d.innerHTML="window.__CF$cv$params={r:'90d31c799c7c96ec',t:'MTczODc2MDcxOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='evx0bmPxemM=';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script><iframe height="1" width="1" style="position: absolute; top: 0px; left: 0px; border: none; visibility: hidden;" src="./saved_resource(16).html"></iframe>

</body></html>